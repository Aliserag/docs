<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-concepts/hybrid-custody/guides/account-model">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Account Model &amp; Implementation | Flow docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://onflow.github.io/docs/img/FlowDocs_Logo_FlowLogo_Horizontal_Green_BlackText.svg"><meta data-rh="true" name="twitter:image" content="https://onflow.github.io/docs/img/FlowDocs_Logo_FlowLogo_Horizontal_Green_BlackText.svg"><meta data-rh="true" property="og:url" content="https://onflow.github.io/docs/concepts/hybrid-custody/guides/account-model"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Account Model &amp; Implementation | Flow docs"><meta data-rh="true" name="description" content="This doc serves as developer guidance to support Hybrid Custody apps by leveraging Account Linking. While account linking as a feature is a language level API, supporting linked accounts such that users achieve Hybrid Custody has a bit more nuance, namely apps should build on the LinkedAccounts standard FLIP. Implementing this standard will allow dapps to facilitate a user experience based not on a single authenticated account, but on the global context of all accounts linked to the authenticated user."><meta data-rh="true" property="og:description" content="This doc serves as developer guidance to support Hybrid Custody apps by leveraging Account Linking. While account linking as a feature is a language level API, supporting linked accounts such that users achieve Hybrid Custody has a bit more nuance, namely apps should build on the LinkedAccounts standard FLIP. Implementing this standard will allow dapps to facilitate a user experience based not on a single authenticated account, but on the global context of all accounts linked to the authenticated user."><link data-rh="true" rel="icon" href="/docs/favicon.ico"><link data-rh="true" rel="canonical" href="https://onflow.github.io/docs/concepts/hybrid-custody/guides/account-model"><link data-rh="true" rel="alternate" href="https://onflow.github.io/docs/concepts/hybrid-custody/guides/account-model" hreflang="en"><link data-rh="true" rel="alternate" href="https://onflow.github.io/docs/concepts/hybrid-custody/guides/account-model" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://DKF9ZIO5WM-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Flow docs" href="/docs/opensearch.xml">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="/mixpanel.js" async onload="if (&#39;776159d170484f49f19c3c2f7339f297&#39; &amp;&amp; &#39;776159d170484f49f19c3c2f7339f297&#39; !== &#39;undefined&#39;) {
  window.mixpanel.init(&#39;776159d170484f49f19c3c2f7339f297&#39;);

  const viwedPayload = {
    &#39;Page Name&#39;: document.title,
    &#39;Page URL&#39;: window.location.pathname,
  }
  window.mixpanel.track(&#39;Page Viewed&#39;, viwedPayload);

  const playUrl = &#39;play.onflow.org&#39;;
  const links = document.querySelectorAll(&#39;a&#39;) || [];
  const isPlayPage = Array.from(links).some((link) =&gt; link.href.includes(playUrl));

  if (isPlayPage) {
    window.mixpanel.track(&#39;Play Page Viewed&#39;, viwedPayload);
  }
  
  window.document.addEventListener(&#39;click&#39;, function (event) {
    var target = event.target;
  
    // Check if the clicked element is a link with an href attribute
    if (target.tagName === &#39;A&#39; &amp;&amp; target.hasAttribute(&#39;href&#39;)) {
      if (window.mixpanel) {
        const payload = {
          href: target.getAttribute(&#39;href&#39;),
          id: target.id,
          class: target.className,
        }
        window.mixpanel.track(&#39;Link clicked&#39;, payload);
        const isPlay = payload.href.includes(&#39;play.onflow.org&#39;);
        if (isPlay) {
          window.mixpanel.track(&#39;Play Link clicked&#39;, payload);        
        }
      }
    }
  });
}"></script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="0f0b3ed1-7761-4986-851e-09336ea6ef1c" data-project-name="Flow" data-project-color="#2E8555" data-project-logo="https://cryptologos.cc/logos/flow-flow-logo.png" async></script>
<script src="/hotjar.js" async></script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="0f0b3ed1-7761-4986-851e-09336ea6ef1c" data-project-name="Flow" data-project-color="#2E8555" data-project-logo="https://cryptologos.cc/logos/flow-flow-logo.png" async></script><link rel="stylesheet" href="/docs/assets/css/styles.a2da8909.css">
<link rel="preload" href="/docs/assets/js/runtime~main.54917cb6.js" as="script">
<link rel="preload" href="/docs/assets/js/main.d4053c76.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/flow-docs-logo-dark.png" alt="Flow Developer Portal Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docs/img/flow-docs-logo-light.png" alt="Flow Developer Portal Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/docs/concepts/intro">Concepts</a><a class="navbar__item navbar__link" href="/docs/tutorials/intro">Tutorials</a><a class="navbar__item navbar__link" href="/docs/cadence/intro">Cadence</a><a class="navbar__item navbar__link" href="/docs/tooling/intro">Tooling</a><a class="navbar__item navbar__link" href="/docs/references/Introduction">References</a><a class="navbar__item navbar__link" href="/docs/community-resources/Introduction">Resources</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/onflow" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link h-8 p-1"><img src="" alt="GitHub" id="navbar-github" class="box-content h-32 w-32"></a><a href="https://onflow.org/discord" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link h-8 p-1"><img src="" alt="Discord" id="navbar-discord" class="box-content h-32 w-32"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/concepts/intro">Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/start-here">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/flow-networks">Flow Networks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Flow Networks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/flow-token">FLOW Token</a><button aria-label="Toggle the collapsible sidebar category &#x27;FLOW Token&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/core-contracts">Flow Core Contracts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Flow Core Contracts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/staking">Epochs, Staking &amp; Delegating on Flow</a><button aria-label="Toggle the collapsible sidebar category &#x27;Epochs, Staking &amp; Delegating on Flow&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/token-standards">Token Standards</a><button aria-label="Toggle the collapsible sidebar category &#x27;Token Standards&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/nodes">Flow Nodes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Flow Nodes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/mobile">Flow Mobile</a><button aria-label="Toggle the collapsible sidebar category &#x27;Flow Mobile&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/concepts/hybrid-custody">Hybrid Custody</a><button aria-label="Toggle the collapsible sidebar category &#x27;Hybrid Custody&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/hybrid-custody/get-started">Get Started with Account Linking</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/concepts/hybrid-custody/guides/account-abstraction">guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/hybrid-custody/guides/account-abstraction">Account Abstraction on Flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/concepts/hybrid-custody/guides/account-model">Account Model &amp; Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/hybrid-custody/guides/linking-accounts">Linking Accounts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/hybrid-custody/guides/walletless-onboarding">Walletless Onboarding</a></li></ul></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tutorials/intro">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/cadence/intro">Cadence</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tooling/intro">Tooling</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/references/Introduction">References</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/community-resources/Introduction">Community Resources</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Concepts</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/concepts/hybrid-custody"><span itemprop="name">Hybrid Custody</span></a><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">guides</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Account Model &amp; Implementation</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Account Model &amp; Implementation</h1></header><p>This doc serves as developer guidance to support Hybrid Custody apps by leveraging Account Linking. While account linking as a feature is a language level API, supporting linked accounts such that users achieve Hybrid Custody has a bit more nuance, namely apps should build on the <a href="https://github.com/onflow/flips/pull/72" target="_blank" rel="noopener noreferrer">LinkedAccounts standard FLIP</a>. Implementing this standard will allow dapps to facilitate a user experience based not on a single authenticated account, but on the global context of all accounts linked to the authenticated user.</p>
<p>We believe multi-account linking and management, technical initiatives in support of <a href="https://forum.onflow.org/t/hybrid-custody/4016" target="_blank" rel="noopener noreferrer">Walletless</a> <a href="https://flow.com/post/flow-blockchain-mainstream-adoption-easy-onboarding-wallets" target="_blank" rel="noopener noreferrer">Onboarding</a>, will enable in-dapp experiences far superior to the current Web3 status quo and allow for industry UX to finally reach parity with traditional Web2 authentication and onboarding flows, most notably on mobile.</p>
<p>A new user will no longer need a preconfigured wallet to interact with Flow. When they do decide to create a wallet and link with a dapp; however, the associated accounts and assets within them will need to be accessible the same as if they were in a single account.</p>
<p>In order to realize a multi-account world that makes sense to users - one where they don’t have to concern themselves with managing assets across their network of accounts - we’re relying on Flow builders to cast their abstractive magic. Consider this your grimoire, fellow builder, where we’ll continue from the perspective of a wallet or marketplace dapp seeking to facilitate a unified account experience, abstracting away the partitioned access between accounts into a single dashboard for user interactions on all their owned assets.</p>
<blockquote>
<p>⚠️ Note that the documentation on Hybrid Custody covers the current state and will likely differ from the final implementation. Builders should be aware that breaking changes will deploy between current state and the stable version. Interested in shaping the conversation? <a href="https://github.com/onflow/flips/pull/72" target="_blank" rel="noopener noreferrer">Join in!</a></p>
</blockquote>
<h1>Objective</h1>
<ul>
<li>Understand the linked account model</li>
<li>Create a blockchain-native onboarding flow</li>
<li>Link an existing app account as a child to a newly authenticated parent account</li>
<li>Get your dapp to recognize “parent” accounts along with any associated “child” accounts</li>
<li>View Fungible and NonFungible Token metadata relating to assets across all of a user’s associated accounts - their wallet-mediated “parent” account and any hybrid custody model “child” accounts</li>
<li>Facilitate transactions acting on assets in child accounts</li>
</ul>
<h1>Design Overview</h1>
<p>The basic idea in the <a href="https://forum.onflow.org/t/account-linking-authaccount-capabilities-management/4314" target="_blank" rel="noopener noreferrer">(currently proposed) standard</a> is relatively simple. A parent account is one that has delegated authority on another account. The account which has delegated authority over itself to the parent account is the child account.</p>
<p>In the <a href="https://forum.onflow.org/t/hybrid-custody/4016" target="_blank" rel="noopener noreferrer">Hybrid Custody Model</a>, this child account would have shared access between the dapp which created the account and the linked parent account.</p>
<p>How does this delegation occur? Typically when we think of shared account access in crypto, we think keys. However, Cadence recently enabled an <a href="https://github.com/onflow/cadence/issues/2151" target="_blank" rel="noopener noreferrer">experimental feature</a> whereby an account can link a Capability to its AuthAccount.</p>
<p>We’ve leveraged this feature in a (proposed) standard so that dapps can implement a hybrid custody model whereby the dapp creates an account it controls, then later delegates authority over that account to the user once they’ve authenticate with their wallet. All related constructs are defined in the <code>LinkedAccounts</code> contract. The delegation of that account authority is mediated by the parent account&#x27;s <code>Collection</code>, and <code>Handler</code>, residing in the linked child account.</p>
<p><img loading="lazy" src="/docs/assets/images/child-account-manager-73162b0711fa24a31b7a03bc4fb65577.jpg" alt="resources/child-account-manager.jpg" width="2877" height="2455" class="img_ev3q"></p>
<p>Therefore, the presence of a <code>Collection</code> in an account implies there are potentially associated accounts for which the owning account has delegated authority. This resource is intended to be configured with a pubic Capability enabling querying of an accounts child account addresses via <code>getLinkedAccountAddresses()</code>.</p>
<p>A wallet or marketplace wishing to discover all of a user’s accounts and assets within them can do so by first looking to the user’s <code>Collection</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="identifying-account-hierarchy">Identifying Account Hierarchy<a href="#identifying-account-hierarchy" class="hash-link" aria-label="Direct link to Identifying Account Hierarchy" title="Direct link to Identifying Account Hierarchy">​</a></h2>
<p>To clarify, insofar as the standard is concerned, an account is a parent account if it contains a <code>Collection</code> resource, and an account is a child account if it contains a <code>Handler</code> resource.</p>
<p><img loading="lazy" src="/docs/assets/images/account-hierarchy-d05004d08b74e506eb412feec0b39760.jpg" alt="resources/account-hierarchy.jpg" width="3140" height="2058" class="img_ev3q"></p>
<p>We can see that the user’s <code>Collection.linkedAccounts</code> point to the address of its child account. Likewise, the child account’s <code>Handler.parentAddress</code> point to the user’s account as its parent address. This makes it easy to both identify whether an account is a parent, child, or both, and its associated parent/child account(s).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="consideration">Consideration<a href="#consideration" class="hash-link" aria-label="Direct link to Consideration" title="Direct link to Consideration">​</a></h2>
<p>Do note that this construction does not prevent an account from having multiple parent accounts or a child account from being the parent to other accounts. While initial intuition might lead one to believe that account associations are a tree with the user at the root, the graph of associated accounts among child accounts may lead to cycles of association.</p>
<p>We believe it would be unlikely for a use case to demand a user delegates authority over their main account (in fact we’d discourage such constructions), but delegating access between child accounts could be useful. As an example, consider a set of local game clients across mobile and web platforms, each with self-custodied app accounts having delegated authority to each other while both are child accounts of the user’s main account.</p>
<p><img loading="lazy" src="/docs/assets/images/user-account-97072a21a0127ed63107c62265c083f7.jpg" alt="resources/user-account.jpg" width="2175" height="1664" class="img_ev3q"></p>
<p>The user’s account is the root parent account while both child accounts have delegated access to each other. This allows assets to be easily transferable between dapp accounts without the need of a user signature to facilitate transfer.</p>
<p>Ultimately, it’ll be up to the implementing wallet/marketplace how far down the graph of account associations they’d want to traverse and display to the user.</p>
<h1>Implementation</h1>
<p>From the perspective of a wallet or marketplace dapp, some relevant things to know about the user are:</p>
<ul>
<li>Does this account have associated linked accounts?</li>
<li>What are those associated linked accounts, if any?</li>
<li>What NFTs are owned by this user across all associated accounts?</li>
<li>What are the balances of all FungibleTokens across all associated accounts?</li>
</ul>
<p>And with respect to acting on the assets of child accounts and managing child accounts themselves:</p>
<ul>
<li>Spending FungibleTokens from a linked account’s Vault</li>
<li>Creating a user-funded linked account</li>
<li>Removing a linked account</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-whether-an-address-has-associated-accounts">Query Whether an Address Has Associated Accounts<a href="#query-whether-an-address-has-associated-accounts" class="hash-link" aria-label="Direct link to Query Whether an Address Has Associated Accounts" title="Direct link to Query Whether an Address Has Associated Accounts">​</a></h3>
<p>This script will return <code>true</code> if a <code>LinkedAccounts.Collection</code> is stored and <code>false</code> otherwise</p>
<div class="ch-codeblock not-prose"><div class="ch-code" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>import MetadataViews from &quot;../contracts/utility/MetadataViews.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>import NonFungibleToken from &quot;../contracts/utility/NonFungibleToken.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>import LinkedAccounts from &quot;../contracts/LinkedAccounts.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>/// This script allows one to determine if a given account has a LinkedAccounts.Collection configured as expected</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>///</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>/// @param address: The address to query against</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>///</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>/// @return True if the account has a LinkedAccounts.Collection configured at the canonical path, false otherwise</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>///</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>pub fun main(address: Address): Bool {</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>    // Get the account</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>    let account = getAuthAccount(address)</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>    // Get the Collection&#x27;s Metadata</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>    let collectionView: MetadataViews.NFTCollectionData = (</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>            LinkedAccounts.resolveView(Type&lt;MetadataViews.NFTCollectionData&gt;()) as! MetadataViews.NFTCollectionData?</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>        )!</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>    // Assign public &amp; private capabilities from expected paths</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>    let collectionPublicCap = account.getCapability&lt;</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>            &amp;LinkedAccounts.Collection{LinkedAccounts.CollectionPublic, MetadataViews.ResolverCollection}</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>        &gt;(collectionView.publicPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>    let collectionPrivateCap = account.getCapability&lt;</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>            &amp;LinkedAccounts.Collection{LinkedAccounts.CollectionPublic, NonFungibleToken.CollectionPublic, NonFungibleToken.Receiver, NonFungibleToken.Provider, MetadataViews.ResolverCollection}</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>        &gt;(collectionView.providerPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>    // Return whether account is configured as expected</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>    return account.type(at: collectionView.storagePath) == Type&lt;@LinkedAccounts.Collection&gt;() &amp;&amp;</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>        collectionPublicCap.check() &amp;&amp; collectionPrivateCap.check()</span></div></div><div><span class="ch-code-line-number">_<!-- -->29</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-all-accounts-associated-with-address">Query All Accounts Associated with Address<a href="#query-all-accounts-associated-with-address" class="hash-link" aria-label="Direct link to Query All Accounts Associated with Address" title="Direct link to Query All Accounts Associated with Address">​</a></h3>
<p>The following script will return an array addresses associated with a given account’s address, inclusive of the provided address.</p>
<div class="ch-codeblock not-prose"><div class="ch-code" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>import LinkedAccounts from &quot;../contracts/LinkedAccounts.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>pub fun main(address: Address): [Address] {</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>	// Init return variable</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>	let addresses: [Address] = [address]</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>	// Get the AuthAccount of the specified Address</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>	let account: AuthAccount = getAuthAccount(address)</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>	// Get a reference to the account&#x27;s Collection if it exists at the standard path</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>	if let collectionRef = account.borrow&lt;&amp;LinkedAccounts.Collection&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>    from: LinkedAccounts.CollectionStoragePath</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>  ) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>		// Append any child account addresses to the return value</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>		addresses.appendAll(</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>		 collectionRef.getLinkedAccountAddresses()</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>		)</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>	}</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>	// Return the final array, inclusive of specified Address</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>	return addresses</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-all-owned-nft-metadata">Query All Owned NFT Metadata<a href="#query-all-owned-nft-metadata" class="hash-link" aria-label="Direct link to Query All Owned NFT Metadata" title="Direct link to Query All Owned NFT Metadata">​</a></h3>
<p>While it is possible to iterate over the storage of all associated accounts in a single script, memory limits prevent this approach from scaling well. Since some accounts hold thousands of NFTs, we recommend breaking up iteration, utilizing several queries to iterate over accounts and the storage of each account. Batching queries on individual accounts may even be required based on the number of NFTs held.</p>
<ol>
<li>Get all associated account addresses (see above)</li>
<li>Looping over each associated account address client-side, get each address’s owned NFT metadata</li>
</ol>
<div class="ch-codeblock not-prose"><div class="ch-code" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>import NonFungibleToken from &quot;../contracts/utility/NonFungibleToken.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>import MetadataViews from &quot;../contracts/utility/MetadataViews.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>import LinkedAccounts from &quot;../contracts/LinkedAccounts.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// Custom struct to make interpretation of NFT &amp; Collection data easy client side</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>pub struct NFTData {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let name: String</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let description: String</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let thumbnail: String</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let resourceID: UInt64</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let ownerAddress: Address?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let collectionName: String?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let collectionDescription: String?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let collectionURL: String?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let collectionStoragePathIdentifier: String</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let collectionPublicPathIdentifier: String?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    init(</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        name: String,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        description: String,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        thumbnail: String,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        resourceID: UInt64,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        ownerAddress: Address?,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        collectionName: String?,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        collectionDescription: String?,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        collectionURL: String?,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        collectionStoragePathIdentifier: String,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        collectionPublicPathIdentifier: String?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    ) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.name = name</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.description = description</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.thumbnail = thumbnail</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.resourceID = resourceID</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.ownerAddress = ownerAddress</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.collectionName = collectionName</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.collectionDescription = collectionDescription</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.collectionURL = collectionURL</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.collectionStoragePathIdentifier = collectionStoragePathIdentifier</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.collectionPublicPathIdentifier = collectionPublicPathIdentifier</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// Helper function that retrieves data about all publicly accessible NFTs in an account</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>///</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>pub fun getAllViewsFromAddress(_ address: Address): [NFTData] {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    // Get the account</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    let account: AuthAccount = getAuthAccount(address)</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    // Init for return value</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    let data: [NFTData] = []</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    // Assign the types we&#x27;ll need</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    let collectionType: Type = Type&lt;@{NonFungibleToken.CollectionPublic, MetadataViews.ResolverCollection}&gt;()</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    let displayType: Type = Type&lt;MetadataViews.Display&gt;()</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    let collectionDisplayType: Type = Type&lt;MetadataViews.NFTCollectionDisplay&gt;()</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    let collectionDataType: Type = Type&lt;MetadataViews.NFTCollectionData&gt;()</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    // Iterate over each public path</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    account.forEachStored(fun (path: StoragePath, type: Type): Bool {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        // Check if it&#x27;s a Collection we&#x27;re interested in, if so, get a reference</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        if type.isSubtype(of: collectionType) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            if let collectionRef = account.borrow&lt;</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                &amp;{NonFungibleToken.CollectionPublic, MetadataViews.ResolverCollection}</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            &gt;(from: path) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                // Iterate over the Collection&#x27;s NFTs, continuing if the NFT resolves the views we want</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                for id in collectionRef.getIDs() {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                    let resolverRef: &amp;{MetadataViews.Resolver} = collectionRef.borrowViewResolver(id: id)</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                    if let display = resolverRef.resolveView(displayType) as! MetadataViews.Display? {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                        let collectionDisplay = resolverRef.resolveView(collectionDisplayType) as! MetadataViews.NFTCollectionDisplay?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                        let collectionData = resolverRef.resolveView(collectionDataType) as! MetadataViews.NFTCollectionData?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                        // Build our NFTData struct from the metadata</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                        let nftData = NFTData(</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            name: display.name,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            description: display.description,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            thumbnail: display.thumbnail.uri(),</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            resourceID: resolverRef.uuid,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            ownerAddress: resolverRef.owner?.address,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            collectionName: collectionDisplay?.name,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            collectionDescription: collectionDisplay?.description,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            collectionURL: collectionDisplay?.externalURL?.url,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            collectionStoragePathIdentifier: path.toString(),</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            collectionPublicPathIdentifier: collectionData?.publicPath?.toString()</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                        )</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                        // Add it to our data</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                        data.append(nftData)</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        return true</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    })</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    return data</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// Script that retrieve data about all publicly accessible NFTs in an account and any of its</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// child accounts</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>///</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// Note that this script does not consider accounts with exceptionally large collections </span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// which would result in memory errors. To compose a script that does cover accounts with</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// a large number of sub-accounts and/or NFTs within those accounts, see example 5 in</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// the NFT Catalog&#x27;s README: https://github.com/dapperlabs/nft-catalog and adapt for use</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// with LinkedAccounts.Collection</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>///</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>pub fun main(address: Address): {Address: [NFTData]} {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    let allNFTData: {Address: [NFTData]} = {}</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    // Add all retrieved views to the running mapping indexed on address</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    allNFTData.insert(key: address, getAllViewsFromAddress(address))</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    /* Iterate over any child accounts */ </span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    //</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    // Get reference to LinkedAccounts.Collection if it exists</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    if let collectionRef = getAccount(address).getCapability&lt;</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            &amp;LinkedAccounts.Collection{LinkedAccounts.CollectionPublic}</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        &gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            LinkedAccounts.CollectionPublicPath</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        ).borrow() {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        // Iterate over each linked account in LinkedAccounts.Collection</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        for childAddress in collectionRef.getLinkedAccountAddresses() {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            if !allNFTData.containsKey(childAddress) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                // Insert the NFT metadata for those NFTs in each child account</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                // indexing on the account&#x27;s address</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                allNFTData.insert(key: childAddress, getAllViewsFromAddress(childAddress))</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    return allNFTData </span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div>
<p>After iterating over all associated accounts, the client will have an array of <code>NFTData</code> structs containing relevant information about each owned NFT including the address where the NFT resides. Note that this script does not take batching into consideration and assumes that each NFT resolves at minimum the <code>MetadataViews.Display</code> view type.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-all-account-fungibletoken-balances">Query All Account FungibleToken Balances<a href="#query-all-account-fungibletoken-balances" class="hash-link" aria-label="Direct link to Query All Account FungibleToken Balances" title="Direct link to Query All Account FungibleToken Balances">​</a></h3>
<p>Similar to the previous example, we recommend breaking up this task due to memory limits.</p>
<ol>
<li>Get all linked account addresses (see above)</li>
<li>Looping over each associated account address client-side, get each address’s owned FungibleToken Vault metadata</li>
</ol>
<div class="ch-codeblock not-prose"><div class="ch-code" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>import FungibleToken from &quot;../contracts/utility/FungibleToken.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>import FungibleTokenMetadataViews from &quot;../contracts/utility/FungibleTokenMetadataViews.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>import MetadataViews from &quot;../contracts/utility/MetadataViews.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>import LinkedAccounts from &quot;../contracts/LinkedAccounts.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// Custom struct to easily communicate vault data to a client</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>pub struct VaultInfo {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let name: String?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let symbol: String?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub var balance: UFix64</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let description: String?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let externalURL: String?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let logos: MetadataViews.Medias?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let storagePathIdentifier: String</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let receiverPathIdentifier: String?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub let providerPathIdentifier: String?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    init(</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        name: String?,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        symbol: String?,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        balance: UFix64,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        description: String?,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        externalURL: String?,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        logos: MetadataViews.Medias?,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        storagePathIdentifier: String,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        receiverPathIdentifier: String?,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        providerPathIdentifier: String?</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    ) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.name = name</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.symbol = symbol</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.balance = balance</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.description = description</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.externalURL = externalURL</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.logos = logos</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.storagePathIdentifier = storagePathIdentifier</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.receiverPathIdentifier = receiverPathIdentifier</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.providerPathIdentifier = providerPathIdentifier</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    pub fun addBalance(_ addition: UFix64) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        self.balance = self.balance + addition</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// Returns a dictionary of VaultInfo indexed on the Type of Vault</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>pub fun getAllVaultInfoInAddressStorage(_ address: Address): {Type: VaultInfo} {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    // Get the account</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    let account: AuthAccount = getAuthAccount(address)</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    // Init for return value</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    let balances: {Type: VaultInfo} = {}</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    // Assign the type we&#x27;ll need</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    let vaultType: Type = Type&lt;@{FungibleToken.Balance, MetadataViews.Resolver}&gt;()</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    let ftViewType: Type= Type&lt;FungibleTokenMetadataViews.FTView&gt;()</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    // Iterate over all stored items &amp; get the path if the type is what we&#x27;re looking for</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    account.forEachStored(fun (path: StoragePath, type: Type): Bool {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        if type.isSubtype(of: vaultType) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            // Get a reference to the vault &amp; its balance</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            if let vaultRef = account.borrow&lt;&amp;{FungibleToken.Balance, MetadataViews.Resolver}&gt;(from: path) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                let balance = vaultRef.balance</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                // Attempt to resolve metadata on the vault</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                if let ftView = vaultRef.resolveView(ftViewType) as! FungibleTokenMetadataViews.FTView? {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                    // Insert a new info struct if it&#x27;s the first time we&#x27;ve seen the vault type</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                    if !balances.containsKey(type) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                        let vaultInfo = VaultInfo(</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            name: ftView.ftDisplay?.name ?? vaultRef.getType().identifier,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            symbol: ftView.ftDisplay?.symbol,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            balance: balance,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            description: ftView.ftDisplay?.description,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            externalURL: ftView.ftDisplay?.externalURL?.url,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            logos: ftView.ftDisplay?.logos,</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            storagePathIdentifier: path.toString(),</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            receiverPathIdentifier: ftView.ftVaultData?.receiverPath?.toString(),</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                            providerPathIdentifier: ftView.ftVaultData?.providerPath?.toString()</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                        )</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                        balances.insert(key: type, vaultInfo)</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                    } else {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                        // Otherwise just update the balance of the vault (unlikely we&#x27;ll see the same type twice in</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                        // the same account, but we want to cover the case)</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                        balances[type]!.addBalance(balance)</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>                }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        return true</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    })</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    return balances</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// Takes two dictionaries containing VaultInfo structs indexed on the type of vault they represent &amp;</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// returns a single dictionary containg the summed balance of each respective vault type</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>pub fun merge(_ d1: {Type: VaultInfo}, _ d2: {Type: VaultInfo}): {Type: VaultInfo} {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    for type in d1.keys {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        if d2.containsKey(type) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            d1[type]!.addBalance(d2[type]!.balance)</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    return d1</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// Queries for FT.Vault info of all FT.Vaults in the specified account and all of its linked accounts</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>///</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// @param address: Address of the account to query FT.Vault data</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>///</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>/// @return A mapping of VaultInfo struct indexed on the Type of Vault</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>///</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>pub fun main(address: Address): {Type: VaultInfo} {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    // Get the balance info for the given address</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    var balances: {Type: VaultInfo} = getAllVaultInfoInAddressStorage(address)</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    /* Iterate over any linked accounts */ </span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    //</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    // Get reference to LinkedAccounts.Collection if it exists</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    if let collectionRef = getAccount(address).getCapability&lt;</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            &amp;LinkedAccounts.Collection{LinkedAccounts.CollectionPublic}</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        &gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            LinkedAccounts.CollectionPublicPath</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        ).borrow() {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        // Iterate over each linked account in Collection</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        for linkedAccount in collectionRef.getLinkedAccountAddresses() {</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            // Ensure all vault type balances are pooled across all addresses</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>            balances = merge(balances, getAllVaultInfoInAddressStorage(linkedAccount))</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>    return balances </span></div></div><div><span class="ch-code-line-number">_<!-- -->126</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div>
<p>The above script returns a dictionary of <code>VaultInfo</code> structs indexed on the Vault Type and containing relevant Vault metadata. If the Vault doesn’t resolve <code>FungibleTokenMetadataViews</code>, your client will at least be guaranteed to receive the Type, storagePathIdentifier and balance of each Vault in storage.</p>
<p>The returned data at the end of address iteration should be sufficient to achieve a unified balance of all Vaults of similar types across all of a user’s associated account as well as a more granular per account view.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-child-account-fungibletokens-signing-as-parent">Use Child Account FungibleTokens Signing As Parent<a href="#use-child-account-fungibletokens-signing-as-parent" class="hash-link" aria-label="Direct link to Use Child Account FungibleTokens Signing As Parent" title="Direct link to Use Child Account FungibleTokens Signing As Parent">​</a></h3>
<p>A user with tokens in one of their linked accounts will likely want to utilize said tokens. In this example, the user will sign a transaction a transaction with their authenticated account that retrieves a reference to a linked account’s Flow Provider, enabling withdrawal from the linked account having signed with the main account.</p>
<div class="ch-codeblock not-prose"><div class="ch-code" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>import FungibleToken from &quot;../../contracts/utility/FungibleToken.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>import FlowToken from &quot;../../contracts/FlowToken.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>import LinkedAccounts from &quot;../../contracts/LinkedAccounts.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>transaction(fundingChildAddress: Address, withdrawAmount: UFix64) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>    let paymentVault: @FungibleToken.Vault</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>    prepare(signer: AuthAccount) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>        // Get a reference to the signer&#x27;s LinkedAccounts.Collection from storage</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>        let collectionRef: &amp;LinkedAccounts.Collection = signer.borrow&lt;&amp;LinkedAccounts.Collection&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>                from: LinkedAccounts.CollectionStoragePath</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>            ) ?? panic(&quot;Could not borrow reference to LinkedAccounts.Collection in signer&#x27;s account at expected path!&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>        // Borrow a reference to the signer&#x27;s specified child account</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>        let childAccount: &amp;AuthAccount = collectionRef.getChildAccountRef(address: fundingChildAddress)</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>            ?? panic(&quot;Signer does not have access to specified account&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>        // Get a reference to the child account&#x27;s FlowToken Vault</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>        let vaultRef: &amp;TicketToken.Vault = childAccount.borrow&lt;&amp;FlowToken.Vault&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>                from: /storage/flowToken</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>            ) ?? panic(&quot;Could not borrow a reference to the child account&#x27;s TicketToken Vault at expected path!&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>        self.paymentVault &lt;-vaultRef.withdraw(amount: withdrawAmount)</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>    execute {</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>      // Do stuff with the vault...(e.g. mint NFT)</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->27</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div>
<p>At the end of this transaction, you’ve gotten a reference to the specified account’s Flow Provider. You could continue for a number of use cases - minting or purchasing an NFT with funds from the linked account, transfer between accounts, etc. A similar approach could get you reference to the linked account’s <code>NonFungibleToken.Provider</code>, enabling NFT transfer, etc.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="revoking-secondary-access-on-a-linked-account">Revoking Secondary Access on a Linked Account<a href="#revoking-secondary-access-on-a-linked-account" class="hash-link" aria-label="Direct link to Revoking Secondary Access on a Linked Account" title="Direct link to Revoking Secondary Access on a Linked Account">​</a></h3>
<p>The expected uses of child accounts for progressive onboarding implies that they will be accounts with shared access. A user may decide that they no longer want secondary parties to have access to the child account.</p>
<p>There are two ways a party can have delegated access to an account - keys and AuthAccount Capability. To revoke access via keys, a user would iterate over account keys and revoke any that the user does not custody.</p>
<p>Things are not as straightforward respect to AuthAccount Capabilities, at least not until Capability Controllers enter the picture. This is discussed in more detail in <a href="https://forum.onflow.org/t/account-linking-authaccount-capabilities-management/4314" target="_blank" rel="noopener noreferrer">the Flip</a>. For now, we recommend that if users want to revoke secondary access, they transfer any assets from the relevant child account and remove it altogether.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="remove-a-child-account">Remove a Child Account<a href="#remove-a-child-account" class="hash-link" aria-label="Direct link to Remove a Child Account" title="Direct link to Remove a Child Account">​</a></h3>
<p>As mentioned above, if a user no longer wishes to share access with another party, it’s recommended that desired assets be transferred from that account to either their main account or other linked accounts and the linked account be removed from their <code>LinkedAccounts.Collection</code>. Let’s see how to complete that removal.</p>
<div class="ch-codeblock not-prose"><div class="ch-code" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>import LinkedAccounts from &quot;../../contracts/LinkedAccounts.cdc&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>/// This transaction removes access to a linked account from the signer&#x27;s LinkedAccounts Collection.</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>/// **NOTE:** The signer will no longer have access to the removed child account via AuthAccount Capability, so care</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>/// should be taken to ensure any assets in the child account have been first transferred as well as checking active</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>/// keys that need to be revoked have been done so (a detail that will largely depend on you dApps custodial model)</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>///</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>transaction(childAddress: Address) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>    let collectionRef: &amp;LinkedAccounts.Collection</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>    prepare(signer: AuthAccount) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>        // Assign a reference to signer&#x27;s LinkedAccounts.Collection</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>        self.collectionRef = signer.borrow&lt;&amp;LinkedAccounts.Collection&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>                from: LinkedAccounts.CollectionStoragePath</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>            ) ?? panic(&quot;Signer does not have a LinkedAccounts Collection configured!&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>    execute {</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>        // Remove child account, revoking any granted Capabilities</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>        self.collectionRef.removeLinkedAccount(withAddress: childAddress)</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->23</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div>
<p>After removal, the signer no longer has delegated access to the removed account via their <code>Collection</code>. Also note that currently a user can grant their linked accounts generic Capabilities. During removal, those Capabilities are revoked, removing the linked account’s access via their <code>Handler</code>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/onflow/docs/tree/main/docs/concepts/hybrid-custody/guides/account-model.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-05-17T19:33:07.000Z">May 17, 2023</time></b> by <b>Josh Hannan</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/concepts/hybrid-custody/guides/account-abstraction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Account Abstraction on Flow</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/concepts/hybrid-custody/guides/linking-accounts"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Linking Accounts</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#identifying-account-hierarchy" class="table-of-contents__link toc-highlight">Identifying Account Hierarchy</a></li><li><a href="#consideration" class="table-of-contents__link toc-highlight">Consideration</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a><ul><li><a href="#query-whether-an-address-has-associated-accounts" class="table-of-contents__link toc-highlight">Query Whether an Address Has Associated Accounts</a></li><li><a href="#query-all-accounts-associated-with-address" class="table-of-contents__link toc-highlight">Query All Accounts Associated with Address</a></li><li><a href="#query-all-owned-nft-metadata" class="table-of-contents__link toc-highlight">Query All Owned NFT Metadata</a></li><li><a href="#query-all-account-fungibletoken-balances" class="table-of-contents__link toc-highlight">Query All Account FungibleToken Balances</a></li><li><a href="#use-child-account-fungibletokens-signing-as-parent" class="table-of-contents__link toc-highlight">Use Child Account FungibleTokens Signing As Parent</a></li><li><a href="#revoking-secondary-access-on-a-linked-account" class="table-of-contents__link toc-highlight">Revoking Secondary Access on a Linked Account</a></li><li><a href="#remove-a-child-account" class="table-of-contents__link toc-highlight">Remove a Child Account</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools">SDK&#x27;s &amp; Tools</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn">Learning Resources</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cadence">Cadence</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts/mobile">Mobile</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tooling/fcl-js">FCL</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tooling/flow-js-testing">JS Testing Library</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tooling/flow-cli">CLI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tooling/emulator">Emulator</a></li><li class="footer__item"><a href="https://github.com/onflow/fcl-dev-wallet" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dev Wallet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tooling/vscode-extension">VS Code Extension</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/community">Ecosystem</a></li><li class="footer__item"><a href="https://port.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flow Port<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/onflow/developer-grants" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Grants<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://flow.com/flow-responsible-disclosure" target="_blank" rel="noopener noreferrer" class="footer__link-item">Responsible Disclosure<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.flowverse.co/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flowverse<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://academy.ecdao.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Emerald Academy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://floats.city/" target="_blank" rel="noopener noreferrer" class="footer__link-item">FLOATs (Attendance NFTs)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Start Building</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://play.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flow Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials/kitty-items">Kitty Items</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cadence/tutorial/first-steps">Cadence Tutorials</a></li><li class="footer__item"><a href="https://open-cadence.onflow.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cadence Cookbook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts/core-contracts">Core Contracts &amp; Standards</a></li><li class="footer__item"><a href="https://academy.ecdao.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Emerald DAO Bootcamp<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Network</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://status.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Network Status<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://flowscan.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flowscan Mainnet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://testnet.flowscan.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flowscan Testnet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts/nodes/node-operation/past-sporks">Past Sporks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts/nodes/node-operation/upcoming-sporks">Upcoming Sporks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts/nodes/node-operation">Node Operation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts/nodes/node-operation/spork">Spork Information</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/onflow" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://onflow.org/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OnFlow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Flow, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.54917cb6.js"></script>
<script src="/docs/assets/js/main.d4053c76.js"></script>
</body>
</html>