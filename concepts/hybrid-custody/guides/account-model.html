<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-stable plugin-docs plugin-id-default docs-doc-id-concepts/hybrid-custody/guides/account-model">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Account Model &amp; Implementation | Flow Developer Portal</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://onflow.github.io/docs/img/FlowDocs_Logo_FlowLogo_Horizontal_Green_BlackText.svg"><meta data-rh="true" name="twitter:image" content="https://onflow.github.io/docs/img/FlowDocs_Logo_FlowLogo_Horizontal_Green_BlackText.svg"><meta data-rh="true" property="og:url" content="https://onflow.github.io/docs/concepts/hybrid-custody/guides/account-model"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="stable"><meta data-rh="true" name="docusaurus_tag" content="docs-default-stable"><meta data-rh="true" name="docsearch:version" content="stable"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-stable"><meta data-rh="true" property="og:title" content="Account Model &amp; Implementation | Flow Developer Portal"><meta data-rh="true" name="description" content="This doc serves as developer guidance to support Hybrid Custody apps leveraging Account Linking. While account linking"><meta data-rh="true" property="og:description" content="This doc serves as developer guidance to support Hybrid Custody apps leveraging Account Linking. While account linking"><link data-rh="true" rel="icon" href="/docs/favicon.ico"><link data-rh="true" rel="canonical" href="https://onflow.github.io/docs/concepts/hybrid-custody/guides/account-model"><link data-rh="true" rel="alternate" href="https://onflow.github.io/docs/concepts/hybrid-custody/guides/account-model" hreflang="en"><link data-rh="true" rel="alternate" href="https://onflow.github.io/docs/concepts/hybrid-custody/guides/account-model" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://DKF9ZIO5WM-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Flow Developer Portal" href="/docs/opensearch.xml">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="/mixpanel.js" async onload="if (&#39;776159d170484f49f19c3c2f7339f297&#39; &amp;&amp; &#39;776159d170484f49f19c3c2f7339f297&#39; !== &#39;undefined&#39;) {
  window.mixpanel.init(&#39;776159d170484f49f19c3c2f7339f297&#39;);

  const viwedPayload = {
    &#39;Page Name&#39;: document.title,
    &#39;Page URL&#39;: window.location.pathname,
  }
  window.mixpanel.track(&#39;Page Viewed&#39;, viwedPayload);

  const playUrl = &#39;play.onflow.org&#39;;
  const links = document.querySelectorAll(&#39;a&#39;) || [];
  const isPlayPage = Array.from(links).some((link) =&gt; link.href.includes(playUrl));

  if (isPlayPage) {
    window.mixpanel.track(&#39;Play Page Viewed&#39;, viwedPayload);
  }
  
  window.document.addEventListener(&#39;click&#39;, function (event) {
    var target = event.target;
  
    // Check if the clicked element is a link with an href attribute
    if (target.tagName === &#39;A&#39; &amp;&amp; target.hasAttribute(&#39;href&#39;)) {
      if (window.mixpanel) {
        const payload = {
          href: target.getAttribute(&#39;href&#39;),
          id: target.id,
          class: target.className,
        }
        window.mixpanel.track(&#39;Link clicked&#39;, payload);
        const isPlay = payload.href.includes(&#39;play.onflow.org&#39;);
        if (isPlay) {
          window.mixpanel.track(&#39;Play Link clicked&#39;, payload);        
        }
      }
    }
  });
}"></script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="0f0b3ed1-7761-4986-851e-09336ea6ef1c" data-project-name="Flow" data-project-color="#2E8555" data-project-logo="https://cryptologos.cc/logos/flow-flow-logo.png" async></script>
<script src="/hotjar.js" async></script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="0f0b3ed1-7761-4986-851e-09336ea6ef1c" data-project-name="Flow" data-project-color="#2E8555" data-project-logo="https://cryptologos.cc/logos/flow-flow-logo.png" async></script><link rel="stylesheet" href="/docs/assets/css/styles.e021a047.css">
<link rel="preload" href="/docs/assets/js/runtime~main.74808b24.js" as="script">
<link rel="preload" href="/docs/assets/js/main.1d70c217.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/flow-docs-logo-dark.png" alt="Flow Developer Portal Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docs/img/flow-docs-logo-light.png" alt="Flow Developer Portal Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/docs/concepts/intro">Concepts</a><a class="navbar__item navbar__link" href="/docs/tutorials/intro">Tutorials</a><a class="navbar__item navbar__link" href="/docs/cadence/intro">Cadence</a><a class="navbar__item navbar__link" href="/docs/tooling/intro">Tooling</a><a class="navbar__item navbar__link" href="/docs/references/Introduction">References</a><a class="navbar__item navbar__link" href="/docs/community-resources/Introduction">Resources</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/concepts/intro">Current</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/concepts/hybrid-custody/guides/account-model">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/concepts/hybrid-custody/guides/account-model">Current</a></li></ul></div><a href="https://github.com/onflow" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link h-8 desktop:p-1"><img src="" alt="GitHub" id="navbar-github" class="box-content h-32 w-32"><span class="p-2 desktop:hidden">Github</span></a><a href="https://onflow.org/discord" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link h-8 desktop:p-1"><img src="" alt="Discord" id="navbar-discord" class="box-content h-32 w-32"><span class="p-2 desktop:hidden">Discord</span></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/concepts/intro">Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/start-here">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/flow-networks">Flow Networks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Flow Networks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/flow-token">FLOW Token</a><button aria-label="Toggle the collapsible sidebar category &#x27;FLOW Token&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/core-contracts">Flow Core Contracts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Flow Core Contracts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/staking">Epochs, Staking &amp; Delegating on Flow</a><button aria-label="Toggle the collapsible sidebar category &#x27;Epochs, Staking &amp; Delegating on Flow&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/token-standards">Token Standards</a><button aria-label="Toggle the collapsible sidebar category &#x27;Token Standards&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/nodes">Flow Nodes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Flow Nodes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/concepts/mobile">Flow Mobile</a><button aria-label="Toggle the collapsible sidebar category &#x27;Flow Mobile&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/concepts/hybrid-custody">Hybrid Custody</a><button aria-label="Toggle the collapsible sidebar category &#x27;Hybrid Custody&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/hybrid-custody/get-started">Get Started with Hybrid Custody</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/concepts/hybrid-custody/guides/account-abstraction">guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/hybrid-custody/guides/account-abstraction">Account Abstraction on Flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/concepts/hybrid-custody/guides/account-model">Account Model &amp; Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/hybrid-custody/guides/linking-accounts">Linking Accounts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/hybrid-custody/guides/walletless-onboarding">Walletless Onboarding</a></li></ul></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tutorials/intro">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/cadence/intro">Cadence</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tooling/intro">Tooling</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/references/Introduction">References</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/community-resources/Introduction">Community Resources</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Concepts</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/concepts/hybrid-custody"><span itemprop="name">Hybrid Custody</span></a><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">guides</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Account Model &amp; Implementation</span><meta itemprop="position" content="4"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Current</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Account Model &amp; Implementation</h1></header><p>This doc serves as developer guidance to support Hybrid Custody apps leveraging Account Linking. While account linking
as a feature is a language level API, supporting linked accounts such that users achieve Hybrid Custody has a bit more
nuance, namely that apps should build on the HybridCustody standard proposed in <a href="https://github.com/onflow/flips/pull/72" target="_blank" rel="noopener noreferrer">FLIP
#72</a> for ecosystem-wide support. Implementing this standard will allow dapps to
facilitate a user experience based not on a single authenticated account, but on the global context of all accounts
linked to the authenticated parent account.</p>
<p>We believe multi-account linking and management, technical initiatives in support of
<a href="https://flow.com/post/flow-blockchain-mainstream-adoption-easy-onboarding-wallets" target="_blank" rel="noopener noreferrer">Walletless Onboarding</a>,
will enable in-dapp experiences far superior to the current Web3 status quo and allow for industry UX to finally
reach parity with traditional Web2 authentication and onboarding flows, most notably on mobile.</p>
<p>A new user will no longer need a preconfigured wallet to interact with Flow. When they do decide to create a wallet and
link with a dapp; however, the associated accounts and assets within them will need to be accessible the same as if they
were in a single account.</p>
<p>In order to realize a multi-account world that makes sense to users - one where they don&#x27;t have to concern themselves
with managing assets across their network of accounts - we&#x27;re relying on Flow builders to cast their abstractive magic.
These docs will provide you with components and steps to create those abstractions for your users. In this doc, we&#x27;ll
continue from the perspective of a wallet or marketplace dapp seeking to facilitate a unified account experience,
abstracting away the partitioned access between accounts into a single dashboard for user interactions on all their
owned assets.</p>
<div class="theme-admonition theme-admonition-warning alert alert--warning admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_vXIg"><p>Note that the documentation on Hybrid Custody covers the current state and will likely differ from the final
implementation. <strong>Testnet is currently out of sync with docs and will be updated shortly.</strong> Builders should be aware
that breaking changes may follow before reaching a final community consensus on implementation. Interested in
contributing? <a href="https://github.com/onflow/hybrid-custody" target="_blank" rel="noopener noreferrer">Check out the source!</a>.</p></div></div>
<h1>Objectives</h1>
<ul>
<li>Understand the Hybrid Custody account model</li>
<li>Differentiate between restricted child accounts and unrestricted owned accounts</li>
<li>Get your dapp to recognize “parent” accounts along with any associated “child” accounts</li>
<li>View Fungible and NonFungible Token metadata relating to assets across all of a user&#x27;s associated accounts - their
wallet-mediated “parent” account and any hybrid custody model “child” accounts</li>
<li>Facilitate transactions acting on assets in child accounts</li>
</ul>
<h1>Design Overview</h1>
<div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_vXIg"><p>TL;DR: An account&#x27;s <code>HybridCustody.Manager</code> is the entry point for all of a user&#x27;s associated accounts.</p></div></div>
<p>The basic idea in the <a href="https://forum.onflow.org/t/account-linking-authaccount-capabilities-management/4314" target="_blank" rel="noopener noreferrer">(currently proposed)
standard</a> is relatively simple. A
parent account is one that has received delegated (albeit restricted) access on another account. The account which has
delegated authority over itself to the parent account is the child account.</p>
<p>In the <a href="https://forum.onflow.org/t/hybrid-custody/4016" target="_blank" rel="noopener noreferrer">Hybrid Custody Model</a>, this child account would have shared
access between the dapp - the entity which created likely custodies the account - and the linked parent account.</p>
<p>How does this delegation occur? Typically when we think of shared account access in crypto, we think keys. However,
Cadence enables <a href="https://github.com/onflow/cadence/issues/2151" target="_blank" rel="noopener noreferrer">accounts to link Capabilities to themselves</a> and issue
those Capabilities to other parties (more on <a href="https://developers.flow.com/cadence/language/capability-based-access-control" target="_blank" rel="noopener noreferrer">capability-based access
here</a>).</p>
<p>We&#x27;ve leveraged this feature in a (proposed) standard so that dapps can implement a hybrid custody model whereby the
dapp creates an account it controls, then later delegates access on that account to the user once they&#x27;ve authenticated
with their wallet.</p>
<p>All related constructs are used together in the <a href="https://testnet.contractbrowser.com/A.96b15ff6dfde11fe.HybridCustody" target="_blank" rel="noopener noreferrer"><code>HybridCustody</code>
contract</a> to define the standard.</p>
<p>Parent accounts own a <code>Manager</code> resource which stores Capabilities to <code>ChildAccount</code> (restricted access) and
<code>OwnedAccount</code> (unrestricted access) resources, both of which are stored in any given child account.</p>
<p>Therefore, the presence of a <code>Manager</code> in an account implies there are potentially associated accounts for which the
owning account has delegated access. This resource is intended to be configured with a public Capability that enables
querying of an account&#x27;s child account addresses via <code>getAccountAddresses()</code> and <code>getOwnedAccountAddresses()</code>.As you
can deduce from these two methods, there is a notion of &quot;owned&quot; accounts which we&#x27;ll expand on in a bit.</p>
<p>A wallet or marketplace wishing to discover all of a user&#x27;s accounts and assets within them can do so by first looking
to the user&#x27;s <code>Manager</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="identifying-account-hierarchy">Identifying Account Hierarchy<a href="#identifying-account-hierarchy" class="hash-link" aria-label="Direct link to Identifying Account Hierarchy" title="Direct link to Identifying Account Hierarchy">​</a></h2>
<p>To clarify, insofar as the standard is concerned, an account is a parent account if it contains a <code>Manager</code> resource,
and an account is a child account if it contains at minimum an <code>OwnedAccount</code> or additionally a <code>ChildAccount</code> resource.</p>
<p>Within a user&#x27;s <code>Manager</code>, its mapping of <code>childAccounts</code> points to the addresses of its child accounts in each index,
with corresponding values giving the Manager access to those accounts via corresponding<code>ChildAccount</code> Capability.</p>
<p><img loading="lazy" src="/docs/assets/images/hybrid_custody_conceptual_overview-975cb40510eeea3228a84e5d0ba5bb89.png" alt="HybridCustody Conceptual Overview" width="2240" height="1828" class="img_ev3q"></p>
<p>Likewise, the child account&#x27;s <code>ChildAccount.parentAddress</code> (which owns a <code>Manager</code>) points to the user&#x27;s account as its
parent address. This makes it easy to both identify whether an account is a parent, child, or both, and its associated
parent/child account(s).</p>
<p><code>OwnedAccount</code> resources underly all account delegations, so can have multiple parents whereas <code>ChildAccount</code>s are 1:1.
This provides more granular revocation as each parent account has its own Capability path on which its access relies.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="restricted-vs-owned-accounts">Restricted vs. Owned Accounts<a href="#restricted-vs-owned-accounts" class="hash-link" aria-label="Direct link to Restricted vs. Owned Accounts" title="Direct link to Restricted vs. Owned Accounts">​</a></h3>
<p>It&#x27;s worth noting here that <code>ChildAccount</code> Capabilities enable access to the underlying account according to rules
configured by the child account delegating access. The <code>ChildAccount</code> maintains these rules along with an <code>OwnedAccount</code>
Capability within which the <code>AuthAccount</code> Capability is stored. Anyone with access to the surface level <code>ChildAccount</code>
can then access the underlying <code>AuthAccount</code>, but only according the pre-defined rule set. These rules are fundamentally
a list of Types that can/cannot be retrieved from an account.</p>
<p>The app developer can codify these rule sets on allowable Capability types in a
<a href="https://testnet.contractbrowser.com/A.96b15ff6dfde11fe.CapabilityFilter" target="_blank" rel="noopener noreferrer"><code>CapabilityFilter</code></a> along with a
<a href="https://testnet.contractbrowser.com/A.96b15ff6dfde11fe.CapabilityFactory" target="_blank" rel="noopener noreferrer"><code>CapabilityFactory</code></a> defining retrieval
patterns for those Capabilities. When delegation occurs, the developer would provide the <code>CapabilityFilter</code> and
<code>CapabilityFactory</code> Capabilities to an <code>OwnedAccount</code> resource which stores them in a <code>ChildAccount</code> resource.  Then,
capabilities are created for the <code>OwnedAccount</code> and <code>ChildAccount</code> resource and are given to the specified parent
account.</p>
<p>So, if an app developer wants to enable Hybrid Custody but doesn&#x27;t want to allow parent accounts to access FungibleToken
Vaults, for example, the app developer can codify rule sets enumerating allowable Capability types in a
<code>CapabilityFilter</code> along with a <code>CapabilityFactory</code> defining retrieval patterns for those Capabilities.</p>
<p>When delegation occurs, they would provide the <code>CapabilityFilter</code> and <code>CapabilityFactory</code> Capabilities to an
<code>OwnedAccount</code>. This <code>OwnedAccount</code> then wraps the given filter &amp; factory Capabilities in a <code>ChildAccount</code> along with a
Capability to itself before publishing the new <code>ChildAccount</code> Capability for the specified parent account to claim.</p>
<div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_vXIg"><p>Note that by enumerating allowable Types in your <code>CapabilityFilter.Filter</code> implementation, you&#x27;re by default excluding
access to anything other than the Types you declare as allowable.</p></div></div>
<p>As mentioned earlier, <code>Manager</code>s also maintain access to &quot;owned&quot; accounts - accounts which define unrestricted access as
they allow direct retrieval of encapsulated AuthAccount objects. These owned accounts, found in <code>Manager.ownedAccounts</code>,
are simply <code>OwnedAccount</code> Capabilities instead of <code>ChildAccount</code> Capabilities.</p>
<p><img loading="lazy" src="/docs/assets/images/hybrid_custody_low_level-10bdf2339a83715b9c2752366df5e002.png" alt="HybridCustody Total Overview" width="6368" height="4840" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="considerations">Considerations<a href="#considerations" class="hash-link" aria-label="Direct link to Considerations" title="Direct link to Considerations">​</a></h2>
<p>Do note that this construction does not prevent an account from having multiple parent accounts or a child account from
being the parent to other accounts. While initial intuition might lead one to believe that account associations are a
tree with the user at the root, the graph of associated accounts among child accounts may lead to cycles of association.</p>
<p>We believe it would be unlikely for a use case to demand a user delegates authority over their main account (in fact
we&#x27;d discourage such constructions), but delegating access between child accounts could be useful. As an example,
consider a set of local game clients across mobile and web platforms, each with self-custodied app accounts having
delegated authority to each other while both are child accounts of the user&#x27;s main account.</p>
<p>Ultimately, it will be up to the implementing wallet/marketplace how far down the graph of account associations they&#x27;d
want to traverse and display to the user.</p>
<h1>Implementation</h1>
<p>From the perspective of a wallet or marketplace dapp, some relevant things to know about the user are:</p>
<ul>
<li>Does this account have associated linked (child) accounts?</li>
<li>What are those associated linked accounts, if any?</li>
<li>What NFTs are owned by this user across all associated accounts?</li>
<li>What are the balances of all FungibleTokens across all associated accounts?</li>
</ul>
<p>And with respect to acting on the assets of child accounts and managing child accounts themselves:</p>
<ul>
<li>Accessing an NFT from a linked account&#x27;s Collection</li>
<li>Removing a linked account</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-whether-an-address-has-associated-accounts">Query Whether an Address Has Associated Accounts<a href="#query-whether-an-address-has-associated-accounts" class="hash-link" aria-label="Direct link to Query Whether an Address Has Associated Accounts" title="Direct link to Query Whether an Address Has Associated Accounts">​</a></h3>
<p>This script will return <code>true</code> if a <code>HybridCustody.Manager</code> is stored and <code>false</code> otherwise</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="get_child_addresses.cdc" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>get_child_addresses.cdc</div></div><div style="flex:1;min-width:0.8em"></div><button type="button" title="Copy code" class="ch-editor-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>import &quot;HybridCustody&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>pub fun main(parent: Address): Bool {</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    let acct = getAuthAccount(parent)</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    if let manager = acct.borrow&lt;&amp;HybridCustody.Manager&gt;(from: HybridCustody.ManagerStoragePath) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>        return manager.getChildAddresses().length &gt; 0</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    return false</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-all-accounts-associated-with-address">Query All Accounts Associated with Address<a href="#query-all-accounts-associated-with-address" class="hash-link" aria-label="Direct link to Query All Accounts Associated with Address" title="Direct link to Query All Accounts Associated with Address">​</a></h3>
<p>The following script will return an array of addresses associated with a given account&#x27;s address, inclusive of the
provided address.</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="get_child_addresses.cdc" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>get_child_addresses.cdc</div></div><div style="flex:1;min-width:0.8em"></div><button type="button" title="Copy code" class="ch-editor-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>import &quot;HybridCustody&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>pub fun main(parent: Address): [Address] {</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    let acct = getAuthAccount(parent)</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    let manager = acct.borrow&lt;&amp;HybridCustody.Manager&gt;(from: HybridCustody.ManagerStoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>        ?? panic(&quot;manager not found&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    return manager.getChildAddresses() // Could also call getOwnedAddresses() for owned account addresses</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-all-owned-nft-metadata">Query All Owned NFT Metadata<a href="#query-all-owned-nft-metadata" class="hash-link" aria-label="Direct link to Query All Owned NFT Metadata" title="Direct link to Query All Owned NFT Metadata">​</a></h3>
<p>While it is possible to iterate over the storage of all associated accounts in a single script, memory limits prevent
this approach from scaling well.</p>
<p>Since some accounts hold thousands of NFTs, we recommend breaking up iteration, utilizing several queries to iterate
over accounts and the storage of each account. Batching queries on individual accounts may even be required based on the
number of NFTs held.</p>
<ol>
<li>Get all associated account addresses (see above)</li>
<li>Looping over each associated account address client-side, get each address&#x27;s owned NFT metadata</li>
</ol>
<p>For simplicity, we&#x27;ll show a condensed query, returning NFT display views from all accounts associated with a given
address for a specified NFT Collection path.</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="get_nft_display_view_from_public.cdc" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>get_nft_display_view_from_public.cdc</div></div><div style="flex:1;min-width:0.8em"></div><button type="button" title="Copy code" class="ch-editor-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>import &quot;NonFungibleToken&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>import &quot;MetadataViews&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>import &quot;HybridCustody&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>/// Returns resolved Display from given address at specified path for each ID or nil if ResolverCollection is not found</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>///</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>pub fun getViews(_ address: Address, _ resolverCollectionPath: PublicPath): {UInt64: MetadataViews.Display} {</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    let account: PublicAccount = getAccount(address)</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    let views: {UInt64: MetadataViews.Display} = {}</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    // Borrow the Collection</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    if let collection = account</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>        .getCapability&lt;&amp;{NonFungibleToken.CollectionPublic, MetadataViews.ResolverCollection}&gt;(resolverCollectionPath).borrow() {</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>        // Iterate over IDs &amp; resolve the view</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>        for id in collection.getIDs() {</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>            if let display = collection.borrowViewResolver(id: id).resolveView(Type&lt;MetadataViews.Display&gt;()) as? MetadataViews.Display {</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>                views.insert(key: id, display)</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>            }</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    return views</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>/// Queries for MetadataViews.Display each NFT across all associated accounts from Collections at the provided</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>/// PublicPath</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>///</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>pub fun main(address: Address, resolverCollectionPath: PublicPath): {Address: {UInt64: MetadataViews.Display}} {</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    let allViews: {Address: {UInt64: MetadataViews.Display}} = {address: getViews(address, resolverCollectionPath)}</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    let seen: [Address] = [address]</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    /* Iterate over any associated accounts */ </span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    //</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    if let managerRef = getAuthAccount(address).borrow&lt;&amp;HybridCustody.Manager&gt;(from: HybridCustody.ManagerStoragePath) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>        </span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>        for childAccount in managerRef.getChildAddresses() {</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>            allViews.insert(key: childAccount, getViews(address, resolverCollectionPath))</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>            seen.append(childAccount)</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>        for ownedAccount in managerRef.getOwnedAddresses() {</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>            if seen.contains(ownedAccount) == false {</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>                allViews.insert(key: ownedAccount, getViews(address, resolverCollectionPath))</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>                seen.append(ownedAccount)</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>            }</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>    return allViews </span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div>
<p>At the end of this query, the caller will have a mapping of <code>Display</code> views indexed on the NFT ID and grouped by account
Address. Note that this script does not take batching into consideration and assumes that each NFT resolves the
<code>MetadataViews.Display</code> view type.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-all-account-fungibletoken-balances">Query All Account FungibleToken Balances<a href="#query-all-account-fungibletoken-balances" class="hash-link" aria-label="Direct link to Query All Account FungibleToken Balances" title="Direct link to Query All Account FungibleToken Balances">​</a></h3>
<p>Similar to the previous example, we recommend breaking up this task due to memory limits.</p>
<ol>
<li>Get all linked account addresses (see above)</li>
<li>Looping over each associated account address client-side, get each address&#x27;s owned FungibleToken Vault metadata</li>
</ol>
<p>However, we&#x27;ll condense both of these steps down into one script for simplicity:</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="get_all_vault_bal_from_storage.cdc" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>get_all_vault_bal_from_storage.cdc</div></div><div style="flex:1;min-width:0.8em"></div><button type="button" title="Copy code" class="ch-editor-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>import &quot;FungibleToken&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>import &quot;MetadataViews&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>import &quot;HybridCustody&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>/// Returns a mapping of balances indexed on the Type of resource containing the balance</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>///</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>pub fun getAllBalancesInStorage(_ address: Address): {Type: UFix64} {</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    // Get the account</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    let account: AuthAccount = getAuthAccount(address)</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    // Init for return value</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    let balances: {Type: UFix64} = {}</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    // Track seen Types in array</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    let seen: [Type] = []</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    // Assign the type we&#x27;ll need</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    let balanceType: Type = Type&lt;@{FungibleToken.Balance}&gt;()</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    // Iterate over all stored items &amp; get the path if the type is what we&#x27;re looking for</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    account.forEachStored(fun (path: StoragePath, type: Type): Bool {</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>        if type.isInstance(balanceType) || type.isSubtype(of: balanceType) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>            // Get a reference to the resource &amp; its balance</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>            let vaultRef = account.borrow&lt;&amp;{FungibleToken.Balance}&gt;(from: path)!</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>            // Insert a new values if it&#x27;s the first time we&#x27;ve seen the type</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>            if !seen.contains(type) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>                balances.insert(key: type, vaultRef.balance)</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>            } else {</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>                // Otherwise just update the balance of the vault (unlikely we&#x27;ll see the same type twice in</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>                // the same account, but we want to cover the case)</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>                balances[type] = balances[type]! + vaultRef.balance</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>            }</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>        return true</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    })</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    return balances</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>/// Queries for FT.Vault balance of all FT.Vaults in the specified account and all of its associated accounts</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>///</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>pub fun main(address: Address): {Address: {Type: UFix64}} {</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    // Get the balance for the given address</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    let balances: {Address: {Type: UFix64}} = { address: getAllBalancesInStorage(address) }</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    // Tracking Addresses we&#x27;ve come across to prevent overwriting balances (more efficient than checking dict entries (?))</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    let seen: [Address] = [address]</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    /* Iterate over any associated accounts */ </span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    //</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    if let managerRef = getAuthAccount(address)</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>        .borrow&lt;&amp;HybridCustody.Manager&gt;(from: HybridCustody.ManagerStoragePath) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>        </span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>        for childAccount in managerRef.getChildAddresses() {</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>            balances.insert(key: childAccount, getAllBalancesInStorage(address))</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>            seen.append(childAccount)</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>        for ownedAccount in managerRef.getOwnedAddresses() {</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>            if seen.contains(ownedAccount) == false {</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>                balances.insert(key: ownedAccount, getAllBalancesInStorage(address))</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>                seen.append(ownedAccount)</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>            }</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>    return balances </span></div></div><div><span class="ch-code-line-number">_<!-- -->63</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div>
<p>The above script returns a dictionary of balances indexed on the type and further grouped by account Address.</p>
<p>The returned data at the end of address iteration should be sufficient to achieve a unified balance of all Vaults of
similar types across all of a user&#x27;s associated account as well as a more granular per account view.</p>
<p>You might consider resolving
<a href="https://github.com/onflow/flow-ft/blob/master/contracts/FungibleTokenMetadataViews.cdc" target="_blank" rel="noopener noreferrer"><code>FungibleTokenMetadataViews</code></a>
to aggregate more information about the underlying Vaults.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="access-nft-in-child-account-from-parent-account">Access NFT in Child Account from Parent Account<a href="#access-nft-in-child-account-from-parent-account" class="hash-link" aria-label="Direct link to Access NFT in Child Account from Parent Account" title="Direct link to Access NFT in Child Account from Parent Account">​</a></h3>
<p>A user with NFTs in their child accounts will likely want to utilize said NFTs. In this example, the user will sign a
transaction a transaction with their authenticated account that retrieves a reference to a child account&#x27;s
<code>NonFungibleToken.Provider</code>, enabling withdrawal from the child account having signed with the parent account.</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="withdraw_nft_from_child.cdc" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>withdraw_nft_from_child.cdc</div></div><div style="flex:1;min-width:0.8em"></div><button type="button" title="Copy code" class="ch-editor-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>import &quot;NonFungibleToken&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>import &quot;FlowToken&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>import &quot;HybridCustody&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>transaction(childAddress: Address, providerPath: PrivatePath, withdrawID: UInt64) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>    let providerRef: &amp;{NonFungibleToken.Provider}</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>    prepare(signer: AuthAccount) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        // Get a reference to the signer&#x27;s HybridCustody.Manager from storage</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        let managerRef: &amp;HybridCustody.Manager = signer.borrow&lt;&amp;HybridCustody.Manager&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>                from: HybridCustody.ManagerStoragePath</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>            ) ?? panic(&quot;Could not borrow reference to HybridCustody.Manager in signer&#x27;s account at expected path!&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        </span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        // Borrow a reference to the signer&#x27;s specified child account</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        let account: &amp;{AccountPrivate, AccountPublic, MetadataViews.Resolver}? = managerRef</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>            .borrowAccount(addr: childAddress)</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>            ?? panic(&quot;Signer does not have access to specified child account&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        </span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        // Get a reference to the child NFT Provider and assign to the transaction scope variable</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        let cap: Capability = account.getCapability(</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>                path: providerPath,</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>                type: Type&lt;&amp;{NonFungibleToken.Provider}&gt;()</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>            ) ?? panic(&quot;Cannot access NonFungibleToken.Provider from this child account&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        </span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        // We&#x27;ll need to cast the Capability - this is possible thanks to CapabilityFactory, though we&#x27;ll rely on the relevant</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        // Factory having been configured for this Type or it won&#x27;t be castable</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        self.providerRef = cap as! Capability&lt;&amp;{NonFungibleToken.Provider}&gt;</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>    execute {</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        // Withdraw the NFT from the Collection</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        let nft &lt;- self.providerRef.withdraw(withdrawID: withdrawID)</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        // Do stuff with the NFT</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>        // ...</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->37</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div>
<p>At the end of this transaction, you withdrew an NFT from the specified account using an NFT <code>Provider</code> Capability. A
similar approach could get you any allowable Capabilities from a signer&#x27;s child account.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="revoking-secondary-access-on-a-linked-account">Revoking Secondary Access on a Linked Account<a href="#revoking-secondary-access-on-a-linked-account" class="hash-link" aria-label="Direct link to Revoking Secondary Access on a Linked Account" title="Direct link to Revoking Secondary Access on a Linked Account">​</a></h3>
<p>The expected uses of child accounts for progressive onboarding implies that they will be accounts with shared access. A
user may decide that they no longer want secondary parties to have access to the child account.</p>
<p>There are two ways a party can have delegated access to an account - keys and AuthAccount Capability. With
<code>ChildAccount</code> mediated access, a user wouldn&#x27;t be able to revoke anyone&#x27;s access except for their own. With
unrestricted access via <code>OwnedAccount</code>, one could remove parents (<code>OwnedAccount.removeParent(parent: Address)</code>) thereby
unlinking relevant Capabilities and further destroying their <code>ChildAccount</code> and <code>CapabilityDelegator</code> resources.</p>
<p>Ultimately, things are not entirely straightforward with respect to <code>AuthAccount</code> Capabilities, at least not until
Capability Controllers enter the picture. This is discussed in more detail in <a href="https://forum.onflow.org/t/account-linking-authaccount-capabilities-management/4314" target="_blank" rel="noopener noreferrer">the
Flip</a>. For now, we recommend that
if users want to revoke secondary access, they transfer any assets from the relevant child account and remove it from
their <code>Manager</code> altogether.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="remove-a-child-account">Remove a Child Account<a href="#remove-a-child-account" class="hash-link" aria-label="Direct link to Remove a Child Account" title="Direct link to Remove a Child Account">​</a></h3>
<p>As mentioned above, if a user no longer wishes to share access with another party, it&#x27;s recommended that desired assets
be transferred from that account to either their main account or other linked accounts and the linked account be removed
from their <code>HybridCustody.Manager</code>. Let&#x27;s see how to complete that removal.</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="remove_child_account.cdc" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>remove_child_account.cdc</div></div><div style="flex:1;min-width:0.8em"></div><button type="button" title="Copy code" class="ch-editor-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>import &quot;HybridCustody&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>transaction(child: Address) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    prepare (acct: AuthAccount) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>        let manager = acct.borrow&lt;&amp;HybridCustody.Manager&gt;(from: HybridCustody.ManagerStoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>            ?? panic(&quot;manager not found&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>        manager.removeChild(addr: child)</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div>
<p>After removal, the signer no longer has delegated access to the removed account via their <code>Manager</code> and the caller is
removed as a parent of the removed child.</p>
<p>Note also that it&#x27;s possible for a child account to remove a parent. This is necessary to give application developers
and ultimately the owners of these child accounts the ability to revoke secondary access on owned accounts.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/onflow/docs/tree/main/docs/concepts/hybrid-custody/guides/account-model.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/concepts/hybrid-custody/guides/account-abstraction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Account Abstraction on Flow</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/concepts/hybrid-custody/guides/linking-accounts"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Linking Accounts</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#identifying-account-hierarchy" class="table-of-contents__link toc-highlight">Identifying Account Hierarchy</a><ul><li><a href="#restricted-vs-owned-accounts" class="table-of-contents__link toc-highlight">Restricted vs. Owned Accounts</a></li></ul></li><li><a href="#considerations" class="table-of-contents__link toc-highlight">Considerations</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a><ul><li><a href="#query-whether-an-address-has-associated-accounts" class="table-of-contents__link toc-highlight">Query Whether an Address Has Associated Accounts</a></li><li><a href="#query-all-accounts-associated-with-address" class="table-of-contents__link toc-highlight">Query All Accounts Associated with Address</a></li><li><a href="#query-all-owned-nft-metadata" class="table-of-contents__link toc-highlight">Query All Owned NFT Metadata</a></li><li><a href="#query-all-account-fungibletoken-balances" class="table-of-contents__link toc-highlight">Query All Account FungibleToken Balances</a></li><li><a href="#access-nft-in-child-account-from-parent-account" class="table-of-contents__link toc-highlight">Access NFT in Child Account from Parent Account</a></li><li><a href="#revoking-secondary-access-on-a-linked-account" class="table-of-contents__link toc-highlight">Revoking Secondary Access on a Linked Account</a></li><li><a href="#remove-a-child-account" class="table-of-contents__link toc-highlight">Remove a Child Account</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools">SDK&#x27;s &amp; Tools</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn">Learning Resources</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cadence/intro">Cadence</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts/mobile">Mobile</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tooling/fcl-js">FCL</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tooling/flow-js-testing">JS Testing Library</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tooling/flow-cli">CLI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tooling/emulator">Emulator</a></li><li class="footer__item"><a href="https://github.com/onflow/fcl-dev-wallet" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dev Wallet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tooling/vscode-extension">VS Code Extension</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/community">Ecosystem</a></li><li class="footer__item"><a href="https://port.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flow Port<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/onflow/developer-grants" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Grants<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://flow.com/flow-responsible-disclosure" target="_blank" rel="noopener noreferrer" class="footer__link-item">Responsible Disclosure<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.flowverse.co/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flowverse<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://academy.ecdao.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Emerald Academy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://floats.city/" target="_blank" rel="noopener noreferrer" class="footer__link-item">FLOATs (Attendance NFTs)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Start Building</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://play.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flow Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials/kitty-items">Kitty Items</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cadence/tutorial/first-steps">Cadence Tutorials</a></li><li class="footer__item"><a href="https://open-cadence.onflow.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cadence Cookbook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts/core-contracts">Core Contracts &amp; Standards</a></li><li class="footer__item"><a href="https://academy.ecdao.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Emerald DAO Bootcamp<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Network</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://status.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Network Status<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://flowscan.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flowscan Mainnet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://testnet.flowscan.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flowscan Testnet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts/nodes/node-operation/past-sporks">Past Sporks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts/nodes/node-operation/upcoming-sporks">Upcoming Sporks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts/nodes/node-operation">Node Operation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts/nodes/node-operation/spork">Spork Information</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/onflow" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://onflow.org/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OnFlow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://flow.com/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Flow, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.74808b24.js"></script>
<script src="/docs/assets/js/main.1d70c217.js"></script>
</body>
</html>