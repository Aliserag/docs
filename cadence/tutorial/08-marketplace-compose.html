<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-cadence/tutorial/08-marketplace-compose">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">8. Marketplace | Flow docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://onflow.github.io/docs/img/FlowDocs_Logo_FlowLogo_Horizontal_Green_BlackText.svg"><meta data-rh="true" name="twitter:image" content="https://onflow.github.io/docs/img/FlowDocs_Logo_FlowLogo_Horizontal_Green_BlackText.svg"><meta data-rh="true" property="og:url" content="https://onflow.github.io/docs/cadence/tutorial/08-marketplace-compose"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="8. Marketplace | Flow docs"><meta data-rh="true" name="description" content="In this tutorial, we&#x27;re going to create a marketplace that uses both the fungible"><meta data-rh="true" property="og:description" content="In this tutorial, we&#x27;re going to create a marketplace that uses both the fungible"><link data-rh="true" rel="icon" href="/docs/favicon.ico"><link data-rh="true" rel="canonical" href="https://onflow.github.io/docs/cadence/tutorial/08-marketplace-compose"><link data-rh="true" rel="alternate" href="https://onflow.github.io/docs/cadence/tutorial/08-marketplace-compose" hreflang="en"><link data-rh="true" rel="alternate" href="https://onflow.github.io/docs/cadence/tutorial/08-marketplace-compose" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://DKF9ZIO5WM-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Flow docs" href="/docs/opensearch.xml">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="/mixpanel.js" async onload="if (&#39;776159d170484f49f19c3c2f7339f297&#39;) {
  window.mixpanel.init(&#39;776159d170484f49f19c3c2f7339f297&#39;);

  const viwedPayload = {
    &#39;Page Name&#39;: document.title,
    &#39;Page URL&#39;: window.location.pathname,
  }
  window.mixpanel.track(&#39;Page Viewed&#39;, viwedPayload);

  const playUrl = &#39;play.onflow.org&#39;;
  const links = document.querySelectorAll(&#39;a&#39;) || [];
  const isPlayPage = Array.from(links).some((link) =&gt; link.href.includes(playUrl));

  if (isPlayPage) {
    window.mixpanel.track(&#39;Play Page Viewed&#39;, viwedPayload);
  }
  
  window.document.addEventListener(&#39;click&#39;, function (event) {
    var target = event.target;
  
    // Check if the clicked element is a link with an href attribute
    if (target.tagName === &#39;A&#39; &amp;&amp; target.hasAttribute(&#39;href&#39;)) {
      if (window.mixpanel) {
        const payload = {
          href: target.getAttribute(&#39;href&#39;),
          id: target.id,
          class: target.className,
        }
        window.mixpanel.track(&#39;Link clicked&#39;, payload);
        const isPlay = payload.href.includes(&#39;play.onflow.org&#39;);
        if (isPlay) {
          window.mixpanel.track(&#39;Play Link clicked&#39;, payload);        
        }
      }
    }
  });
}"></script><link rel="stylesheet" href="/docs/assets/css/styles.ea33c9e4.css">
<link rel="preload" href="/docs/assets/js/runtime~main.10519f8f.js" as="script">
<link rel="preload" href="/docs/assets/js/main.0febab49.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/flow-docs-logo-dark.png" alt="Flow Developer Portal Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docs/img/flow-docs-logo-light.png" alt="Flow Developer Portal Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Docs</b></a><a class="navbar__item navbar__link" href="/docs/learn">Learn</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/quickstarts">Quickstarts</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/documentation">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/onflow" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://onflow.org/discord" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/1.Learn/1.Introduction/1.Overview of Flow Blockchain">1.Learn</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/2.Try/flow-playground">2.Try</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/3.Build/1.Getting Started/1.Flow Developer Account Setup">3.Build</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/cadence">Documentation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Documentation&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/FAQ">FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/anti-patterns">Cadence Anti-Patterns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/contract-upgrades">Contract Upgrades with Incompatible Changes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/design-patterns">Cadence Design Patterns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/development">Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/goland">GoLand</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence">Introduction to Cadence</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/json-cadence-spec">JSON-Cadence Data Interchange Format</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/cadence/language">The Cadence Programming Language</a><button aria-label="Toggle the collapsible sidebar category &#x27;The Cadence Programming Language&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/measuring-time">Measuring Time In Cadence</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/releasing">Release Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/security-best-practices">Security Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/solidity-to-cadence">Guide for Solidity developers</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/cadence/styleguide/project-development-tips">styleguide</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/subtyping">subtyping</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/syntax-highlighting">Syntax Highlighting Cadence</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/testing-framework">Cadence Testing Framework</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/cadence/tutorial/01-first-steps">tutorial</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/tutorial/01-first-steps">1. First Steps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/tutorial/02-hello-world">2. Hello World</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/tutorial/03-resources">3. Resource Contract Tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/tutorial/04-capabilities">4. Capability Tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/tutorial/05-non-fungible-tokens-1">5.1 Non-Fungible Token Tutorial Part 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/tutorial/05-non-fungible-tokens-2">5.2 Non-Fungible Token Tutorial Part 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/tutorial/06-fungible-tokens">6. Fungible Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/tutorial/07-marketplace-setup">7. Marketplace Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/cadence/tutorial/08-marketplace-compose">8. Marketplace</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/tutorial/09-voting">9. Voting Contract</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/tutorial/10-resources-compose">10. Composable Resources</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cadence/why">why</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/documentation">documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/flow">Introduction to Flow</a><button aria-label="Toggle the collapsible sidebar category &#x27;Introduction to Flow&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/hybrid-custody">Hybrid Custody Overview</a><button aria-label="Toggle the collapsible sidebar category &#x27;Hybrid Custody Overview&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/mobile">Flow Mobile Overview</a><button aria-label="Toggle the collapsible sidebar category &#x27;Flow Mobile Overview&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/nodes">Hello Node Operator!</a><button aria-label="Toggle the collapsible sidebar category &#x27;Hello Node Operator!&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quickstarts">quickstarts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tools/emulator">tools</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/cadence"><span itemprop="name">Documentation</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">tutorial</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">8. Marketplace</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>8. Marketplace</h1></header><p>In this tutorial, we&#x27;re going to create a marketplace that uses both the fungible
and non-fungible token (NFTs) contracts that we have learned about in previous tutorials.
This is only for educational purposes and is not meant to be used in production
See a production-ready marketplace in the <a href="https://github.com/onflow/nft-storefront" target="_blank" rel="noopener noreferrer">NFT storefront repo.</a>
This contract is already deployed to testnet and mainnet and can be used by anyone for any generic NFT sale!</p><hr><div type="success">Open the starter code for this tutorial in the Flow Playground:<a href="https://play.onflow.org/49ec2856-1258-4675-bac3-850b4bae1929" target="_blank" rel="noopener noreferrer">https://play.onflow.org/49ec2856-1258-4675-bac3-850b4bae1929</a><br>The tutorial will be asking you to take various actions to interact with this code. [The marketplace setup guide](07-marketplace-setup) shows you how to get the playground set up to do this tutorial.</div><div type="info">Instructions that require you to take action are always included in a callout box like this one. These highlighted actions are all that you need to do to get your code running, but reading the rest is necessary to understand the language&#x27;s design.</div><p>Marketplaces are a popular application of blockchain technology and smart contracts.
When there are NFTs in existence, users usually want to be able to buy and sell them with their fungible tokens.</p><p>Now that there is an example for both fungible and non-fungible tokens,
we can build a marketplace that uses both. This is referred to as <strong>composability</strong>:
the ability for developers to leverage shared resources, such as code or userbases,
and use them as building blocks for new applications. Flow is designed to enable composability
because of the way that interfaces, resources and capabilities are designed.
<a href="/docs/cadence/language/interfaces">Interfaces</a> allow projects to support any generic type as long as it supports a standard set of functionality specified by an interface.
<a href="/docs/cadence/language/resources">Resources</a> can be passed around and owned by accounts, contracts or even other resources,
unlocking different use cases depending on where the resource is stored.
<a href="/docs/cadence/language/capability-based-access-control">Capabilities</a> allow exposing user-defined sets of functionality through special objects
that enforce strict security with Cadence&#x27;s type system.
The combination of these allows developers to do more with less, re-using known safe code and design patterns
to create new, powerful, and unique interactions!</p><div type="info"><p>At some point before or after this tutorial, you should definitely check out the formal documentation
linked above about interfaces, resources, and capabilities. It will help complete your understanding
of these complex, but powerful features.</p></div><p>To create a marketplace, we need to integrate the functionality of both fungible
and non-fungible tokens into a single contract that gives users control over their money and assets.
To accomplish this, we&#x27;re going to take you through these steps to create a composable smart contract and get comfortable with the marketplace:</p><ol><li>Ensure that your fungible token and non-fungible token contracts are deployed and set up correctly.</li><li>Deploy the marketplace type declarations to account <code>0x03</code>.</li><li>Create a marketplace object and store it in your account storage, putting an NFT up for sale and publishing a public capability for your sale.</li><li>Use a different account to purchase the NFT from the sale.</li><li>Run a script to verify that the NFT was purchased.</li></ol><p><strong>Before proceeding with this tutorial</strong>, you need to complete the <a href="/docs/cadence/tutorial/06-fungible-tokens">Fungible Tokens</a>
and <a href="/docs/cadence/tutorial/05-non-fungible-tokens-1">Non-Fungible Token</a> tutorials
to understand the building blocks of this smart contract.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="marketplace-design">Marketplace Design<a href="#marketplace-design" class="hash-link" aria-label="Direct link to Marketplace Design" title="Direct link to Marketplace Design">​</a></h2><hr><p>One way to implement a marketplace is to have a central smart contract that users deposit their NFTs and their price into,
and have anyone come by and be able to buy the token for that price.
This approach is reasonable, but it centralizes the process and takes away options from the owners.
We want users to be able to maintain ownership of the NFTs that they are trying to sell while they are trying to sell them.</p><p>Instead of taking this centralized approach, each user can list a sale from within their own account.</p><p>Then, users could either provide a link to their sale to an application that can list it centrally on a website,
or to a central sale aggregator smart contract if they want the entire transaction to stay on-chain.
This way, the owner of the token keeps custody of their token while it is on sale.</p><div type="info"><p>Before we start, we need to confirm the state of your accounts. <br>
If you haven&#x27;t already, please perform the steps in the <a href="/docs/cadence/tutorial/07-marketplace-setup">marketplace setup guide</a>
to ensure that the Fungible Token and Non-Fungible Token contracts are deployed to account 1 and 2 and own some tokens.
Your accounts should look like this:</p></div><div src="https://storage.googleapis.com/flow-resources/documentation-assets/cadence-tuts/accounts-nft-storage.png"></div><div type="info"><p>You can run the <code>1. CheckSetupScript.cdc</code> script to ensure that your accounts are correctly set up:</p></div><div class="language-cadence:title=CheckSetupScript.cdc codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cadence:title=CheckSetupScript.cdc codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// CheckSetupScript.cdc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleToken from 0x01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleNFT from 0x02</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// This script checks that the accounts are set up correctly for the marketplace tutorial.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">//</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Account 0x01: Vault Balance = 40, NFT.id = 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Account 0x02: Vault Balance = 20, No NFTs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pub fun main() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Get the accounts&#x27; public account objects</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let acct1 = getAccount(0x01)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let acct2 = getAccount(0x02)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Get references to the account&#x27;s receivers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // by getting their public capability</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // and borrowing a reference from the capability</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let acct1ReceiverRef = acct1.getCapability(/public/CadenceFungibleTokenTutorialReceiver)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          .borrow&lt;&amp;ExampleToken.Vault{ExampleToken.Balance}&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          ?? panic(&quot;Could not borrow acct1 vault reference&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let acct2ReceiverRef = acct2.getCapability(/public/CadenceFungibleTokenTutorialReceiver)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          .borrow&lt;&amp;ExampleToken.Vault{ExampleToken.Balance}&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          ?? panic(&quot;Could not borrow acct2 vault reference&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Log the Vault balance of both accounts and ensure they are</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // the correct numbers.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Account 0x01 should have 40.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Account 0x02 should have 20.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(&quot;Account 1 Balance&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(acct1ReceiverRef.balance)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(&quot;Account 2 Balance&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(acct2ReceiverRef.balance)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // verify that the balances are correct</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if acct1ReceiverRef.balance != 40.0 || acct2ReceiverRef.balance != 20.0 {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        panic(&quot;Wrong balances!&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Find the public Receiver capability for their Collections</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let acct1Capability = acct1.getCapability(ExampleNFT.CollectionPublicPath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let acct2Capability = acct2.getCapability(ExampleNFT.CollectionPublicPath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // borrow references from the capabilities</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let nft1Ref = acct1Capability.borrow&lt;&amp;{ExampleNFT.NFTReceiver}&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ?? panic(&quot;Could not borrow acct1 nft collection reference&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let nft2Ref = acct2Capability.borrow&lt;&amp;{ExampleNFT.NFTReceiver}&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ?? panic(&quot;Could not borrow acct2 nft collection reference&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Print both collections as arrays of IDs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(&quot;Account 1 NFTs&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(nft1Ref.getIDs())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(&quot;Account 2 NFTs&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(nft2Ref.getIDs())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // verify that the collections are correct</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if nft1Ref.getIDs()[0] != 1 || nft2Ref.getIDs().length != 0 {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        panic(&quot;Wrong Collections!&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You should see something similar to this output if your accounts are set up correctly.
They are in the same state that they would have been in if you followed
the <a href="/docs/cadence/tutorial/06-fungible-tokens">Fungible Tokens</a>
and <a href="/docs/cadence/tutorial/05-non-fungible-tokens-1">Non-Fungible Tokens</a> tutorials in succession:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;Account 1 Vault Balance&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">40</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;Account 2 Vault Balance&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;Account 1 NFTs&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[1]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;Account 2 NFTs&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now that your accounts are in the correct state, we can build a marketplace that enables the sale of NFT&#x27;s between accounts.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-an-nft-marketplace">Setting up an NFT <strong>Marketplace</strong><a href="#setting-up-an-nft-marketplace" class="hash-link" aria-label="Direct link to setting-up-an-nft-marketplace" title="Direct link to setting-up-an-nft-marketplace">​</a></h2><hr><p>Every user who wants to sell an NFT will store an instance of a <code>SaleCollection</code> resource in their account storage.</p><div type="info"><p>Switch to account <code>0x03</code>.
Open <code>ExampleMarketplace.cdc</code><br>
With <code>ExampleMarketplace.cdc</code> open, click the <code>Deploy</code> button that appears at the top right of the editor.
<code>ExampleMarketplace.cdc</code> should contain the following contract definition:</p></div><div class="language-cadence:title=ExampleMarketplace.cdc codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cadence:title=ExampleMarketplace.cdc codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleToken from 0x01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleNFT from 0x02</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// ExampleMarketplace.cdc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">//</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// The ExampleMarketplace contract is a very basic sample implementation of an NFT ExampleMarketplace on Flow.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">//</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// This contract allows users to put their NFTs up for sale. Other users</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// can purchase these NFTs with fungible tokens.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">//</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Learn more about marketplaces in this tutorial: https://docs.onflow.org/cadence/tutorial/08-marketplace-compose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">//</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// This contract is a learning tool and is not meant to be used in production.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// See the NFTStorefront contract for a generic marketplace smart contract that</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// is used by many different projects on the Flow blockchain:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">//</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// https://github.com/onflow/nft-storefront</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pub contract ExampleMarketplace {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Event that is emitted when a new NFT is put up for sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub event ForSale(id: UInt64, price: UFix64, owner: Address?)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Event that is emitted when the price of an NFT changes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub event PriceChanged(id: UInt64, newPrice: UFix64, owner: Address?)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Event that is emitted when a token is purchased</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub event TokenPurchased(id: UInt64, price: UFix64, seller: Address?, buyer: Address?)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Event that is emitted when a seller withdraws their NFT from the sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub event SaleCanceled(id: UInt64, seller: Address?)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Interface that users will publish for their Sale collection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // that only exposes the methods that are supposed to be public</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub resource interface SalePublic {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pub fun purchase(tokenID: UInt64, recipient: Capability&lt;&amp;AnyResource{ExampleNFT.NFTReceiver}&gt;, buyTokens: @ExampleToken.Vault)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pub fun idPrice(tokenID: UInt64): UFix64?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pub fun getIDs(): [UInt64]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // SaleCollection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // NFT Collection object that allows a user to put their NFT up for sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // where others can send fungible tokens to purchase it</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub resource SaleCollection: SalePublic {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        /// A capability for the owner&#x27;s collection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        access(self) var ownerCollection: Capability&lt;&amp;ExampleNFT.Collection&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Dictionary of the prices for each NFT by ID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        access(self) var prices: {UInt64: UFix64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // The fungible token vault of the owner of this sale.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // When someone buys a token, this resource can deposit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // tokens into their account.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        access(account) let ownerVault: Capability&lt;&amp;AnyResource{ExampleToken.Receiver}&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        init (ownerCollection: Capability&lt;&amp;ExampleNFT.Collection&gt;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              ownerVault: Capability&lt;&amp;AnyResource{ExampleToken.Receiver}&gt;) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            pre {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                // Check that the owner&#x27;s collection capability is correct</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                ownerCollection.check():</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &quot;Owner&#x27;s NFT Collection Capability is invalid!&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                // Check that the fungible token vault capability is correct</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                ownerVault.check():</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &quot;Owner&#x27;s Receiver Capability is invalid!&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self.ownerCollection = ownerCollection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self.ownerVault = ownerVault</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self.prices = {}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // cancelSale gives the owner the opportunity to cancel a sale in the collection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pub fun cancelSale(tokenID: UInt64) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // remove the price</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self.prices.remove(key: tokenID)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self.prices[tokenID] = nil</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // Nothing needs to be done with the actual token because it is already in the owner&#x27;s collection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // listForSale lists an NFT for sale in this collection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pub fun listForSale(tokenID: UInt64, price: UFix64) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            pre {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                self.ownerCollection.borrow()!.idExists(id: tokenID):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &quot;NFT to be listed does not exist in the owner&#x27;s collection&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // store the price in the price array</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self.prices[tokenID] = price</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            emit ForSale(id: tokenID, price: price, owner: self.owner?.address)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // changePrice changes the price of a token that is currently for sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pub fun changePrice(tokenID: UInt64, newPrice: UFix64) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self.prices[tokenID] = newPrice</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            emit PriceChanged(id: tokenID, newPrice: newPrice, owner: self.owner?.address)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // purchase lets a user send tokens to purchase an NFT that is for sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pub fun purchase(tokenID: UInt64, recipient: Capability&lt;&amp;AnyResource{ExampleNFT.NFTReceiver}&gt;, buyTokens: @ExampleToken.Vault) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            pre {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                self.prices[tokenID] != nil:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &quot;No token matching this ID for sale!&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                buyTokens.balance &gt;= (self.prices[tokenID] ?? 0.0):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &quot;Not enough tokens to by the NFT!&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                recipient.borrow != nil:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &quot;Invalid NFT receiver capability!&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // get the value out of the optional</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            let price = self.prices[tokenID]!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self.prices[tokenID] = nil</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            let vaultRef = self.ownerVault.borrow()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                ?? panic(&quot;Could not borrow reference to owner token vault&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // deposit the purchasing tokens into the owners vault</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            vaultRef.deposit(from: &lt;-buyTokens)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // borrow a reference to the object that the receiver capability links to</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // We can force-cast the result here because it has already been checked in the pre-conditions</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            let receiverReference = receiver.borrow()!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // deposit the NFT into the buyers collection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            receiverReference.deposit(token: &lt;-self.ownerCollection.borrow()!.withdraw(withdrawID: tokenID))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            emit TokenPurchased(id: tokenID, price: price, owner: self.owner?.address, buyer: receiverReference.owner?.address)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // idPrice returns the price of a specific token in the sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pub fun idPrice(tokenID: UInt64): UFix64? {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return self.prices[tokenID]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // getIDs returns an array of token IDs that are for sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pub fun getIDs(): [UInt64] {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return self.prices.keys</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // createCollection returns a new collection resource to the caller</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub fun createSaleCollection(ownerCollection: Capability&lt;&amp;ExampleNFT.Collection&gt;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                 ownerVault: Capability&lt;&amp;AnyResource{ExampleToken.Receiver}&gt;): @SaleCollection {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return &lt;- create SaleCollection(ownerCollection: ownerCollection, ownerVault: ownerVault)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This marketplace contract has resources that function similarly to the NFT <code>Collection</code>
that was explained in <a href="/docs/cadence/tutorial/05-non-fungible-tokens-1">Non-Fungible Tokens</a>, with a few differences and additions:</p><ul><li>This marketplace contract has methods to add and remove NFTs, but instead of storing the NFT resource object in the sale collection,
the user provides a capability to their main collection that allows the listed NFT to be withdrawn and transferred when it is purchased.
When a user wants to put their NFT up for sale, they do so by providing the ID and the price to the <code>listForSale</code> function.
Then, another user can call the <code>purchase</code> method, sending their <code>ExampleToken.Vault</code> that contains the currency they are using to make the purchase.
The buyer also includes a capability to their NFT <code>ExampleNFT.Collection</code> so that the purchased token
can be immediately deposited into their collection when the purchase is made.</li><li>This marketplace contract stores a capability: <code>pub let ownerVault: Capability&lt;&amp;AnyResource{FungibleToken.Receiver}&gt;</code>.
The owner of the sale saves a capability to their Fungible Token <code>Receiver</code> within the sale.
This allows the sale resource to be able to immediately deposit the currency that was used to buy the NFT
into the owners <code>Vault</code> when a purchase is made.</li><li>This marketplace contract includes events. Cadence supports defining events within contracts
that can be emitted when important actions happen. External apps can monitor these events to know the state of the smart contract.</li></ul><div class="language-cadence codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cadence codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Event that is emitted when a new NFT is put up for sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub event ForSale(id: UInt64, price: UFix64, owner: Address?)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Event that is emitted when the price of an NFT changes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub event PriceChanged(id: UInt64, newPrice: UFix64, owner: Address?)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Event that is emitted when a token is purchased</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub event TokenPurchased(id: UInt64, price: UFix64, seller: Address?, buyer: Address?)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Event that is emitted when a seller withdraws their NFT from the sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub event SaleCanceled(id: UInt64, seller: Address?)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This contract has a few new features and concepts that are important to cover:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="events">Events<a href="#events" class="hash-link" aria-label="Direct link to Events" title="Direct link to Events">​</a></h3><p><a href="/docs/cadence/language/events">Events</a> are special values that can be emitted during the execution of a program.
They usually contain information to indicate that some important action has happened in a smart contract,
such as an NFT transfer, a permission change, or many other different things.
Off-chain applications can monitor events using a Flow SDK to know what is happening on-chain without having to query a smart contract directly.</p><p>Many applications want to maintain an off-chain record of what is happening on-chain so they can have faster performance
when getting information about their users&#x27; accounts or generating analytics.</p><p>Events are declared by indicating <a href="/docs/cadence/language/access-control">the access level</a>, <code>event</code>,
and the name and parameters of the event, like a function declaration:</p><div class="language-cadence codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cadence codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pub event ForSale(id: UInt64, price: UFix64, owner: Address?)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Events cannot modify state at all; they indicate when important actions happen in the smart contract.</p><p>Events are emitted with the <code>emit</code> keyword followed by the invocation of the event as if it were a function call.</p><div class="language-cadence codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cadence codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">emit ForSale(id: tokenID, price: price, owner: self.owner?.address)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>External applications can monitor the blockchain to take action when certain events are emitted.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="resource-owned-capabilities">Resource-Owned Capabilities<a href="#resource-owned-capabilities" class="hash-link" aria-label="Direct link to Resource-Owned Capabilities" title="Direct link to Resource-Owned Capabilities">​</a></h3><p>We have covered capabilities in previous <a href="/docs/cadence/tutorial/04-capabilities">tutorials</a>,
but only the basics. Capabilities can be used for so much more!</p><p>As you hopefully understand, <a href="/docs/cadence/language/capability-based-access-control">capabilites</a>
are links to private objects in account storage that specify subset of functionality to expose.</p><p>To create a capability, a user typically uses <a href="/docs/cadence/language/accounts#authaccount">the <code>AuthAccount.link</code></a>
method to create a link to a resource in their private storage, specifying a type to link the capability as:</p><div class="language-cadence codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cadence codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Create a public Receiver + Balance capability to the Vault</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// acct is an `AuthAccount`</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// The object being linked to has to be an `ExampleToken.Vault`,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// and the link only exposes the fields in the `ExampleToken.Receiver` and `ExampleToken.Balance` interfaces.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">acct.link&lt;&amp;ExampleToken.Vault{ExampleToken.Receiver, ExampleToken.Balance}&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (/public/CadenceFungibleTokenTutorialReceiver, target: /storage/CadenceFungibleTokenTutorialVault)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, users can get that capability if it was created <a href="/docs/cadence/language/accounts#paths">in a public path</a>,
borrow it, and access the functionality that the owner specified.</p><div class="language-cadence codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cadence codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Get account 0x01&#x27;s PublicAccount object</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">let publicAccount = getAccount(0x01)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Retrieve public Vault Receiver reference for the account</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">let acct1Capability = acct.getCapability&lt;&amp;AnyResource{ExampleToken.Receiver}&gt;(/public/CadenceFungibleTokenTutorialReceiver)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// borrow the reference</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">let acct1ReceiverRef = acct1Capability.borrow()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ?? panic(&quot;Could not borrow a receiver reference to the vault&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// deposit tokens</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">acct1ReceiverRef.deposit(from: &lt;-tokens)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With the marketplace contract, we are utilizing a new feature of capabilities.
Capabilities can be stored anywhere! Lots of functionality is contained within resources,
and developers will sometimes want to be able to access some of the functionality of resources from within different resources or contracts.</p><p>We store two different capabilities in the marketplace sale collection:</p><div class="language-cadence codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cadence codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">/// A capability for the owner&#x27;s collection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">access(self) var ownerCollection: Capability&lt;&amp;ExampleNFT.Collection&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// The fungible token vault of the owner of this sale.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// When someone buys a token, this resource can deposit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// tokens into their account.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">access(account) let ownerVault: Capability&lt;&amp;AnyResource{ExampleToken.Receiver}&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If an object like a contract or resource owns a capability, they can borrow a reference to that capability at any time
to access that functionality without having to get it from the owner&#x27;s account every time.</p><p>This is especially important if the owner wants to expose some functionality that is only intended for one person,
meaning that the link for the capability is not stored in a public path.
We do that in this example, because the sale collection stores a capability that can access all of the functionality
of the <code>ExampleNFT.Collection</code>. It needs this because it withdraws the specified NFT in the <code>purchase()</code> method to send to the buyer.</p><p>It is important to remember that control of a capability does not equal ownership of the underlying resource.
You can use the capability to access that resource&#x27;s functionality, but you can&#x27;t use it to fake ownership.
You need the actual resource with the <code>@</code> symbol specified to prove ownership.</p><p>Additionally, these capabilities can be stored anywhere, but if a user decides that they no longer want the capability
to be used, they can revoke it with the <code>AuthAccount.unlink()</code> method so any capabilities that use that link are rendered invalid.</p><p>One last piece to consider about capabilities is the decision about when to use them instead of storing the resource directly.
This tutorial used to have the <code>SaleCollection</code> directly store the NFTs that were for sale, like so:</p><div class="language-cadence codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cadence codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pub resource SaleCollection: SalePublic {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    /// Dictionary of NFT objects for sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    /// Maps ID to NFT resource object</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    /// Not recommended</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    access(self) var forSale: @{UInt64: ExampleNFT.NFT}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is a logical way to do it, and illustrates another important concept in Cadence, that resources can own other resources!
Check out the <a href="/docs/cadence/tutorial/10-resources-compose">Kitty Hats tutorial</a> for a little more exploration of this concept.</p><p>In this case however, it doesn&#x27;t make sense. If a user decides to store their for-sale NFTs in a separate place from their main collection,
then, those NFTs are not available to be shown to any app or smart contract that queries the main collection,
so it is as if the owner doesn&#x27;t actually own the NFT! In cases like this, we usually recommend using a capability to the main
collection so that the main collection can remain unchanged and fully usable by other smart contracts and apps.
This also means that if a for-sale NFT gets transferred by some means other than a purchase, then you need a way to get rid of the stale listing.
That is out of the scope of this tutorial though.</p><p>Enough explaining! Lets execute some code!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-and-using-the-marketplace">Deploying and using the Marketplace<a href="#deploying-and-using-the-marketplace" class="hash-link" aria-label="Direct link to Deploying and using the Marketplace" title="Direct link to Deploying and using the Marketplace">​</a></h2><p>At this point, we should have an <code>ExampleToken.Vault</code> and an <code>Example.NFT.Collection</code> in both accounts&#x27; storage.
Account <code>0x01</code> should have an NFT in their collection.</p><p>You can create a <code>SaleCollection</code> and list account <code>0x01</code>&#x27;s token for sale by following these steps:</p><div type="info"><p>Open Transaction 4, <code>CreateSale.cdc</code> <br>
Select account <code>0x01</code> as the only signer and click the <code>Send</code> button to submit the transaction.</p></div><div class="language-cadence:title=Transaction4.cdc codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cadence:title=Transaction4.cdc codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// CreateSale.cdc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleToken from 0x01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleNFT from 0x02</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleMarketplace from 0x03</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// This transaction creates a new Sale Collection object,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// lists an NFT for sale, puts it in account storage,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// and creates a public capability to the sale so that others can buy the token.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">transaction {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    prepare(acct: AuthAccount) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Borrow a reference to the stored Vault</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        let receiver = acct.getCapability&lt;&amp;{ExampleToken.Receiver}&gt;(/public/CadenceFungibleTokenTutorialReceiver)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // borrow a reference to the nftTutorialCollection in storage</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        let collectionCapability = acct.link&lt;&amp;ExampleNFT.Collection&gt;(/private/nftTutorialCollection, target: ExampleNFT.CollectionStoragePath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          ?? panic(&quot;Unable to create private link to NFT Collection&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Create a new Sale object,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // initializing it with the reference to the owner&#x27;s vault</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        let sale &lt;- ExampleMarketplace.createSaleCollection(ownerCollection: collectionCapability, ownerVault: receiver)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // List the token for sale by moving it into the sale object</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sale.listForSale(tokenID: 1, price: 10.0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Store the sale object in the account storage</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        acct.save(&lt;-sale, to: /storage/NFTSale)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Create a public capability to the sale so that others can call its methods</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        acct.link&lt;&amp;ExampleMarketplace.SaleCollection{ExampleMarketplace.SalePublic}&gt;(/public/NFTSale, target: /storage/NFTSale)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        log(&quot;Sale Created for account 1. Selling NFT 1 for 10 tokens&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This transaction:</p><ol><li>Gets a capability for the owners <code>Vault</code></li><li>Creates the <code>SaleCollection</code>, which stores their <code>Vault</code> capability.</li><li>Lists the token with ID=1 for sale and sets its price as 10.0.</li><li>Stores the sale in their account storage and publishes a capability that allows others to purchase any NFTs for sale.</li></ol><p>Let&#x27;s run a script to ensure that the sale was created correctly.</p><div type="info"><p>Open Script 2: <code>GetSaleIDs.cdc</code><br>
Click the <code>Execute</code> button to print the ID and price of the NFT that account <code>0x01</code> has for sale.</p></div><div class="language-cadence:title=GetSaleIDs.cdc codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cadence:title=GetSaleIDs.cdc codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// GetSaleIDs.cdc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleToken from 0x01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleNFT from 0x02</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleMarketplace from 0x03</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// This script prints the NFTs that account 0x01 has for sale.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pub fun main() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Get the public account object for account 0x01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let account1 = getAccount(0x01)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Find the public Sale reference to their Collection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let acct1saleRef = account1.getCapability(/public/NFTSale)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       .borrow&lt;&amp;AnyResource{ExampleMarketplace.SalePublic}&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       ?? panic(&quot;Could not borrow acct2 nft sale reference&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Los the NFTs that are for sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(&quot;Account 1 NFTs for sale&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(acct1saleRef.getIDs())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(&quot;Price&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(acct1saleRef.idPrice(tokenID: 1))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This script should complete and print something like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;Account 1 NFTs for sale&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[1]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;Price&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="purchasing-an-nft">Purchasing an NFT<a href="#purchasing-an-nft" class="hash-link" aria-label="Direct link to Purchasing an NFT" title="Direct link to Purchasing an NFT">​</a></h2><hr><p>The buyer can now purchase the seller&#x27;s NFT by using the transaction in <code>Transaction2.cdc</code>.</p><div type="info"><p>Open Transaction 2: <code>PurchaseSale.cdc</code> file<br>
Select account <code>0x02</code> as the only signer and click the <code>Send</code> button.</p></div><div class="language-cadence:title=PurchaseSale.cdc codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cadence:title=PurchaseSale.cdc codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// PurchaseSale.cdc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleToken from 0x01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleNFT from 0x02</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleMarketplace from 0x03</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// This transaction uses the signers Vault tokens to purchase an NFT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// from the Sale collection of account 0x01.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">transaction {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Capability to the buyer&#x27;s NFT collection where they</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // will store the bought NFT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let collectionCapability: Capability&lt;&amp;AnyResource{ExampleNFT.NFTReceiver}&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Vault that will hold the tokens that will be used to</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // but the NFT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let temporaryVault: @ExampleToken.Vault</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    prepare(acct: AuthAccount) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // get the references to the buyer&#x27;s fungible token Vault and NFT Collection Receiver</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self.collectionCapability = acct.getCapability&lt;&amp;AnyResource{ExampleNFT.NFTReceiver}&gt;(from: ExampleNFT.CollectionPublicPath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        let vaultRef = acct.borrow&lt;&amp;ExampleToken.Vault&gt;(from: /storage/CadenceFungibleTokenTutorialVault)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ?? panic(&quot;Could not borrow owner&#x27;s vault reference&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // withdraw tokens from the buyers Vault</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self.temporaryVault &lt;- vaultRef.withdraw(amount: 10.0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    execute {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // get the read-only account storage of the seller</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        let seller = getAccount(0x01)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // get the reference to the seller&#x27;s sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        let saleRef = seller.getCapability(/public/NFTSale)!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            .borrow&lt;&amp;AnyResource{ExampleMarketplace.SalePublic}&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            ?? panic(&quot;Could not borrow seller&#x27;s sale reference&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // purchase the NFT the seller is selling, giving them the capability</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // to your NFT collection and giving them the tokens to buy it</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        saleRef.purchase(tokenID: 1, recipient: self.collectionCapability, buyTokens: &lt;-self.temporaryVault)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        log(&quot;Token 1 has been bought by account 2!&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This transaction:</p><ol><li>Gets the public account object for account <code>0x01</code></li><li>Gets the capability to the buyer&#x27;s NFT receiver</li><li>Borrow&#x27;s a reference to the buyer&#x27;s stored <code>ExampleToken.Vault</code></li><li>Withdraws the tokens that the buyer will use to purchase the NFT</li><li>Gets the reference to the seller&#x27;s public sale</li><li>Calls the <code>purchase</code> function, passing in the tokens and the <code>Collection</code> reference.
Then <code>purchase</code> deposits the bought NFT directly into the buyer&#x27;s collection.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="verifying-the-nft-was-purchased-correctly">Verifying the NFT Was Purchased Correctly<a href="#verifying-the-nft-was-purchased-correctly" class="hash-link" aria-label="Direct link to Verifying the NFT Was Purchased Correctly" title="Direct link to Verifying the NFT Was Purchased Correctly">​</a></h2><hr><p>You can run now run a script to verify that the NFT was purchased correctly because:</p><ul><li>account <code>0x01</code> has 50 tokens and does not have any NFTs for sale or in their collection and account</li><li>account <code>0x02</code> has 10 tokens and an NFT with id=1</li></ul><p>To run a script that verifies the NFT was purchased correctly, follow these steps:</p><div type="info">Open Script 3: `VerifyAfterPurchase.cdc`.<br>Click `Execute` button `VerifyAfterPurchase.cdc` should contain the following code:</div><div class="language-cadence:title=Script3.cdc codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cadence:title=Script3.cdc codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// VerifyAfterPurchase.cdc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleToken from 0x01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleNFT from 0x02</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import ExampleMarketplace from 0x03</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// This script checks that the Vault balances and NFT collections are correct</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// for both accounts.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">//</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Account 1: Vault balance = 50, No NFTs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Account 2: Vault balance = 10, NFT ID=1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pub fun main() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Get the accounts&#x27; public account objects</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let acct1 = getAccount(0x01)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let acct2 = getAccount(0x02)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Get references to the account&#x27;s receivers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // by getting their public capability</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // and borrowing a reference from the capability</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let acct1ReceiverRef = acct1.getCapability(/public/CadenceFungibleTokenTutorialReceiver)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                           .borrow&lt;&amp;ExampleToken.Vault{ExampleToken.Balance}&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                           ?? panic(&quot;Could not borrow acct1 vault reference&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let acct2ReceiverRef = acct2.getCapability(/public/CadenceFungibleTokenTutorialReceiver)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            .borrow&lt;&amp;ExampleToken.Vault{ExampleToken.Balance}&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            ?? panic(&quot;Could not borrow acct2 vault reference&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Log the Vault balance of both accounts and ensure they are</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // the correct numbers.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Account 0x01 should have 50.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Account 0x02 should have 10.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(&quot;Account 1 Balance&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(acct1ReceiverRef.balance)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(&quot;Account 2 Balance&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(acct2ReceiverRef.balance)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // verify that the balances are correct</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if acct1ReceiverRef.balance != 50.0 || acct2ReceiverRef.balance != 10.0 {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        panic(&quot;Wrong balances!&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Find the public Receiver capability for their Collections</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let acct1Capability = acct1.getCapability(ExampleNFT.CollectionPublicPath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let acct2Capability = acct2.getCapability(ExampleNFT.CollectionPublicPath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // borrow references from the capabilities</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let nft1Ref = acct1Capability.borrow&lt;&amp;{ExampleNFT.NFTReceiver}&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ?? panic(&quot;Could not borrow acct1 nft collection reference&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let nft2Ref = acct2Capability.borrow&lt;&amp;{ExampleNFT.NFTReceiver}&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ?? panic(&quot;Could not borrow acct2 nft collection reference&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Print both collections as arrays of IDs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(&quot;Account 1 NFTs&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(nft1Ref.getIDs())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(&quot;Account 2 NFTs&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(nft2Ref.getIDs())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // verify that the collections are correct</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if nft2Ref.getIDs()[0] != 1 || nft1Ref.getIDs().length != 0 {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        panic(&quot;Wrong Collections!&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Get the public sale reference for Account 0x01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let acct1SaleRef = acct1.getCapability(/public/NFTSale)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       .borrow&lt;&amp;AnyResource{ExampleMarketplace.SalePublic}&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       ?? panic(&quot;Could not borrow acct1 nft sale reference&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Print the NFTs that account 0x01 has for sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(&quot;Account 1 NFTs for sale&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log(acct1SaleRef.getIDs())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if acct1SaleRef.getIDs().length != 0 { panic(&quot;Sale should be empty!&quot;) }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you did everything correctly, the transaction should succeed and it should print something similar to this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;Account 1 Vault Balance&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">50</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;Account 2 Vault Balance&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;Account 1 NFTs&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;Account 2 NFTs&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[1]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;Account 1 NFTs for Sale&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Congratulations, you have successfully implemented a simple marketplace in Cadence and used it to allow one account to buy an NFT from another!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="scaling-the-marketplace">Scaling the Marketplace<a href="#scaling-the-marketplace" class="hash-link" aria-label="Direct link to Scaling the Marketplace" title="Direct link to Scaling the Marketplace">​</a></h2><hr><p>A user can hold a sale in their account with these resources and transactions.
Support for a central marketplace where users can discover sales is relatively easy to implement and can build on what we already have.
If we wanted to build a central marketplace on-chain, we could use a contract that looks something like this:</p><div class="language-cadence:title=CentralMarketplace.cdc codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cadence:title=CentralMarketplace.cdc codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Marketplace would be the central contract where people can post their sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// references so that anyone can access them</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pub contract Marketplace {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Data structure to store active sales</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub var tokensForSale: {Address: Capability&lt;&amp;SaleCollection&gt;)}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // listSaleCollection lists a users sale reference in the array</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // and returns the index of the sale so that users can know</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // how to remove it from the marketplace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub fun listSaleCollection(collection: Capability&lt;&amp;SaleCollection&gt;) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        let saleRef = collection.borrow()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ?? panic(&quot;Invalid sale collection capability&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self.tokensForSale[saleRef.owner!.address] = collection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // removeSaleCollection removes a user&#x27;s sale from the array</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // of sale references</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pub fun removeSaleCollection(owner: Address) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self.tokensForSale[owner] = nil</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This contract isn&#x27;t meant to be a working or production-ready contract, but it could be extended to make a complete central marketplace by having:</p><ul><li>Sellers list a capability to their <code>SaleCollection</code> in this contract</li><li>Other functions that buyers could call to get info about all the different sales and to make purchases.</li></ul><p>A central marketplace in an off-chain application is easier to implement because:</p><ul><li>The app could host the marketplace and a user would simply log in to the app and give the app its account address.</li><li>The app could read the user&#x27;s public storage and find their sale reference.</li><li>With the sale reference, the app could get all the information they need about how to display the sales on their website.</li><li>Any buyer could discover the sale in the app and login with their account, which gives the app access to their public references.</li><li>When the buyer wants to buy a specific NFT, the app would automatically generate the proper transaction to purchase the NFT from the seller.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-marketplace-for-any-generic-nft">Creating a <strong>Marketplace for Any Generic NFT</strong><a href="#creating-a-marketplace-for-any-generic-nft" class="hash-link" aria-label="Direct link to creating-a-marketplace-for-any-generic-nft" title="Direct link to creating-a-marketplace-for-any-generic-nft">​</a></h2><hr><p>The previous examples show how a simple marketplace could be created for a specific class of NFTs.
However, users will want to have a marketplace where they can buy and sell any NFT they want, regardless of its type.
There are a few good examples of generic marketplaces on Flow right now.</p><ul><li>The Flow team has created a completely decentralized example of a generic marketplace in the <a href="https://github.com/onflow/nft-storefront" target="_blank" rel="noopener noreferrer">NFT storefront repo.</a>
This contract is already deployed to testnet and mainnet and can be used by anyone for any generic NFT sale!</li><li><a href="https://viv3.com/" target="_blank" rel="noopener noreferrer">VIV3</a> is a company that has a generic NFT marketplace.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="composable-resources-on-flow">Composable Resources on Flow<a href="#composable-resources-on-flow" class="hash-link" aria-label="Direct link to Composable Resources on Flow" title="Direct link to Composable Resources on Flow">​</a></h2><hr><p>Now that you have an understanding of how composable smart contracts and the marketplace work on Flow, you&#x27;re ready to play with composable resources!
Check out the <a href="/docs/cadence/tutorial/10-resources-compose">Kitty Hats tutorial!</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-04-28T19:25:40.000Z">Apr 28, 2023</time></b> by <b>Tom Haile</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/cadence/tutorial/07-marketplace-setup"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">7. Marketplace Setup</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/cadence/tutorial/09-voting"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">9. Voting Contract</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#marketplace-design" class="table-of-contents__link toc-highlight">Marketplace Design</a></li><li><a href="#setting-up-an-nft-marketplace" class="table-of-contents__link toc-highlight">Setting up an NFT <strong>Marketplace</strong></a><ul><li><a href="#events" class="table-of-contents__link toc-highlight">Events</a></li><li><a href="#resource-owned-capabilities" class="table-of-contents__link toc-highlight">Resource-Owned Capabilities</a></li></ul></li><li><a href="#deploying-and-using-the-marketplace" class="table-of-contents__link toc-highlight">Deploying and using the Marketplace</a></li><li><a href="#purchasing-an-nft" class="table-of-contents__link toc-highlight">Purchasing an NFT</a></li><li><a href="#verifying-the-nft-was-purchased-correctly" class="table-of-contents__link toc-highlight">Verifying the NFT Was Purchased Correctly</a></li><li><a href="#scaling-the-marketplace" class="table-of-contents__link toc-highlight">Scaling the Marketplace</a></li><li><a href="#creating-a-marketplace-for-any-generic-nft" class="table-of-contents__link toc-highlight">Creating a <strong>Marketplace for Any Generic NFT</strong></a></li><li><a href="#composable-resources-on-flow" class="table-of-contents__link toc-highlight">Composable Resources on Flow</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools">SDK&#x27;s &amp; Tools</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn">Learning Resources</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cadence">Cadence</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/mobile">Mobile</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools/fcl-js">FCL</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools/flow-js-testing">JS Testing Library</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools/flow-cli">CLI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools/emulator">Emulator</a></li><li class="footer__item"><a href="https://github.com/onflow/fcl-dev-wallet" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dev Wallet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools/vscode-extension">VS Code Extension</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/community">Ecosystem</a></li><li class="footer__item"><a href="https://port.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flow Port<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/onflow/developer-grants" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Grants<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://flow.com/flow-responsible-disclosure" target="_blank" rel="noopener noreferrer" class="footer__link-item">Responsible Disclosure<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.flowverse.co/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flowverse<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://academy.ecdao.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Emerald Academy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://floats.city/" target="_blank" rel="noopener noreferrer" class="footer__link-item">FLOATs (Attendance NFTs)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Start Building</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://play.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flow Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/kitty-items">Kitty Items</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cadence/tutorial">Cadence Tutorials</a></li><li class="footer__item"><a href="https://open-cadence.onflow.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cadence Cookbook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/flow/core-contracts">Core Contracts &amp; Standards</a></li><li class="footer__item"><a href="https://academy.ecdao.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Emerald DAO Bootcamp<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Network</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://status.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Network Status<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://flowscan.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flowscan Mainnet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://testnet.flowscan.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flowscan Testnet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/nodes/node-operation/past-sporks">Past Sporks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/nodes/node-operation/upcoming-sporks">Upcoming Sporks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/nodes/node-operation">Node Operation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/nodes/node-operation/spork">Spork Information</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/onflow" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://onflow.org/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OnFlow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Flow, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.10519f8f.js"></script>
<script src="/docs/assets/js/main.0febab49.js"></script>
</body>
</html>