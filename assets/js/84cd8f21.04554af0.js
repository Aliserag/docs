"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[7975],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>k});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),h=c(n),p=a,k=h["".concat(l,".").concat(p)]||h[p]||u[p]||r;return n?o.createElement(k,i(i({ref:t},d),{},{components:n})):o.createElement(k,i({ref:t},d))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[h]="string"==typeof e?e:a,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},62415:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>k,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var o=n(87462),a=(n(67294),n(3905));const r={title:"Delegation"},i=void 0,s={unversionedId:"1.Learn/Concepts/delegation",id:"1.Learn/Concepts/delegation",title:"Delegation",description:"Staking transactions are referred to throughout this document but will not",source:"@site/docs/1.Learn/Concepts/delegation.mdx",sourceDirName:"1.Learn/Concepts",slug:"/1.Learn/Concepts/delegation",permalink:"/1.Learn/Concepts/delegation",draft:!1,tags:[],version:"current",lastUpdatedBy:"Tom Haile",lastUpdatedAt:1682541550,formattedLastUpdatedAt:"Apr 26, 2023",frontMatter:{title:"Delegation"},sidebar:"tutorialSidebar",previous:{title:"Accounts, Keys & Signing",permalink:"/1.Learn/Concepts/accounts-and-keys"},next:{title:"Fees",permalink:"/1.Learn/Concepts/fees"}},l={},c=[{value:"Separating Node Operation from Holding Stake",id:"separating-node-operation-from-holding-stake",level:2},{value:"Account Key",id:"account-key",level:3},{value:"Staking Key",id:"staking-key",level:3},{value:"Managing Rewards &amp; Stake",id:"managing-rewards--stake",level:2},{value:"Slashing",id:"slashing",level:2},{value:"Process",id:"process",level:2},{value:"FAQ",id:"faq",level:2},{value:"Is the Stake Stored in a User Account?",id:"is-the-stake-stored-in-a-user-account",level:4}],d=(h="Callout",function(e){return console.warn("Component "+h+" was not imported, exported, or provided by MDXProvider as global scope"),(0,a.kt)("div",e)});var h;const u={toc:c},p="wrapper";function k(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)(d,{type:"warning",title:"Staking Transactions",mdxType:"Callout"},"Staking transactions are referred to throughout this document but will not exist in the described form for Beta Mainnet. At launch, node operators supply the Flow team with their staking key directly to ensure they are included in the genesis process. Staking transactions refer to a future state when nodes are dynamically joining and leaving the network which will not be possible until a later time. \\n\\nAll other mechanisms (smart contracts, rewards, etc.) will work as described at launch."),(0,a.kt)("h2",{id:"separating-node-operation-from-holding-stake"},"Separating Node Operation from Holding Stake"),(0,a.kt)("p",null,"Reliably operating a node on a decentralized network requires skill and commitment to the preservation of the integrity and security of that network. Providing the capital to pay for that security and earn a return for doing so requires a different set of skills but an equivalent responsibility and duty towards the maintenance of that network."),(0,a.kt)("p",null,"In acknowledgment of these two critical and very different roles, it is important that Flow enables the participation of both groups in their own right. This separation of roles: capital from operation, is so clear and important that the protocol explicitly differentiates the key needed to operate the node (the Staking Key) from the key which manage the capital associated operating the node (Account Key). The account governed by the account key deposits the stake and receives the rewards. The staking key is used only for node operations and has no direct financial authority. You can learn more about Node Keys ",(0,a.kt)("a",{parentName:"p",href:"doc:node-keys"},"here"),"."),(0,a.kt)("h3",{id:"account-key"},"Account Key"),(0,a.kt)("p",null,"Signs the staking transactions for a node (i.e. the transaction that affirms the stake would like to participate in node operation - this is manual for the beta version of the network). Rewards from operating the node will then be deposited into the account governed by the account key. Distribution of the received rewards between the involved parties (node operator(s) and staking-capital provider(s)) can be managed by a smart contract. All accounts on Flow can contain smart contracts and the account governed by the account key is no exception - deploying a contract to that account to support additional logic around the distribution of rewards is straightforward and completely customizable."),(0,a.kt)("h3",{id:"staking-key"},"Staking Key"),(0,a.kt)("p",null,"Is used by the node operator to sign protocol message (such as voting for blocks as a consensus node). The staking key signature on a message authenticates the original sender of that message and guarantees message integrity. In other words, the Staking Key is only relevant for the Flow-internal protocol but it cannot sign any transactions."),(0,a.kt)("p",null,"You can learn more about this division of identity ",(0,a.kt)("a",{parentName:"p",href:"https://docs.onflow.org/docs/nodes-network-identity"},"here"),"."),(0,a.kt)("h2",{id:"managing-rewards--stake"},"Managing Rewards & Stake"),(0,a.kt)("p",null,"As mentioned above, the account key must authorize the initial staking transaction and the withdrawal of the staked FLOW tokens for participation in the protocol. As part of the staking transaction, the public staking key is supplied. If the staking transaction is successful, the stake is withdrawn from the Account governed by the Account Key and the node is authorized to participate in the network."),(0,a.kt)("p",null,"The withdrawn funds are locked by the protocol for the duration of at least one epoch plus the unbonding period. The stake deposits of all nodes are protected by the strong security guarantees of Flow's Byzantine-Fault-Tolerant consensus algorithm. This means that no malicious actor can access the staking deposits. Thereby, Flow guarantees that the deposited stakes are managed in compliance with the protocol rules."),(0,a.kt)("p",null,"By participating in the network, a node earns rewards, which are automatically deposited (weekly) into the Account governed by the Account Key. This account ",(0,a.kt)("em",{parentName:"p"},"can")," (optionally) also hold any information and logic (via smart contract(s)) around the management of these funds such as:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"the stake commitments from any individuals who pooled their stake to run the node,"),(0,a.kt)("li",{parentName:"ul"},"the weight of rewards for their respective stake,"),(0,a.kt)("li",{parentName:"ul"},"the service fee (or reward portion) paid to the operator of the node (which Flow currently enforces to be a 10% commission on rewards for node operators)"),(0,a.kt)("li",{parentName:"ul"},"the withdrawal terms of stake from the pool (if longer than/different from those enforced by the protocol), and"),(0,a.kt)("li",{parentName:"ul"},"the liability for slashing.")),(0,a.kt)("p",null,"A template delegation contract will be provided by the Flow team initially to ensure the safety of delegators, but ultimately it's completely parameterizable by the agents providing the stake and the node operator."),(0,a.kt)("h2",{id:"slashing"},"Slashing"),(0,a.kt)("p",null,"So, who gets slashed? Severe slashing on Flow only takes place in the most nefarious of attacks. The protocol reserves slashing for maintaining the security of the protocol rather than its liveness. You can find more details on the conditions under which a node is slashed ",(0,a.kt)("a",{parentName:"p",href:"doc:slashing-conditions"},"here"),"."),(0,a.kt)("p",null,"While a node is in operation and during the unbonding period thereafter, the consensus nodes hold the staked tokens. Slashable protocol violations must be adjudicated by a supermajority of more than 2/3 of the staked consensus nodes in order to take effect. If a node is found guilty of committing a slashable protocol violation, the consensus nodes directly deduct a fine from the node's stake. Of course, only the remaining stake is deposited back into the Account governed by the Account Key at the end of the unbonding period."),(0,a.kt)("h2",{id:"process"},"Process"),(0,a.kt)("p",null,"If you are a node operator, who is trying to pool capital to meet the minimum stake for operating a node, there are a couple of things you need to do:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Deploy the ",(0,a.kt)("inlineCode",{parentName:"strong"},"Delegation Contract"))," into your Account (in the Beta period, you'll need the Flow team to co-sign your smart-contract-deployment transaction)."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Recruit folks who'd like to delegate")," their stake to your services and submit the appropriate transactions to your contract to assign them their rights."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Run the node")," (see ",(0,a.kt)("a",{parentName:"li",href:"https://docs.onflow.org/docs/setting-up-a-node"},"Node Operation Section"),")"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Receive Rewards")," - you and your delegators will automatically receive rewards according to the payout schedule you defined in the contract.")),(0,a.kt)("h2",{id:"faq"},"FAQ"),(0,a.kt)("h4",{id:"is-the-stake-stored-in-a-user-account"},"Is the Stake Stored in a User Account?"),(0,a.kt)("p",null,"Unstaked tokens are indeed stored in an account held by the owner of those tokens. When those tokens are successfully staked, the staking amount is withdrawn from the account (which submitted the staking transaction and authorized the token withdrawal). The staked tokens are then:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"entirely locked by the protocol (maintained by the Execution Nodes)"),(0,a.kt)("li",{parentName:"ol"},"the stake is added to the Identity for the newly created node (the Identity Table is part of Flow's ",(0,a.kt)("a",{parentName:"li",href:"doc:nodes-network-identity"},(0,a.kt)("em",{parentName:"a"},"Protocol State")),", which is maintained by the Consensus Nodes)"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"At genesis, "),"Nodes are ",(0,a.kt)("em",{parentName:"li"},"initialized with the stake already accredited to their ",(0,a.kt)("a",{parentName:"em",href:"doc:nodes-network-identity"},"Network Identity")),", which is external to the Node Operator's Account.")))}k.isMDXComponent=!0}}]);