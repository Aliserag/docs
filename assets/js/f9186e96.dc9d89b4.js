"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[61838],{71128:(o,t,e)=>{e.r(t),e.d(t,{CH:()=>d,assets:()=>a,chCodeConfig:()=>y,contentTitle:()=>l,default:()=>E,frontMatter:()=>s,metadata:()=>p,toc:()=>i});e(67294);var n=e(85893),r=e(11151),c=e(59794);const s={title:"Building Walletless Applications Using Child Accounts",sidebar_position:1},l=void 0,p={unversionedId:"concepts/account-linking/child-accounts",id:"concepts/account-linking/child-accounts",title:"Building Walletless Applications Using Child Accounts",description:"In this doc, we\u2019ll dive into a progressive onboarding flow, including the Cadence scripts & transactions that go into",source:"@site/docs/concepts/account-linking/child-accounts.mdx",sourceDirName:"concepts/account-linking",slug:"/concepts/account-linking/child-accounts",permalink:"/docs/next/concepts/account-linking/child-accounts",draft:!1,editUrl:"https://github.com/onflow/docs/tree/main/docs/concepts/account-linking/child-accounts.mdx",tags:[],version:"current",lastUpdatedBy:"Vishal",lastUpdatedAt:1693846461,formattedLastUpdatedAt:"Sep 4, 2023",sidebarPosition:1,frontMatter:{title:"Building Walletless Applications Using Child Accounts",sidebar_position:1},sidebar:"concepts",previous:{title:"Account Linking (FLIP 72)",permalink:"/docs/next/concepts/account-linking/"},next:{title:"Working With Parent Accounts",permalink:"/docs/next/concepts/account-linking/parent-accounts"}},a={},i=[{value:"Objectives",id:"objectives",level:2},{value:"Point of Clarity",id:"point-of-clarity",level:2},{value:"Account Linking",id:"account-linking",level:3},{value:"Linking Accounts",id:"linking-accounts",level:3},{value:"Terminology",id:"terminology",level:2},{value:"Account Linking",id:"account-linking-1",level:2},{value:"Pre-requisites",id:"pre-requisites",level:3},{value:"Publish &amp; Claim",id:"publish--claim",level:3},{value:"Publish",id:"publish",level:4},{value:"Claim",id:"claim",level:4},{value:"Multi-Signed Transaction",id:"multi-signed-transaction",level:3},{value:"Onboarding Flows",id:"onboarding-flows",level:2},{value:"Walletless Onboarding",id:"walletless-onboarding",level:3},{value:"Blockchain-Native Onboarding",id:"blockchain-native-onboarding",level:3},{value:"Account Creation &amp; Linking",id:"account-creation--linking",level:4},{value:"Funding &amp; Custody Patterns",id:"funding--custody-patterns",level:2},{value:"App-Funded, App-Custodied",id:"app-funded-app-custodied",level:3},{value:"App-Funded, User-Custodied",id:"app-funded-user-custodied",level:3},{value:"User-Funded, App-Custodied",id:"user-funded-app-custodied",level:3},{value:"User-Funded, User-Custodied",id:"user-funded-user-custodied",level:3}],d={annotations:c.ds,Code:c.EK},y={staticMediaQuery:"not screen, (max-width: 768px)",theme:{name:"nord",type:"dark",semanticHighlighting:!0,colors:{focusBorder:"#3b4252",foreground:"#d8dee9","activityBar.background":"#2e3440","activityBar.dropBackground":"#3b4252","activityBar.foreground":"#d8dee9","activityBar.activeBorder":"#88c0d0","activityBar.activeBackground":"#3b4252","activityBarBadge.background":"#88c0d0","activityBarBadge.foreground":"#2e3440","badge.foreground":"#2e3440","badge.background":"#88c0d0","button.background":"#88c0d0ee","button.foreground":"#2e3440","button.hoverBackground":"#88c0d0","button.secondaryBackground":"#434c5e","button.secondaryForeground":"#d8dee9","button.secondaryHoverBackground":"#4c566a","charts.red":"#bf616a","charts.blue":"#81a1c1","charts.yellow":"#ebcb8b","charts.orange":"#d08770","charts.green":"#a3be8c","charts.purple":"#b48ead","charts.foreground":"#d8dee9","charts.lines":"#88c0d0","debugConsole.infoForeground":"#88c0d0","debugConsole.warningForeground":"#ebcb8b","debugConsole.errorForeground":"#bf616a","debugConsole.sourceForeground":"#616e88","debugConsoleInputIcon.foreground":"#81a1c1","debugExceptionWidget.background":"#4c566a","debugExceptionWidget.border":"#2e3440","debugToolBar.background":"#3b4252",descriptionForeground:"#d8dee9e6","diffEditor.insertedTextBackground":"#81a1c133","diffEditor.removedTextBackground":"#bf616a4d","dropdown.background":"#3b4252","dropdown.border":"#3b4252","dropdown.foreground":"#d8dee9","editorActiveLineNumber.foreground":"#d8dee9cc","editorCursor.foreground":"#d8dee9","editorHint.border":"#ebcb8b00","editorHint.foreground":"#ebcb8b","editorIndentGuide.background":"#434c5eb3","editorIndentGuide.activeBackground":"#4c566a","editorInlayHint.background":"#434c5e","editorInlayHint.foreground":"#d8dee9","editorLineNumber.foreground":"#4c566a","editorLineNumber.activeForeground":"#d8dee9","editorWhitespace.foreground":"#4c566ab3","editorWidget.background":"#2e3440","editorWidget.border":"#3b4252","editor.background":"#2e3440","editor.foreground":"#d8dee9","editor.hoverHighlightBackground":"#3b4252","editor.findMatchBackground":"#88c0d066","editor.findMatchHighlightBackground":"#88c0d033","editor.findRangeHighlightBackground":"#88c0d033","editor.lineHighlightBackground":"#3b4252","editor.lineHighlightBorder":"#3b4252","editor.inactiveSelectionBackground":"#434c5ecc","editor.inlineValuesBackground":"#4c566a","editor.inlineValuesForeground":"#eceff4","editor.selectionBackground":"#434c5ecc","editor.selectionHighlightBackground":"#434c5ecc","editor.rangeHighlightBackground":"#434c5e52","editor.wordHighlightBackground":"#81a1c166","editor.wordHighlightStrongBackground":"#81a1c199","editor.stackFrameHighlightBackground":"#5e81ac","editor.focusedStackFrameHighlightBackground":"#5e81ac","editorError.foreground":"#bf616a","editorError.border":"#bf616a00","editorWarning.foreground":"#ebcb8b","editorWarning.border":"#ebcb8b00","editorBracketMatch.background":"#2e344000","editorBracketMatch.border":"#88c0d0","editorBracketHighlight.foreground1":"#8fbcbb","editorBracketHighlight.foreground2":"#88c0d0","editorBracketHighlight.foreground3":"#81a1c1","editorBracketHighlight.foreground4":"#5e81ac","editorBracketHighlight.foreground5":"#8fbcbb","editorBracketHighlight.foreground6":"#88c0d0","editorBracketHighlight.unexpectedBracket.foreground":"#bf616a","editorCodeLens.foreground":"#4c566a","editorGroup.background":"#2e3440","editorGroup.border":"#3b425201","editorGroup.dropBackground":"#3b425299","editorGroupHeader.border":"#3b425200","editorGroupHeader.noTabsBackground":"#2e3440","editorGroupHeader.tabsBackground":"#2e3440","editorGroupHeader.tabsBorder":"#3b425200","editorGutter.background":"#2e3440","editorGutter.modifiedBackground":"#ebcb8b","editorGutter.addedBackground":"#a3be8c","editorGutter.deletedBackground":"#bf616a","editorHoverWidget.background":"#3b4252","editorHoverWidget.border":"#3b4252","editorLink.activeForeground":"#88c0d0","editorMarkerNavigation.background":"#5e81acc0","editorMarkerNavigationError.background":"#bf616ac0","editorMarkerNavigationWarning.background":"#ebcb8bc0","editorOverviewRuler.border":"#3b4252","editorOverviewRuler.currentContentForeground":"#3b4252","editorOverviewRuler.incomingContentForeground":"#3b4252","editorOverviewRuler.findMatchForeground":"#88c0d066","editorOverviewRuler.rangeHighlightForeground":"#88c0d066","editorOverviewRuler.selectionHighlightForeground":"#88c0d066","editorOverviewRuler.wordHighlightForeground":"#88c0d066","editorOverviewRuler.wordHighlightStrongForeground":"#88c0d066","editorOverviewRuler.modifiedForeground":"#ebcb8b","editorOverviewRuler.addedForeground":"#a3be8c","editorOverviewRuler.deletedForeground":"#bf616a","editorOverviewRuler.errorForeground":"#bf616a","editorOverviewRuler.warningForeground":"#ebcb8b","editorOverviewRuler.infoForeground":"#81a1c1","editorRuler.foreground":"#434c5e","editorSuggestWidget.background":"#2e3440","editorSuggestWidget.border":"#3b4252","editorSuggestWidget.foreground":"#d8dee9","editorSuggestWidget.focusHighlightForeground":"#88c0d0","editorSuggestWidget.highlightForeground":"#88c0d0","editorSuggestWidget.selectedBackground":"#434c5e","editorSuggestWidget.selectedForeground":"#d8dee9","extensionButton.prominentForeground":"#d8dee9","extensionButton.prominentBackground":"#434c5e","extensionButton.prominentHoverBackground":"#4c566a",errorForeground:"#bf616a","gitDecoration.modifiedResourceForeground":"#ebcb8b","gitDecoration.deletedResourceForeground":"#bf616a","gitDecoration.untrackedResourceForeground":"#a3be8c","gitDecoration.ignoredResourceForeground":"#d8dee966","gitDecoration.conflictingResourceForeground":"#5e81ac","gitDecoration.submoduleResourceForeground":"#8fbcbb","gitDecoration.stageDeletedResourceForeground":"#bf616a","gitDecoration.stageModifiedResourceForeground":"#ebcb8b","input.background":"#3b4252","input.foreground":"#d8dee9","input.placeholderForeground":"#d8dee999","input.border":"#3b4252","inputOption.activeBackground":"#5e81ac","inputOption.activeBorder":"#5e81ac","inputOption.activeForeground":"#eceff4","inputValidation.errorBackground":"#bf616a","inputValidation.errorBorder":"#bf616a","inputValidation.infoBackground":"#81a1c1","inputValidation.infoBorder":"#81a1c1","inputValidation.warningBackground":"#d08770","inputValidation.warningBorder":"#d08770","keybindingLabel.background":"#4c566a","keybindingLabel.border":"#4c566a","keybindingLabel.bottomBorder":"#4c566a","keybindingLabel.foreground":"#d8dee9","list.activeSelectionBackground":"#88c0d0","list.activeSelectionForeground":"#2e3440","list.inactiveSelectionBackground":"#434c5e","list.inactiveSelectionForeground":"#d8dee9","list.inactiveFocusBackground":"#434c5ecc","list.hoverForeground":"#eceff4","list.focusForeground":"#d8dee9","list.focusBackground":"#88c0d099","list.focusHighlightForeground":"#eceff4","list.hoverBackground":"#3b4252","list.dropBackground":"#88c0d099","list.highlightForeground":"#88c0d0","list.errorForeground":"#bf616a","list.warningForeground":"#ebcb8b","merge.currentHeaderBackground":"#81a1c166","merge.currentContentBackground":"#81a1c14d","merge.incomingHeaderBackground":"#8fbcbb66","merge.incomingContentBackground":"#8fbcbb4d","merge.border":"#3b425200","minimap.background":"#2e3440","minimap.errorHighlight":"#bf616acc","minimap.findMatchHighlight":"#88c0d0","minimap.selectionHighlight":"#88c0d0cc","minimap.warningHighlight":"#ebcb8bcc","minimapGutter.addedBackground":"#a3be8c","minimapGutter.deletedBackground":"#bf616a","minimapGutter.modifiedBackground":"#ebcb8b","minimapSlider.activeBackground":"#434c5eaa","minimapSlider.background":"#434c5e99","minimapSlider.hoverBackground":"#434c5eaa","notification.background":"#3b4252","notification.buttonBackground":"#434c5e","notification.buttonForeground":"#d8dee9","notification.buttonHoverBackground":"#4c566a","notification.errorBackground":"#bf616a","notification.errorForeground":"#2e3440","notification.foreground":"#d8dee9","notification.infoBackground":"#88c0d0","notification.infoForeground":"#2e3440","notification.warningBackground":"#ebcb8b","notification.warningForeground":"#2e3440","notificationCenter.border":"#3b425200","notificationCenterHeader.background":"#2e3440","notificationCenterHeader.foreground":"#88c0d0","notificationLink.foreground":"#88c0d0","notifications.background":"#3b4252","notifications.border":"#2e3440","notifications.foreground":"#d8dee9","notificationToast.border":"#3b425200","panel.background":"#2e3440","panel.border":"#3b4252","panelTitle.activeBorder":"#88c0d000","panelTitle.activeForeground":"#88c0d0","panelTitle.inactiveForeground":"#d8dee9","peekView.border":"#4c566a","peekViewEditor.background":"#2e3440","peekViewEditorGutter.background":"#2e3440","peekViewEditor.matchHighlightBackground":"#88c0d04d","peekViewResult.background":"#2e3440","peekViewResult.fileForeground":"#88c0d0","peekViewResult.lineForeground":"#d8dee966","peekViewResult.matchHighlightBackground":"#88c0d0cc","peekViewResult.selectionBackground":"#434c5e","peekViewResult.selectionForeground":"#d8dee9","peekViewTitle.background":"#3b4252","peekViewTitleDescription.foreground":"#d8dee9","peekViewTitleLabel.foreground":"#88c0d0","pickerGroup.border":"#3b4252","pickerGroup.foreground":"#88c0d0","progressBar.background":"#88c0d0","quickInputList.focusBackground":"#88c0d0","quickInputList.focusForeground":"#2e3440","sash.hoverBorder":"#88c0d0","scrollbar.shadow":"#00000066","scrollbarSlider.activeBackground":"#434c5eaa","scrollbarSlider.background":"#434c5e99","scrollbarSlider.hoverBackground":"#434c5eaa","selection.background":"#88c0d099","sideBar.background":"#2e3440","sideBar.foreground":"#d8dee9","sideBar.border":"#3b4252","sideBarSectionHeader.background":"#3b4252","sideBarSectionHeader.foreground":"#d8dee9","sideBarTitle.foreground":"#d8dee9","statusBar.background":"#3b4252","statusBar.debuggingBackground":"#5e81ac","statusBar.debuggingForeground":"#d8dee9","statusBar.noFolderForeground":"#d8dee9","statusBar.noFolderBackground":"#3b4252","statusBar.foreground":"#d8dee9","statusBarItem.activeBackground":"#4c566a","statusBarItem.hoverBackground":"#434c5e","statusBarItem.prominentBackground":"#3b4252","statusBarItem.prominentHoverBackground":"#434c5e","statusBarItem.errorBackground":"#3b4252","statusBarItem.errorForeground":"#bf616a","statusBarItem.warningBackground":"#ebcb8b","statusBarItem.warningForeground":"#2e3440","statusBar.border":"#3b425200","tab.activeBackground":"#3b4252","tab.activeForeground":"#d8dee9","tab.border":"#3b425200","tab.activeBorder":"#88c0d000","tab.unfocusedActiveBorder":"#88c0d000","tab.inactiveBackground":"#2e3440","tab.inactiveForeground":"#d8dee966","tab.unfocusedActiveForeground":"#d8dee999","tab.unfocusedInactiveForeground":"#d8dee966","tab.hoverBackground":"#3b4252cc","tab.unfocusedHoverBackground":"#3b4252b3","tab.hoverBorder":"#88c0d000","tab.unfocusedHoverBorder":"#88c0d000","tab.activeBorderTop":"#88c0d000","tab.unfocusedActiveBorderTop":"#88c0d000","tab.lastPinnedBorder":"#4c566a","terminal.background":"#2e3440","terminal.foreground":"#d8dee9","terminal.ansiBlack":"#3b4252","terminal.ansiRed":"#bf616a","terminal.ansiGreen":"#a3be8c","terminal.ansiYellow":"#ebcb8b","terminal.ansiBlue":"#81a1c1","terminal.ansiMagenta":"#b48ead","terminal.ansiCyan":"#88c0d0","terminal.ansiWhite":"#e5e9f0","terminal.ansiBrightBlack":"#4c566a","terminal.ansiBrightRed":"#bf616a","terminal.ansiBrightGreen":"#a3be8c","terminal.ansiBrightYellow":"#ebcb8b","terminal.ansiBrightBlue":"#81a1c1","terminal.ansiBrightMagenta":"#b48ead","terminal.ansiBrightCyan":"#8fbcbb","terminal.ansiBrightWhite":"#eceff4","terminal.tab.activeBorder":"#88c0d0","textBlockQuote.background":"#3b4252","textBlockQuote.border":"#81a1c1","textCodeBlock.background":"#4c566a","textLink.activeForeground":"#88c0d0","textLink.foreground":"#88c0d0","textPreformat.foreground":"#8fbcbb","textSeparator.foreground":"#eceff4","titleBar.activeBackground":"#2e3440","titleBar.activeForeground":"#d8dee9","titleBar.border":"#2e344000","titleBar.inactiveBackground":"#2e3440","titleBar.inactiveForeground":"#d8dee966","tree.indentGuidesStroke":"#616e88","walkThrough.embeddedEditorBackground":"#2e3440","welcomePage.buttonBackground":"#434c5e","welcomePage.buttonHoverBackground":"#4c566a","widget.shadow":"#00000066"},tokenColors:[{settings:{foreground:"#d8dee9ff",background:"#2e3440ff"}},{scope:"emphasis",settings:{fontStyle:"italic"}},{scope:"strong",settings:{fontStyle:"bold"}},{name:"Comment",scope:"comment",settings:{foreground:"#616E88"}},{name:"Constant Character",scope:"constant.character",settings:{foreground:"#EBCB8B"}},{name:"Constant Character Escape",scope:"constant.character.escape",settings:{foreground:"#EBCB8B"}},{name:"Constant Language",scope:"constant.language",settings:{foreground:"#81A1C1"}},{name:"Constant Numeric",scope:"constant.numeric",settings:{foreground:"#B48EAD"}},{name:"Constant Regexp",scope:"constant.regexp",settings:{foreground:"#EBCB8B"}},{name:"Entity Name Class/Type",scope:["entity.name.class","entity.name.type.class"],settings:{foreground:"#8FBCBB"}},{name:"Entity Name Function",scope:"entity.name.function",settings:{foreground:"#88C0D0"}},{name:"Entity Name Tag",scope:"entity.name.tag",settings:{foreground:"#81A1C1"}},{name:"Entity Other Attribute Name",scope:"entity.other.attribute-name",settings:{foreground:"#8FBCBB"}},{name:"Entity Other Inherited Class",scope:"entity.other.inherited-class",settings:{fontStyle:"bold",foreground:"#8FBCBB"}},{name:"Invalid Deprecated",scope:"invalid.deprecated",settings:{foreground:"#D8DEE9",background:"#EBCB8B"}},{name:"Invalid Illegal",scope:"invalid.illegal",settings:{foreground:"#D8DEE9",background:"#BF616A"}},{name:"Keyword",scope:"keyword",settings:{foreground:"#81A1C1"}},{name:"Keyword Operator",scope:"keyword.operator",settings:{foreground:"#81A1C1"}},{name:"Keyword Other New",scope:"keyword.other.new",settings:{foreground:"#81A1C1"}},{name:"Markup Bold",scope:"markup.bold",settings:{fontStyle:"bold"}},{name:"Markup Changed",scope:"markup.changed",settings:{foreground:"#EBCB8B"}},{name:"Markup Deleted",scope:"markup.deleted",settings:{foreground:"#BF616A"}},{name:"Markup Inserted",scope:"markup.inserted",settings:{foreground:"#A3BE8C"}},{name:"Meta Preprocessor",scope:"meta.preprocessor",settings:{foreground:"#5E81AC"}},{name:"Punctuation",scope:"punctuation",settings:{foreground:"#ECEFF4"}},{name:"Punctuation Definition Parameters",scope:["punctuation.definition.method-parameters","punctuation.definition.function-parameters","punctuation.definition.parameters"],settings:{foreground:"#ECEFF4"}},{name:"Punctuation Definition Tag",scope:"punctuation.definition.tag",settings:{foreground:"#81A1C1"}},{name:"Punctuation Definition Comment",scope:["punctuation.definition.comment","punctuation.end.definition.comment","punctuation.start.definition.comment"],settings:{foreground:"#616E88"}},{name:"Punctuation Section",scope:"punctuation.section",settings:{foreground:"#ECEFF4"}},{name:"Punctuation Section Embedded",scope:["punctuation.section.embedded.begin","punctuation.section.embedded.end"],settings:{foreground:"#81A1C1"}},{name:"Punctuation Terminator",scope:"punctuation.terminator",settings:{foreground:"#81A1C1"}},{name:"Punctuation Variable",scope:"punctuation.definition.variable",settings:{foreground:"#81A1C1"}},{name:"Storage",scope:"storage",settings:{foreground:"#81A1C1"}},{name:"String",scope:"string",settings:{foreground:"#A3BE8C"}},{name:"String Regexp",scope:"string.regexp",settings:{foreground:"#EBCB8B"}},{name:"Support Class",scope:"support.class",settings:{foreground:"#8FBCBB"}},{name:"Support Constant",scope:"support.constant",settings:{foreground:"#81A1C1"}},{name:"Support Function",scope:"support.function",settings:{foreground:"#88C0D0"}},{name:"Support Function Construct",scope:"support.function.construct",settings:{foreground:"#81A1C1"}},{name:"Support Type",scope:"support.type",settings:{foreground:"#8FBCBB"}},{name:"Support Type Exception",scope:"support.type.exception",settings:{foreground:"#8FBCBB"}},{name:"Token Debug",scope:"token.debug-token",settings:{foreground:"#b48ead"}},{name:"Token Error",scope:"token.error-token",settings:{foreground:"#bf616a"}},{name:"Token Info",scope:"token.info-token",settings:{foreground:"#88c0d0"}},{name:"Token Warning",scope:"token.warn-token",settings:{foreground:"#ebcb8b"}},{name:"Variable",scope:"variable.other",settings:{foreground:"#D8DEE9"}},{name:"Variable Language",scope:"variable.language",settings:{foreground:"#81A1C1"}},{name:"Variable Parameter",scope:"variable.parameter",settings:{foreground:"#D8DEE9"}},{name:"[C/CPP] Punctuation Separator Pointer-Access",scope:"punctuation.separator.pointer-access.c",settings:{foreground:"#81A1C1"}},{name:"[C/CPP] Meta Preprocessor Include",scope:["source.c meta.preprocessor.include","source.c string.quoted.other.lt-gt.include"],settings:{foreground:"#8FBCBB"}},{name:"[C/CPP] Conditional Directive",scope:["source.cpp keyword.control.directive.conditional","source.cpp punctuation.definition.directive","source.c keyword.control.directive.conditional","source.c punctuation.definition.directive"],settings:{foreground:"#5E81AC",fontStyle:"bold"}},{name:"[CSS] Constant Other Color RGB Value",scope:"source.css constant.other.color.rgb-value",settings:{foreground:"#B48EAD"}},{name:"[CSS](Function) Meta Property-Value",scope:"source.css meta.property-value",settings:{foreground:"#88C0D0"}},{name:"[CSS] Media Queries",scope:["source.css keyword.control.at-rule.media","source.css keyword.control.at-rule.media punctuation.definition.keyword"],settings:{foreground:"#D08770"}},{name:"[CSS] Punctuation Definition Keyword",scope:"source.css punctuation.definition.keyword",settings:{foreground:"#81A1C1"}},{name:"[CSS] Support Type Property Name",scope:"source.css support.type.property-name",settings:{foreground:"#D8DEE9"}},{name:"[diff] Meta Range Context",scope:"source.diff meta.diff.range.context",settings:{foreground:"#8FBCBB"}},{name:"[diff] Meta Header From-File",scope:"source.diff meta.diff.header.from-file",settings:{foreground:"#8FBCBB"}},{name:"[diff] Punctuation Definition From-File",scope:"source.diff punctuation.definition.from-file",settings:{foreground:"#8FBCBB"}},{name:"[diff] Punctuation Definition Range",scope:"source.diff punctuation.definition.range",settings:{foreground:"#8FBCBB"}},{name:"[diff] Punctuation Definition Separator",scope:"source.diff punctuation.definition.separator",settings:{foreground:"#81A1C1"}},{name:"[Elixir](JakeBecker.elixir-ls) module names",scope:"entity.name.type.module.elixir",settings:{foreground:"#8FBCBB"}},{name:"[Elixir](JakeBecker.elixir-ls) module attributes",scope:"variable.other.readwrite.module.elixir",settings:{foreground:"#D8DEE9",fontStyle:"bold"}},{name:"[Elixir](JakeBecker.elixir-ls) atoms",scope:"constant.other.symbol.elixir",settings:{foreground:"#D8DEE9",fontStyle:"bold"}},{name:"[Elixir](JakeBecker.elixir-ls) modules",scope:"variable.other.constant.elixir",settings:{foreground:"#8FBCBB"}},{name:"[Go] String Format Placeholder",scope:"source.go constant.other.placeholder.go",settings:{foreground:"#EBCB8B"}},{name:"[Java](JavaDoc) Comment Block Documentation HTML Entities",scope:"source.java comment.block.documentation.javadoc punctuation.definition.entity.html",settings:{foreground:"#81A1C1"}},{name:"[Java](JavaDoc) Constant Other",scope:"source.java constant.other",settings:{foreground:"#D8DEE9"}},{name:"[Java](JavaDoc) Keyword Other Documentation",scope:"source.java keyword.other.documentation",settings:{foreground:"#8FBCBB"}},{name:"[Java](JavaDoc) Keyword Other Documentation Author",scope:"source.java keyword.other.documentation.author.javadoc",settings:{foreground:"#8FBCBB"}},{name:"[Java](JavaDoc) Keyword Other Documentation Directive/Custom",scope:["source.java keyword.other.documentation.directive","source.java keyword.other.documentation.custom"],settings:{foreground:"#8FBCBB"}},{name:"[Java](JavaDoc) Keyword Other Documentation See",scope:"source.java keyword.other.documentation.see.javadoc",settings:{foreground:"#8FBCBB"}},{name:"[Java] Meta Method-Call",scope:"source.java meta.method-call meta.method",settings:{foreground:"#88C0D0"}},{name:"[Java](JavaDoc) Meta Tag Template Link",scope:["source.java meta.tag.template.link.javadoc","source.java string.other.link.title.javadoc"],settings:{foreground:"#8FBCBB"}},{name:"[Java](JavaDoc) Meta Tag Template Value",scope:"source.java meta.tag.template.value.javadoc",settings:{foreground:"#88C0D0"}},{name:"[Java](JavaDoc) Punctuation Definition Keyword",scope:"source.java punctuation.definition.keyword.javadoc",settings:{foreground:"#8FBCBB"}},{name:"[Java](JavaDoc) Punctuation Definition Tag",scope:["source.java punctuation.definition.tag.begin.javadoc","source.java punctuation.definition.tag.end.javadoc"],settings:{foreground:"#616E88"}},{name:"[Java] Storage Modifier Import",scope:"source.java storage.modifier.import",settings:{foreground:"#8FBCBB"}},{name:"[Java] Storage Modifier Package",scope:"source.java storage.modifier.package",settings:{foreground:"#8FBCBB"}},{name:"[Java] Storage Type",scope:"source.java storage.type",settings:{foreground:"#8FBCBB"}},{name:"[Java] Storage Type Annotation",scope:"source.java storage.type.annotation",settings:{foreground:"#D08770"}},{name:"[Java] Storage Type Generic",scope:"source.java storage.type.generic",settings:{foreground:"#8FBCBB"}},{name:"[Java] Storage Type Primitive",scope:"source.java storage.type.primitive",settings:{foreground:"#81A1C1"}},{name:"[JavaScript] Decorator",scope:["source.js punctuation.decorator","source.js meta.decorator variable.other.readwrite","source.js meta.decorator entity.name.function"],settings:{foreground:"#D08770"}},{name:"[JavaScript] Meta Object-Literal Key",scope:"source.js meta.object-literal.key",settings:{foreground:"#88C0D0"}},{name:"[JavaScript](JSDoc) Storage Type Class",scope:"source.js storage.type.class.jsdoc",settings:{foreground:"#8FBCBB"}},{name:"[JavaScript] String Template Literals Punctuation",scope:["source.js string.quoted.template punctuation.quasi.element.begin","source.js string.quoted.template punctuation.quasi.element.end","source.js string.template punctuation.definition.template-expression"],settings:{foreground:"#81A1C1"}},{name:"[JavaScript] Interpolated String Template Punctuation Functions",scope:"source.js string.quoted.template meta.method-call.with-arguments",settings:{foreground:"#ECEFF4"}},{name:"[JavaScript] String Template Literal Variable",scope:["source.js string.template meta.template.expression support.variable.property","source.js string.template meta.template.expression variable.other.object"],settings:{foreground:"#D8DEE9"}},{name:"[JavaScript] Support Type Primitive",scope:"source.js support.type.primitive",settings:{foreground:"#81A1C1"}},{name:"[JavaScript] Variable Other Object",scope:"source.js variable.other.object",settings:{foreground:"#D8DEE9"}},{name:"[JavaScript] Variable Other Read-Write Alias",scope:"source.js variable.other.readwrite.alias",settings:{foreground:"#8FBCBB"}},{name:"[JavaScript] Parentheses in Template Strings",scope:["source.js meta.embedded.line meta.brace.square","source.js meta.embedded.line meta.brace.round","source.js string.quoted.template meta.brace.square","source.js string.quoted.template meta.brace.round"],settings:{foreground:"#ECEFF4"}},{name:"[HTML] Constant Character Entity",scope:"text.html.basic constant.character.entity.html",settings:{foreground:"#EBCB8B"}},{name:"[HTML] Constant Other Inline-Data",scope:"text.html.basic constant.other.inline-data",settings:{foreground:"#D08770",fontStyle:"italic"}},{name:"[HTML] Meta Tag SGML Doctype",scope:"text.html.basic meta.tag.sgml.doctype",settings:{foreground:"#5E81AC"}},{name:"[HTML] Punctuation Definition Entity",scope:"text.html.basic punctuation.definition.entity",settings:{foreground:"#81A1C1"}},{name:"[INI] Entity Name Section Group-Title",scope:"source.properties entity.name.section.group-title.ini",settings:{foreground:"#88C0D0"}},{name:"[INI] Punctuation Separator Key-Value",scope:"source.properties punctuation.separator.key-value.ini",settings:{foreground:"#81A1C1"}},{name:"[Markdown] Markup Fenced Code Block",scope:["text.html.markdown markup.fenced_code.block","text.html.markdown markup.fenced_code.block punctuation.definition"],settings:{foreground:"#8FBCBB"}},{name:"[Markdown] Markup Heading",scope:"markup.heading",settings:{foreground:"#88C0D0"}},{name:"[Markdown] Markup Inline",scope:["text.html.markdown markup.inline.raw","text.html.markdown markup.inline.raw punctuation.definition.raw"],settings:{foreground:"#8FBCBB"}},{name:"[Markdown] Markup Italic",scope:"text.html.markdown markup.italic",settings:{fontStyle:"italic"}},{name:"[Markdown] Markup Link",scope:"text.html.markdown markup.underline.link",settings:{fontStyle:"underline"}},{name:"[Markdown] Markup List Numbered/Unnumbered",scope:"text.html.markdown beginning.punctuation.definition.list",settings:{foreground:"#81A1C1"}},{name:"[Markdown] Markup Quote Punctuation Definition",scope:"text.html.markdown beginning.punctuation.definition.quote",settings:{foreground:"#8FBCBB"}},{name:"[Markdown] Markup Quote Punctuation Definition",scope:"text.html.markdown markup.quote",settings:{foreground:"#616E88"}},{name:"[Markdown] Markup Math Constant",scope:"text.html.markdown constant.character.math.tex",settings:{foreground:"#81A1C1"}},{name:"[Markdown] Markup Math Definition Marker",scope:["text.html.markdown punctuation.definition.math.begin","text.html.markdown punctuation.definition.math.end"],settings:{foreground:"#5E81AC"}},{name:"[Markdown] Markup Math Function Definition Marker",scope:"text.html.markdown punctuation.definition.function.math.tex",settings:{foreground:"#88C0D0"}},{name:"[Markdown] Markup Math Operator",scope:"text.html.markdown punctuation.math.operator.latex",settings:{foreground:"#81A1C1"}},{name:"[Markdown] Punctuation Definition Heading",scope:"text.html.markdown punctuation.definition.heading",settings:{foreground:"#81A1C1"}},{name:"[Markdown] Punctuation Definition Constant/String",scope:["text.html.markdown punctuation.definition.constant","text.html.markdown punctuation.definition.string"],settings:{foreground:"#81A1C1"}},{name:"[Markdown] String Other Link Description/Title",scope:["text.html.markdown constant.other.reference.link","text.html.markdown string.other.link.description","text.html.markdown string.other.link.title"],settings:{foreground:"#88C0D0"}},{name:"[Perl] Perl Sigils",scope:"source.perl punctuation.definition.variable",settings:{foreground:"#D8DEE9"}},{name:"[PHP] Meta Function-Call Object",scope:["source.php meta.function-call","source.php meta.function-call.object"],settings:{foreground:"#88C0D0"}},{name:"[Python] Decorator",scope:["source.python entity.name.function.decorator","source.python meta.function.decorator support.type"],settings:{foreground:"#D08770"}},{name:"[Python] Function Call",scope:"source.python meta.function-call.generic",settings:{foreground:"#88C0D0"}},{name:"[Python] Support Type",scope:"source.python support.type",settings:{foreground:"#88C0D0"}},{name:"[Python] Function Parameter",scope:["source.python variable.parameter.function.language"],settings:{foreground:"#D8DEE9"}},{name:"[Python] Function Parameter Special",scope:["source.python meta.function.parameters variable.parameter.function.language.special.self"],settings:{foreground:"#81A1C1"}},{name:"[Rust] Entity types",scope:"source.rust entity.name.type",settings:{foreground:"#8FBCBB"}},{name:"[Rust] Macro",scope:"source.rust meta.macro entity.name.function",settings:{fontStyle:"bold",foreground:"#88C0D0"}},{name:"[Rust] Attributes",scope:["source.rust meta.attribute","source.rust meta.attribute punctuation","source.rust meta.attribute keyword.operator"],settings:{foreground:"#5E81AC"}},{name:"[Rust] Traits",scope:"source.rust entity.name.type.trait",settings:{fontStyle:"bold"}},{name:"[Rust] Interpolation Bracket Curly",scope:"source.rust punctuation.definition.interpolation",settings:{foreground:"#EBCB8B"}},{name:"[SCSS] Punctuation Definition Interpolation Bracket Curly",scope:["source.css.scss punctuation.definition.interpolation.begin.bracket.curly","source.css.scss punctuation.definition.interpolation.end.bracket.curly"],settings:{foreground:"#81A1C1"}},{name:"[SCSS] Variable Interpolation",scope:"source.css.scss variable.interpolation",settings:{foreground:"#D8DEE9",fontStyle:"italic"}},{name:"[TypeScript] Decorators",scope:["source.ts punctuation.decorator","source.ts meta.decorator variable.other.readwrite","source.ts meta.decorator entity.name.function","source.tsx punctuation.decorator","source.tsx meta.decorator variable.other.readwrite","source.tsx meta.decorator entity.name.function"],settings:{foreground:"#D08770"}},{name:"[TypeScript] Object-literal keys",scope:["source.ts meta.object-literal.key","source.tsx meta.object-literal.key"],settings:{foreground:"#D8DEE9"}},{name:"[TypeScript] Object-literal functions",scope:["source.ts meta.object-literal.key entity.name.function","source.tsx meta.object-literal.key entity.name.function"],settings:{foreground:"#88C0D0"}},{name:"[TypeScript] Type/Class",scope:["source.ts support.class","source.ts support.type","source.ts entity.name.type","source.ts entity.name.class","source.tsx support.class","source.tsx support.type","source.tsx entity.name.type","source.tsx entity.name.class"],settings:{foreground:"#8FBCBB"}},{name:"[TypeScript] Static Class Support",scope:["source.ts support.constant.math","source.ts support.constant.dom","source.ts support.constant.json","source.tsx support.constant.math","source.tsx support.constant.dom","source.tsx support.constant.json"],settings:{foreground:"#8FBCBB"}},{name:"[TypeScript] Variables",scope:["source.ts support.variable","source.tsx support.variable"],settings:{foreground:"#D8DEE9"}},{name:"[TypeScript] Parentheses in Template Strings",scope:["source.ts meta.embedded.line meta.brace.square","source.ts meta.embedded.line meta.brace.round","source.tsx meta.embedded.line meta.brace.square","source.tsx meta.embedded.line meta.brace.round"],settings:{foreground:"#ECEFF4"}},{name:"[XML] Entity Name Tag Namespace",scope:"text.xml entity.name.tag.namespace",settings:{foreground:"#8FBCBB"}},{name:"[XML] Keyword Other Doctype",scope:"text.xml keyword.other.doctype",settings:{foreground:"#5E81AC"}},{name:"[XML] Meta Tag Preprocessor",scope:"text.xml meta.tag.preprocessor entity.name.tag",settings:{foreground:"#5E81AC"}},{name:"[XML] Entity Name Tag Namespace",scope:["text.xml string.unquoted.cdata","text.xml string.unquoted.cdata punctuation.definition.string"],settings:{foreground:"#D08770",fontStyle:"italic"}},{name:"[YAML] Entity Name Tag",scope:"source.yaml entity.name.tag",settings:{foreground:"#8FBCBB"}}]},lineNumbers:!0,showCopyButton:!0,autoImport:!0,skipLanguages:[],filepath:"/home/runner/work/docs/docs/docs/concepts/account-linking/child-accounts.mdx"};function F(o){const t=Object.assign({p:"p",h2:"h2",ul:"ul",li:"li",a:"a",strong:"strong",h3:"h3",code:"code",img:"img",em:"em",ol:"ol",h4:"h4"},(0,r.ah)(),o.components),{Callout:c}=t;return d||u("CH",!1),d.Code||u("CH.Code",!0),c||u("Callout",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"In this doc, we\u2019ll dive into a progressive onboarding flow, including the Cadence scripts & transactions that go into\nits implementation in your app. These components will enable any implementing app to create a custodial account,\nmediate the user\u2019s onchain actions on their behalf, and later delegate access of that app-created account to the\nuser\u2019s wallet. We\u2019ll refer to this custodial pattern as the Hybrid Custody Model and the process of delegating control\nof the app account as Account Linking."}),"\n",(0,n.jsx)(t.h2,{id:"objectives",children:"Objectives"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Create a ",(0,n.jsx)(t.a,{href:"https://flow.com/post/flow-blockchain-mainstream-adoption-easy-onboarding-wallets",children:"walletless onboarding"}),"\ntransaction"]}),"\n",(0,n.jsx)(t.li,{children:"Link an existing app account as a child to a newly authenticated parent account"}),"\n",(0,n.jsx)(t.li,{children:"Get your app to recognize \u201cparent\u201d accounts along with any associated \u201cchild\u201d accounts"}),"\n",(0,n.jsx)(t.li,{children:"Put it all together to create a blockchain-native onboarding transaction"}),"\n",(0,n.jsx)(t.li,{children:"View fungible and non-fungible Token metadata relating to assets across all of a user\u2019s associated accounts - their\nwallet-mediated \u201cparent\u201d account and any \u201cchild\u201d accounts"}),"\n",(0,n.jsx)(t.li,{children:"Facilitate transactions acting on assets in child accounts"}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"point-of-clarity",children:"Point of Clarity"}),"\n",(0,n.jsxs)(t.p,{children:["Before diving in, let's make a distinction between ",(0,n.jsx)(t.strong,{children:'"account linking"'})," and ",(0,n.jsx)(t.strong,{children:'"linking accounts"'}),"."]}),"\n",(0,n.jsx)(t.h3,{id:"account-linking",children:"Account Linking"}),"\n",(0,n.jsx)(c,{type:" ",children:(0,n.jsxs)(t.p,{children:["Note that since account linking is a sensitive action, transactions where an account may be linked are designated by a\ntopline pragma ",(0,n.jsx)(t.code,{children:"#allowAccountLinking"}),". This lets wallet providers inform users that their account may be linked in the\nsigned transaction."]})}),"\n",(0,n.jsxs)(t.p,{children:["Very simply, account linking is a ",(0,n.jsx)(t.a,{href:"https://github.com/onflow/flips/pull/53",children:"feature in Cadence"})," that let's an\n",(0,n.jsx)(t.a,{href:"/docs/next/cadence/language/accounts#authaccount",children:"AuthAccount"})," create a\n",(0,n.jsx)(t.a,{href:"/docs/next/cadence/language/capability-based-access-control",children:"Capability"})," on itself. You can do so in the following\ntransaction:"]}),"\n",(0,n.jsx)(d.Code,{codeConfig:y,northPanel:{tabs:["link_account.cdc"],active:"link_account.cdc",heightRatio:1},files:[{name:"link_account.cdc",focus:"",code:{lines:[{tokens:[{content:"#allowAccountLinking",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"transaction",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"linkPathSuffix",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" String",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"    prepare",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"account",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" AuthAccount",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        // Create the PrivatePath where we'll create the link",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" linkPath = ",props:{style:{color:"#D8DEE9FF"}}},{content:"PrivatePath",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"identifier",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" linkPathSuffix",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            ?? ",props:{style:{color:"#81A1C1"}}},{content:"panic",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"Could not construct PrivatePath from given identifier: ",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:".",props:{style:{color:"#D8DEE9FF"}}},{content:"concat",props:{style:{color:"#88C0D0"}}},{content:"(linkPathSuffix",props:{style:{color:"#D8DEE9FF"}}},{content:"))",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        // Check if an AuthAccount Capability already exists at the specified path",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        if !",props:{style:{color:"#81A1C1"}}},{content:"account.getCapability",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&AuthAccount",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(linkPath).",props:{style:{color:"#D8DEE9FF"}}},{content:"check",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            // If not, unlink anything that may be there and link the AuthAccount Capability",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"            account.",props:{style:{color:"#D8DEE9FF"}}},{content:"unlink",props:{style:{color:"#88C0D0"}}},{content:"(linkpath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            account.",props:{style:{color:"#D8DEE9FF"}}},{content:"linkAccount",props:{style:{color:"#88C0D0"}}},{content:"(linkPath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"    }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"}",props:{style:{color:"#ECEFF4"}}}]}],lang:"cadence"},annotations:[]}]}),"\n",(0,n.jsx)(t.p,{children:"From there, the signing account can retrieve the privately linked AuthAccount Capability and delegate it to another\naccount, unlinking the Capability if they wish to revoke delegated access."}),"\n",(0,n.jsxs)(t.p,{children:["Note that in order to link an account, a transaction must state the ",(0,n.jsx)(t.code,{children:"#allowAccountLinking"})," pragma in the top line of the\ntransaction. This is an interim safety measure so that wallet providers can notify users they're about to sign a\ntransaction that may create a Capability on their AuthAccount."]}),"\n",(0,n.jsx)(t.h3,{id:"linking-accounts",children:"Linking Accounts"}),"\n",(0,n.jsxs)(t.p,{children:["Linking accounts leverages this account link, otherwise known as an ",(0,n.jsx)(t.strong,{children:"AuthAccount Capability"}),", and encapsulates it. The\n",(0,n.jsx)(t.a,{href:"https://github.com/onflow/flips/pull/72",children:"components and actions"})," involved in this process - what the Capability is\nencapsulated in, the collection that holds those encapsulations, etc. is what we'll dive into in this doc."]}),"\n",(0,n.jsx)(t.h2,{id:"terminology",children:"Terminology"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Parent-Child accounts"})," - For the moment, we\u2019ll call the account created by the app the \u201cchild\u201d account and the\naccount receiving its AuthAccount Capability the \u201cparent\u201d account. Existing methods of account access & delegation (i.e.\nkeys) still imply ownership over the account, but insofar as linked accounts are concerned, the account to which both\nthe user and the app share access via AuthAccount Capability will be considered the \u201cchild\u201d account."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Walletless onboarding"})," - An onboarding flow whereby an app creates an account for a user, onboarding them to the\napp, obviating the need for user wallet authentication."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Blockchain-native onboarding"})," - Similar to the already familiar Web3 onboarding flow where a user authenticates with\ntheir existing wallet, an app onboards a user via wallet authentication while additionally creating an app account and\nlinking it with the authenticated account, resulting in a hybrid custody model."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Hybrid Custody Model"})," - A custodial pattern in which an app and a user maintain access to an app created account and\nuser access to that account has been mediated by account linking."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Account Linking"})," - Technically speaking, account linking in our context consists of giving some other account an\nAuthAccount Capability from the granting account. This Capability is maintained in standardized resource called a\n",(0,n.jsx)(t.code,{children:"HybridCustody.Manager"}),", providing its owning user access to any and all of their linked accounts."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Progressive Onboarding"})," - An onboarding flow that walks a user up to self-custodial ownership, starting with\nwalletless onboarding and later linking the app account with the user\u2019s authenticated wallet once the user chooses to\ndo so."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Restricted Child Account"}),' - An account delegation where the access on the delegating account is restricted according\nto rules set by the linking child account. The distinctions between this and the subsequent term ("owned" account) will\nbe expanding on later.']}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Owned Account"}),' - An account delegation where the delegatee has unrestricted access on the delegating child account,\nthereby giving the delegatee presiding authority superseding any other "restricted" parent accounts.']}),"\n",(0,n.jsx)(t.h2,{id:"account-linking-1",children:"Account Linking"}),"\n",(0,n.jsxs)(t.p,{children:['Linking an account is the process of delegating account access via AuthAccount Capability. Of course, we want to do this\nin a way that allows the receiving account to maintain that Capability and allows easy identification of the accounts on\neither end of the linkage - the user\'s main "parent" account and the linked "child" account. This is accomplished in the\n(still in flux) ',(0,n.jsx)(t.code,{children:"HybridCustody"})," contract which we'll continue to use in this guidance."]}),"\n",(0,n.jsx)(t.h3,{id:"pre-requisites",children:"Pre-requisites"}),"\n",(0,n.jsxs)(t.p,{children:["Since account delegation is mediated by developer-defined rules, you should make sure to first configure the resources\nthat contain those rules. Contracts involved in defining and enforcing this ruleset are\n",(0,n.jsx)(t.a,{href:"https://github.com/onflow/hybrid-custody/blob/main/contracts/CapabilityFilter.cdc",children:(0,n.jsx)(t.code,{children:"CapabilityFilter"})})," and\n",(0,n.jsx)(t.a,{href:"https://github.com/onflow/hybrid-custody/blob/main/contracts/CapabilityFactory.cdc",children:(0,n.jsx)(t.code,{children:"CapabilityFactory"})}),".\nThe former enumerates those types that are/aren't accessible from a child account while the latter enables the access of\nthose allowable Capabilities such that the returned values can be properly typed - e.g. retrieving a Capability that can\nbe cast to ",(0,n.jsx)(t.code,{children:"Capability<&NonFungibleToken.Collection>"})," for example."]}),"\n",(0,n.jsxs)(t.p,{children:["Here's how you would configure an ",(0,n.jsx)(t.code,{children:"AllowlistFilter"})," and add allowed types to it:"]}),"\n",(0,n.jsx)(d.Code,{codeConfig:y,northPanel:{tabs:["setup_allow_all_filter.cdc"],active:"setup_allow_all_filter.cdc",heightRatio:1},files:[{name:"setup_allow_all_filter.cdc",focus:"",code:{lines:[{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFilter",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"transaction",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"identifiers",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" [String]",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"    prepare",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"acct",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" AuthAccount",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        // Setup the AllowlistFilter",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        if",props:{style:{color:"#81A1C1"}}},{content:" acct.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&CapabilityFilter.AllowlistFilter",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"from",props:{style:{color:"#81A1C1"}}},{content:": CapabilityFilter.StoragePath) ",props:{style:{color:"#D8DEE9FF"}}},{content:"== nil ",props:{style:{color:"#81A1C1"}}},{content:"{",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            acct.",props:{style:{color:"#D8DEE9FF"}}},{content:"save",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"<-",props:{style:{color:"#81A1C1"}}},{content:"CapabilityFilter.",props:{style:{color:"#D8DEE9FF"}}},{content:"create",props:{style:{color:"#88C0D0"}}},{content:"(Type",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"@CapabilityFilter.AllowlistFilter",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"))",props:{style:{color:"#ECEFF4"}}},{content:", to: CapabilityFilter.StoragePath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // Ensure the AllowlistFilter is linked to the expected PublicPath",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        acct.",props:{style:{color:"#D8DEE9FF"}}},{content:"unlink",props:{style:{color:"#88C0D0"}}},{content:"(CapabilityFilter.PublicPath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        acct.link",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&CapabilityFilter.AllowlistFilter",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFilter.Filter",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(CapabilityFilter.PublicPath, target: CapabilityFilter.StoragePath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // Get a reference to the filter",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" filter = acct.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&CapabilityFilter.AllowlistFilter",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"from",props:{style:{color:"#81A1C1"}}},{content:": CapabilityFilter.StoragePath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            ?? ",props:{style:{color:"#81A1C1"}}},{content:"panic",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"filter does not exist",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // Add the given type identifiers to the AllowlistFilter",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        // **Note:** the whole transaction fails if any of the given identifiers are malformed",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        for",props:{style:{color:"#81A1C1"}}},{content:" identifier ",props:{style:{color:"#D8DEE9FF"}}},{content:"in",props:{style:{color:"#81A1C1"}}},{content:" identifiers ",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            let",props:{style:{color:"#81A1C1"}}},{content:" c = ",props:{style:{color:"#D8DEE9FF"}}},{content:"CompositeType",props:{style:{color:"#88C0D0"}}},{content:"(identifier",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:"!",props:{style:{color:"#81A1C1"}}}]},{tokens:[{content:"            filter.",props:{style:{color:"#D8DEE9FF"}}},{content:"addType",props:{style:{color:"#88C0D0"}}},{content:"(c",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"    }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"}",props:{style:{color:"#ECEFF4"}}}]}],lang:"cadence"},annotations:[]}]}),"\n",(0,n.jsxs)(t.p,{children:["And the following transaction configures a ",(0,n.jsx)(t.code,{children:"CapabilityFactory.Manager"}),", adding NFT-related ",(0,n.jsx)(t.code,{children:"Factory"})," objects:"]}),"\n",(0,n.jsx)(c,{type:"info",children:(0,n.jsx)(t.p,{children:"Note that the Manager configured here enables retrieval of castable Capabilities. It's recommended that you implement\nFactory resource definitions to support any NFT Collections related with the use of your application so that users can\nretrieve Typed Capabilities from accounts linked from your app."})}),"\n",(0,n.jsx)(d.Code,{codeConfig:y,northPanel:{tabs:["setup_factory.cdc"],active:"setup_factory.cdc",heightRatio:1},files:[{name:"setup_factory.cdc",focus:"",code:{lines:[{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFactory",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"NFTCollectionPublicFactory",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"NFTProviderAndCollectionFactory",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"NFTProviderFactory",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"NonFungibleToken",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"transaction ",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"    prepare",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"acct",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" AuthAccount",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        // Check for a stored Manager, saving if not found",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        if",props:{style:{color:"#81A1C1"}}},{content:" acct.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&AnyResource",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"from",props:{style:{color:"#81A1C1"}}},{content:": CapabilityFactory.StoragePath) ",props:{style:{color:"#D8DEE9FF"}}},{content:"== nil ",props:{style:{color:"#81A1C1"}}},{content:"{",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            let",props:{style:{color:"#81A1C1"}}},{content:" f <- CapabilityFactory.",props:{style:{color:"#D8DEE9FF"}}},{content:"createFactoryManager",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            acct.",props:{style:{color:"#D8DEE9FF"}}},{content:"save",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"<-",props:{style:{color:"#81A1C1"}}},{content:"f, ",props:{style:{color:"#D8DEE9FF"}}},{content:"to",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" CapabilityFactory.StoragePath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        // Check for Capabilities where expected, linking if not found",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        if !",props:{style:{color:"#81A1C1"}}},{content:"acct.getCapability",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&CapabilityFactory.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFactory.Getter",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(CapabilityFactory.PrivatePath).",props:{style:{color:"#D8DEE9FF"}}},{content:"check",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            acct.",props:{style:{color:"#D8DEE9FF"}}},{content:"unlink",props:{style:{color:"#88C0D0"}}},{content:"(CapabilityFactory.PublicPath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            acct.link",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&CapabilityFactory.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFactory.Getter",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(CapabilityFactory.PublicPath, target: CapabilityFactory.StoragePath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        assert",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            acct.getCapability",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&CapabilityFactory.Manager{CapabilityFactory.Getter}",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(CapabilityFactory.PublicPath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:".",props:{style:{color:"#D8DEE9FF"}}},{content:"check",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:",",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            message: ",props:{style:{color:"#D8DEE9FF"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFactory is not setup properly",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        )",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" manager = acct.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&CapabilityFactory.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"from",props:{style:{color:"#81A1C1"}}},{content:": CapabilityFactory.StoragePath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            ?? ",props:{style:{color:"#81A1C1"}}},{content:"panic",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"manager not found",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        /// Add generic NFT-related Factory implementations to enable castable Capabilities from this Manager",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        manager.",props:{style:{color:"#D8DEE9FF"}}},{content:"addFactory",props:{style:{color:"#88C0D0"}}},{content:"(Type",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&{NonFungibleToken.CollectionPublic}",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:", NFTCollectionPublicFactory.",props:{style:{color:"#D8DEE9FF"}}},{content:"Factory",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:")",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        manager.",props:{style:{color:"#D8DEE9FF"}}},{content:"addFactory",props:{style:{color:"#88C0D0"}}},{content:"(Type",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&{NonFungibleToken.Provider, NonFungibleToken.CollectionPublic}",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:", NFTProviderAndCollectionFactory.",props:{style:{color:"#D8DEE9FF"}}},{content:"Factory",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:")",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        manager.",props:{style:{color:"#D8DEE9FF"}}},{content:"addFactory",props:{style:{color:"#88C0D0"}}},{content:"(Type",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&{NonFungibleToken.Provider}",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:", NFTProviderFactory.",props:{style:{color:"#D8DEE9FF"}}},{content:"Factory",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:")",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"    }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"}",props:{style:{color:"#ECEFF4"}}}]}],lang:"cadence"},annotations:[]}]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:e(19780).Z+"",loading:"lazy",alt:"resources/hybrid_custody_high_level",width:"3008",height:"1828"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:'In this scenario, a user custodies a key for their main account which maintains access to a wrapped AuthAccount\nCapability, providing the user restricted access on the app account. The app maintains custodial access to the account\nand regulates the access restrictions to delegatee "parent" accounts.'})}),"\n",(0,n.jsxs)(t.p,{children:["Linking accounts can be done in one of two ways. Put simply, the child account needs to get the parent account an\n",(0,n.jsx)(t.code,{children:"AuthAccount"})," Capability, and the parent needs to save that Capability so they can retain access in a manner that also\nrepresents each side of the link and safeguards the integrity of any access restrictions an application puts in place on\ndelegated access."]}),"\n",(0,n.jsx)(t.p,{children:"We can achieve issuance from the child account and claim from the parent account pattern in either:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["We can leverage ",(0,n.jsxs)(t.a,{href:"/docs/next/cadence/language/accounts#account-inbox",children:["Cadence\u2019s ",(0,n.jsx)(t.code,{children:"AuthAccount.Inbox"})]})," to publish the\nCapability from the child account & have the parent claim the Capability in a separate transaction."]}),"\n",(0,n.jsx)(t.li,{children:"Multi-party signed transaction, signed by both the the accounts on either side of the link"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Let\u2019s take a look at both."}),"\n",(0,n.jsxs)(c,{type:"info",children:[(0,n.jsxs)(t.p,{children:["You'll want to consider whether you would like the parent account to be configured with some app-specific resources or\nCapabilities and compose you multisig or claim transactions to include such configurations. ",(0,n.jsx)("br",{})]}),(0,n.jsx)(t.p,{children:"For example, if your app deals with specific NFTs, you may want to configure the parent account with Collections for\nthose NFTs so the user can easily transfer them between their linked accounts."})]}),"\n",(0,n.jsx)(t.h3,{id:"publish--claim",children:"Publish & Claim"}),"\n",(0,n.jsx)(t.h4,{id:"publish",children:"Publish"}),"\n",(0,n.jsx)(t.p,{children:"Here, the account delegating access to itself links its AuthAccount Capability, and publishes it to be claimed by the\naccount it will be linked to."}),"\n",(0,n.jsx)(d.Code,{codeConfig:y,northPanel:{tabs:["publish_to_parent.cdc"],active:"publish_to_parent.cdc",heightRatio:1},files:[{name:"publish_to_parent.cdc",focus:"",code:{lines:[{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFactory",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFilter",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"CapabilityDelegator",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"transaction",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"parent",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" Address, ",props:{style:{color:"#D8DEE9FF"}}},{content:"factoryAddress",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" Address, ",props:{style:{color:"#D8DEE9FF"}}},{content:"filterAddress",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" Address",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"    prepare",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"acct",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" AuthAccount",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" owned = acct.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.OwnedAccount",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"from",props:{style:{color:"#81A1C1"}}},{content:": HybridCustody.OwnedAccountStoragePath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            ?? ",props:{style:{color:"#81A1C1"}}},{content:"panic",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"owned account not found",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" factory = ",props:{style:{color:"#D8DEE9FF"}}},{content:"getAccount",props:{style:{color:"#88C0D0"}}},{content:"(factoryAddress",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:".getCapability",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&CapabilityFactory.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFactory.Getter",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(CapabilityFactory.PublicPath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        assert",props:{style:{color:"#88C0D0"}}},{content:"(factory.",props:{style:{color:"#D8DEE9FF"}}},{content:"check",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:", ",props:{style:{color:"#D8DEE9FF"}}},{content:"message",props:{style:{color:"#88C0D0"}}},{content:': "',props:{style:{color:"#ECEFF4"}}},{content:"factory address is not configured properly",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" filter = ",props:{style:{color:"#D8DEE9FF"}}},{content:"getAccount",props:{style:{color:"#88C0D0"}}},{content:"(filterAddress",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:".getCapability",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFilter.Filter",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(CapabilityFilter.PublicPath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        assert",props:{style:{color:"#88C0D0"}}},{content:"(filter.",props:{style:{color:"#D8DEE9FF"}}},{content:"check",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:", ",props:{style:{color:"#D8DEE9FF"}}},{content:"message",props:{style:{color:"#88C0D0"}}},{content:': "',props:{style:{color:"#ECEFF4"}}},{content:"capability filter is not configured properly",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        owned.",props:{style:{color:"#D8DEE9FF"}}},{content:"publishToParent",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"parentAddress",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" parent, ",props:{style:{color:"#D8DEE9FF"}}},{content:"factory",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" factory, ",props:{style:{color:"#D8DEE9FF"}}},{content:"filter",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" filter",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"    }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"}",props:{style:{color:"#ECEFF4"}}}]}],lang:"cadence"},annotations:[]}]}),"\n",(0,n.jsx)(t.h4,{id:"claim",children:"Claim"}),"\n",(0,n.jsxs)(t.p,{children:["On the other side, the receiving account claims the published ",(0,n.jsx)(t.code,{children:"ChildAccount"})," Capability, adding it to the signer's\n",(0,n.jsx)(t.code,{children:"HybridCustody.Manager.childAccounts"})," indexed on the child account's Address."]}),"\n",(0,n.jsx)(d.Code,{codeConfig:y,northPanel:{tabs:["redeem_account.cdc"],active:"redeem_account.cdc",heightRatio:1},files:[{name:"redeem_account.cdc",focus:"",code:{lines:[{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"MetadataViews",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFilter",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"transaction",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"childAddress",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" Address, ",props:{style:{color:"#D8DEE9FF"}}},{content:"filterAddress",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" Address",props:{style:{color:"#D8DEE9FF"}}},{content:"?",props:{style:{color:"#81A1C1"}}},{content:", ",props:{style:{color:"#D8DEE9FF"}}},{content:"filterPath",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" PublicPath",props:{style:{color:"#D8DEE9FF"}}},{content:"?",props:{style:{color:"#81A1C1"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"    prepare",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"acct",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" AuthAccount",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        var",props:{style:{color:"#81A1C1"}}},{content:" filter: ",props:{style:{color:"#D8DEE9FF"}}},{content:"Capability",props:{style:{color:"#81A1C1"}}},{content:"<&{",props:{style:{color:"#D8DEE9FF"}}},{content:"CapabilityFilter",props:{style:{color:"#81A1C1"}}},{content:".",props:{style:{color:"#D8DEE9FF"}}},{content:"Filter",props:{style:{color:"#81A1C1"}}},{content:"}>? = ",props:{style:{color:"#D8DEE9FF"}}},{content:"nil",props:{style:{color:"#81A1C1"}}}]},{tokens:[{content:"        if",props:{style:{color:"#81A1C1"}}},{content:" filterAddress ",props:{style:{color:"#D8DEE9FF"}}},{content:"!= nil &&",props:{style:{color:"#81A1C1"}}},{content:" filterPath ",props:{style:{color:"#D8DEE9FF"}}},{content:"!= nil ",props:{style:{color:"#81A1C1"}}},{content:"{",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            filter ",props:{style:{color:"#D8DEE9FF"}}},{content:"= ",props:{style:{color:"#81A1C1"}}},{content:"getAccount",props:{style:{color:"#88C0D0"}}},{content:"(filterAddress",props:{style:{color:"#D8DEE9FF"}}},{content:"!",props:{style:{color:"#81A1C1"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:".getCapability",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFilter.Filter",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(filterPath",props:{style:{color:"#D8DEE9FF"}}},{content:"!",props:{style:{color:"#81A1C1"}}},{content:")",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        if",props:{style:{color:"#81A1C1"}}},{content:" acct.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"from",props:{style:{color:"#81A1C1"}}},{content:": HybridCustody.ManagerStoragePath) ",props:{style:{color:"#D8DEE9FF"}}},{content:"== nil ",props:{style:{color:"#81A1C1"}}},{content:"{",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            let",props:{style:{color:"#81A1C1"}}},{content:" m <- HybridCustody.",props:{style:{color:"#D8DEE9FF"}}},{content:"createManager",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"filter",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" filter",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            acct.",props:{style:{color:"#D8DEE9FF"}}},{content:"save",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"<-",props:{style:{color:"#81A1C1"}}},{content:" m, ",props:{style:{color:"#D8DEE9FF"}}},{content:"to",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" HybridCustody.ManagerStoragePath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            acct.",props:{style:{color:"#D8DEE9FF"}}},{content:"unlink",props:{style:{color:"#88C0D0"}}},{content:"(HybridCustody.ManagerPublicPath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            acct.",props:{style:{color:"#D8DEE9FF"}}},{content:"unlink",props:{style:{color:"#88C0D0"}}},{content:"(HybridCustody.ManagerPrivatePath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            acct.link",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody.ManagerPrivate, HybridCustody.ManagerPublic",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                HybridCustody.ManagerPrivatePath,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                target: HybridCustody.ManagerStoragePath",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            )",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            acct.link",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody.ManagerPublic",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                HybridCustody.ManagerPublicPath,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                target: HybridCustody.ManagerStoragePath",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            )",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" inboxName = HybridCustody.",props:{style:{color:"#D8DEE9FF"}}},{content:"getChildAccountIdentifier",props:{style:{color:"#88C0D0"}}},{content:"(acct.address",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" cap = acct.inbox.claim",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.ChildAccount",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody.AccountPrivate, HybridCustody.AccountPublic, MetadataViews.Resolver",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                inboxName,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                provider: childAddress",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            ) ",props:{style:{color:"#D8DEE9FF"}}},{content:"?? ",props:{style:{color:"#81A1C1"}}},{content:"panic",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"child account cap not found",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" manager = acct.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"from",props:{style:{color:"#81A1C1"}}},{content:": HybridCustody.ManagerStoragePath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            ?? ",props:{style:{color:"#81A1C1"}}},{content:"panic",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"manager no found",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        manager.",props:{style:{color:"#D8DEE9FF"}}},{content:"addAccount",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"cap",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" cap",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"    }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"}",props:{style:{color:"#ECEFF4"}}}]}],lang:"cadence"},annotations:[]}]}),"\n",(0,n.jsx)(t.h3,{id:"multi-signed-transaction",children:"Multi-Signed Transaction"}),"\n",(0,n.jsxs)(t.p,{children:["We can combine the two transactions in ",(0,n.jsx)(t.a,{href:"#publish",children:"Publish"})," and ",(0,n.jsx)(t.a,{href:"#claim",children:"Claim"})," into a single multi-signed transaction to\nachieve Hybrid Custody in a single step."]}),"\n",(0,n.jsx)(c,{type:"info",children:(0,n.jsx)(t.p,{children:"Note that while the following code links both accounts in a single transaction, in practicality you may find it easier\nto execute publish and claim transactions separately depending on your custodial infrastructure."})}),"\n",(0,n.jsx)(d.Code,{codeConfig:y,northPanel:{tabs:["setup_multi_sig.cdc"],active:"setup_multi_sig.cdc",heightRatio:1},files:[{name:"setup_multi_sig.cdc",focus:"",code:{lines:[{tokens:[{content:"#allowAccountLinking",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFactory",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"CapabilityDelegator",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFilter",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"MetadataViews",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"transaction",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"parentFilterAddress",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" Address",props:{style:{color:"#D8DEE9FF"}}},{content:"?",props:{style:{color:"#81A1C1"}}},{content:", ",props:{style:{color:"#D8DEE9FF"}}},{content:"childAccountFactoryAddress",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" Address, ",props:{style:{color:"#D8DEE9FF"}}},{content:"childAccountFilterAddress",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" Address",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"    prepare",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"childAcct",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" AuthAccount, ",props:{style:{color:"#D8DEE9FF"}}},{content:"parentAcct",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" AuthAccount",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        // --------------------- Begin setup of child account ---------------------",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        var",props:{style:{color:"#81A1C1"}}},{content:" acctCap = childAcct.getCapability",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&AuthAccount",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(HybridCustody.LinkedAccountPrivatePath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        if !",props:{style:{color:"#81A1C1"}}},{content:"acctCap.",props:{style:{color:"#D8DEE9FF"}}},{content:"check",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            acctCap ",props:{style:{color:"#D8DEE9FF"}}},{content:"=",props:{style:{color:"#81A1C1"}}},{content:" childAcct.",props:{style:{color:"#D8DEE9FF"}}},{content:"linkAccount",props:{style:{color:"#88C0D0"}}},{content:"(HybridCustody.LinkedAccountPrivatePath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:"!",props:{style:{color:"#81A1C1"}}}]},{tokens:[{content:"        }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        if",props:{style:{color:"#81A1C1"}}},{content:" childAcct.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.OwnedAccount",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"from",props:{style:{color:"#81A1C1"}}},{content:": HybridCustody.OwnedAccountStoragePath) ",props:{style:{color:"#D8DEE9FF"}}},{content:"== nil ",props:{style:{color:"#81A1C1"}}},{content:"{",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            let",props:{style:{color:"#81A1C1"}}},{content:" ownedAccount <- HybridCustody.",props:{style:{color:"#D8DEE9FF"}}},{content:"createOwnedAccount",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"acct",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" acctCap",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            childAcct.",props:{style:{color:"#D8DEE9FF"}}},{content:"save",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"<-",props:{style:{color:"#81A1C1"}}},{content:"ownedAccount, ",props:{style:{color:"#D8DEE9FF"}}},{content:"to",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" HybridCustody.OwnedAccountStoragePath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // check that paths are all configured properly",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        childAcct.",props:{style:{color:"#D8DEE9FF"}}},{content:"unlink",props:{style:{color:"#88C0D0"}}},{content:"(HybridCustody.OwnedAccountPrivatePath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        childAcct.link",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.OwnedAccount",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody.BorrowableAccount, HybridCustody.OwnedAccountPublic, MetadataViews.Resolver",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            HybridCustody.OwnedAccountPrivatePath,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            target: HybridCustody.OwnedAccountStoragePath",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        )",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        childAcct.",props:{style:{color:"#D8DEE9FF"}}},{content:"unlink",props:{style:{color:"#88C0D0"}}},{content:"(HybridCustody.OwnedAccountPublicPath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        childAcct.link",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.OwnedAccount",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody.OwnedAccountPublic, MetadataViews.Resolver",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            HybridCustody.OwnedAccountPublicPath,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            target: HybridCustody.OwnedAccountStoragePath",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        )",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // --------------------- End setup of child account ---------------------",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // --------------------- Begin setup of parent account ---------------------",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        var",props:{style:{color:"#81A1C1"}}},{content:" filter: ",props:{style:{color:"#D8DEE9FF"}}},{content:"Capability",props:{style:{color:"#81A1C1"}}},{content:"<&{",props:{style:{color:"#D8DEE9FF"}}},{content:"CapabilityFilter",props:{style:{color:"#81A1C1"}}},{content:".",props:{style:{color:"#D8DEE9FF"}}},{content:"Filter",props:{style:{color:"#81A1C1"}}},{content:"}>? = ",props:{style:{color:"#D8DEE9FF"}}},{content:"nil",props:{style:{color:"#81A1C1"}}}]},{tokens:[{content:"        if",props:{style:{color:"#81A1C1"}}},{content:" parentFilterAddress ",props:{style:{color:"#D8DEE9FF"}}},{content:"!= nil ",props:{style:{color:"#81A1C1"}}},{content:"{",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            filter ",props:{style:{color:"#D8DEE9FF"}}},{content:"= ",props:{style:{color:"#81A1C1"}}},{content:"getAccount",props:{style:{color:"#88C0D0"}}},{content:"(parentFilterAddress",props:{style:{color:"#D8DEE9FF"}}},{content:"!",props:{style:{color:"#81A1C1"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:".getCapability",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFilter.Filter",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(CapabilityFilter.PublicPath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        if",props:{style:{color:"#81A1C1"}}},{content:" parentAcct.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"from",props:{style:{color:"#81A1C1"}}},{content:": HybridCustody.ManagerStoragePath) ",props:{style:{color:"#D8DEE9FF"}}},{content:"== nil ",props:{style:{color:"#81A1C1"}}},{content:"{",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            let",props:{style:{color:"#81A1C1"}}},{content:" m <- HybridCustody.",props:{style:{color:"#D8DEE9FF"}}},{content:"createManager",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"filter",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" filter",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            parentAcct.",props:{style:{color:"#D8DEE9FF"}}},{content:"save",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"<-",props:{style:{color:"#81A1C1"}}},{content:" m, ",props:{style:{color:"#D8DEE9FF"}}},{content:"to",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" HybridCustody.ManagerStoragePath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        parentAcct.",props:{style:{color:"#D8DEE9FF"}}},{content:"unlink",props:{style:{color:"#88C0D0"}}},{content:"(HybridCustody.ManagerPublicPath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        parentAcct.",props:{style:{color:"#D8DEE9FF"}}},{content:"unlink",props:{style:{color:"#88C0D0"}}},{content:"(HybridCustody.ManagerPrivatePath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        parentAcct.link",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody.ManagerPrivate, HybridCustody.ManagerPublic",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            HybridCustody.OwnedAccountPrivatePath,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            target: HybridCustody.ManagerStoragePath",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        )",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        parentAcct.link",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody.ManagerPublic",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            HybridCustody.OwnedAccountPublicPath,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            target: HybridCustody.ManagerStoragePath",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        )",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // --------------------- End setup of parent account ---------------------",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // Publish account to parent",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" owned = childAcct.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.OwnedAccount",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"from",props:{style:{color:"#81A1C1"}}},{content:": HybridCustody.OwnedAccountStoragePath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            ?? ",props:{style:{color:"#81A1C1"}}},{content:"panic",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"owned account not found",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" factory = ",props:{style:{color:"#D8DEE9FF"}}},{content:"getAccount",props:{style:{color:"#88C0D0"}}},{content:"(childAccountFactoryAddress",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            .getCapability",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&CapabilityFactory.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFactory.Getter",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(CapabilityFactory.PublicPath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        assert",props:{style:{color:"#88C0D0"}}},{content:"(factory.",props:{style:{color:"#D8DEE9FF"}}},{content:"check",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:", ",props:{style:{color:"#D8DEE9FF"}}},{content:"message",props:{style:{color:"#88C0D0"}}},{content:': "',props:{style:{color:"#ECEFF4"}}},{content:"factory address is not configured properly",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" filterForChild = ",props:{style:{color:"#D8DEE9FF"}}},{content:"getAccount",props:{style:{color:"#88C0D0"}}},{content:"(childAccountFilterAddress",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:".getCapability",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFilter.Filter",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(CapabilityFilter.PublicPath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        assert",props:{style:{color:"#88C0D0"}}},{content:"(filterForChild.",props:{style:{color:"#D8DEE9FF"}}},{content:"check",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:", ",props:{style:{color:"#D8DEE9FF"}}},{content:"message",props:{style:{color:"#88C0D0"}}},{content:': "',props:{style:{color:"#ECEFF4"}}},{content:"capability filter is not configured properly",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        owned.",props:{style:{color:"#D8DEE9FF"}}},{content:"publishToParent",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"parentAddress",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" parentAcct.address, ",props:{style:{color:"#D8DEE9FF"}}},{content:"factory",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" factory, ",props:{style:{color:"#D8DEE9FF"}}},{content:"filter",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" filterForChild",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // claim the account on the parent",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" inboxName = HybridCustody.",props:{style:{color:"#D8DEE9FF"}}},{content:"getChildAccountIdentifier",props:{style:{color:"#88C0D0"}}},{content:"(parentAcct.address",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" cap = parentAcct.inbox.claim",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.ChildAccount",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody.AccountPrivate, HybridCustody.AccountPublic, MetadataViews.Resolver",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                inboxName,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                provider: childAcct.address",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            ) ",props:{style:{color:"#D8DEE9FF"}}},{content:"?? ",props:{style:{color:"#81A1C1"}}},{content:"panic",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"child account cap not found",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" manager = parentAcct.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"from",props:{style:{color:"#81A1C1"}}},{content:": HybridCustody.ManagerStoragePath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            ?? ",props:{style:{color:"#81A1C1"}}},{content:"panic",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"manager no found",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        manager.",props:{style:{color:"#D8DEE9FF"}}},{content:"addAccount",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"cap",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" cap",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"    }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"}",props:{style:{color:"#ECEFF4"}}}]}],lang:"cadence"},annotations:[]}]}),"\n",(0,n.jsx)(t.h2,{id:"onboarding-flows",children:"Onboarding Flows"}),"\n",(0,n.jsx)(t.p,{children:"Given the ability to establish an account and later delegate access to a user, apps are freed from the constraints of\ndichotomous custodial & self-custodial paradigms. A developer can choose to onboard a user via traditional Web2 identity\nand later delegate access to the user\u2019s wallet account. Alternatively, an app can enable wallet authentication at the\noutset, creating an app-specific account & linking with the user\u2019s wallet account. As specified above, these two flows\nare known as walletless and blockchain-native onboarding respectively. Developers can choose to implement one for\nsimplicity or both for maximum flexibility."}),"\n",(0,n.jsx)(t.h3,{id:"walletless-onboarding",children:"Walletless Onboarding"}),"\n",(0,n.jsx)(t.p,{children:"The following transaction creates an account, funding creation via the signer and adding the provided public key. You'll\nnotice this transaction is pretty much your standard account creation. The magic for you will be how you custody the key\nfor this account (locally, KMS, wallet service, etc.) in a manner that allows your app to mediate onchain interactions\non behalf of your user."}),"\n",(0,n.jsx)(d.Code,{codeConfig:y,northPanel:{tabs:["walletless_onboarding"],active:"walletless_onboarding",heightRatio:1},files:[{name:"walletless_onboarding",focus:"",code:{lines:[{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"FungibleToken",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"FlowToken",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"transaction",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"pubKey",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" String, ",props:{style:{color:"#D8DEE9FF"}}},{content:"initialFundingAmt",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" UFix64",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\tprepare",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"signer",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" AuthAccount",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t/* --- Account Creation --- */",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\t// **NOTE:** your app may choose to separate creation depending on your custodial model)",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\t//",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\t// Create the child account, funding via the signer",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\tlet",props:{style:{color:"#81A1C1"}}},{content:" newAccount = ",props:{style:{color:"#D8DEE9FF"}}},{content:"AuthAccount",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"payer",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" signer",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"\t\t// Create a public key for the new account from string value in the provided arg",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\t// **NOTE:** You may want to specify a different signature algo for your use case",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\tlet",props:{style:{color:"#81A1C1"}}},{content:" key = ",props:{style:{color:"#D8DEE9FF"}}},{content:"PublicKey",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t\tpublicKey",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" pubKey.",props:{style:{color:"#D8DEE9FF"}}},{content:"decodeHex",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:",",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t\tsignatureAlgorithm",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" SignatureAlgorithm.ECDSA_P256",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t)",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"\t\t// Add the key to the new account",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\t// **NOTE:** You may want to specify a different hash algo & weight best for your use case",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\tnewAccount.keys.",props:{style:{color:"#D8DEE9FF"}}},{content:"add",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t\tpublicKey",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" key,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t\thashAlgorithm",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" HashAlgorithm.SHA3_256,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t\tweight",props:{style:{color:"#88C0D0"}}},{content:": ",props:{style:{color:"#ECEFF4"}}},{content:"1000",props:{style:{color:"#B48EAD"}}},{content:".",props:{style:{color:"#D8DEE9FF"}}},{content:"0",props:{style:{color:"#B48EAD"}}}]},{tokens:[{content:"\t\t)",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t/* --- (Optional) Additional Account Funding --- */",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\t//",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\t// Fund the new account if specified",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\tif",props:{style:{color:"#81A1C1"}}},{content:" initialFundingAmt ",props:{style:{color:"#D8DEE9FF"}}},{content:"> ",props:{style:{color:"#81A1C1"}}},{content:"0",props:{style:{color:"#B48EAD"}}},{content:".",props:{style:{color:"#D8DEE9FF"}}},{content:"0 ",props:{style:{color:"#B48EAD"}}},{content:"{",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"\t\t\t// Get a vault to fund the new account",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\t\tlet",props:{style:{color:"#81A1C1"}}},{content:" fundingProvider = signer.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&FlowToken.Vault",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"FungibleToken.Provider",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t\t\t\tfrom",props:{style:{color:"#81A1C1"}}},{content:": ",props:{style:{color:"#D8DEE9FF"}}},{content:"/",props:{style:{color:"#81A1C1"}}},{content:"storage",props:{style:{color:"#D8DEE9FF"}}},{content:"/",props:{style:{color:"#81A1C1"}}},{content:"flowTokenVault",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t\t\t)",props:{style:{color:"#D8DEE9FF"}}},{content:"!",props:{style:{color:"#81A1C1"}}}]},{tokens:[{content:"\t\t\t// Fund the new account with the initialFundingAmount specified",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\t\tnewAccount.getCapability",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&FlowToken.Vault",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"FungibleToken.Receiver",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t\t\t/",props:{style:{color:"#81A1C1"}}},{content:"public",props:{style:{color:"#D8DEE9FF"}}},{content:"/",props:{style:{color:"#81A1C1"}}},{content:"flowTokenReceiver",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t\t).",props:{style:{color:"#D8DEE9FF"}}},{content:"borrow",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:"!",props:{style:{color:"#81A1C1"}}}]},{tokens:[{content:"\t\t\t.",props:{style:{color:"#D8DEE9FF"}}},{content:"deposit",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t\t\tfrom",props:{style:{color:"#88C0D0"}}},{content:": ",props:{style:{color:"#ECEFF4"}}},{content:"<-",props:{style:{color:"#81A1C1"}}},{content:"fundingProvider.",props:{style:{color:"#D8DEE9FF"}}},{content:"withdraw",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t\t\t\tamount",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" initialFundingAmt",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t\t\t)",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"\t\t\t)",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"\t\t}",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"\t\t/* --- Continue with use case specific setup --- */",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\t//",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\t// At this point, the newAccount can further be configured as suitable for",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\t// use in your app (e.g. Setup a Collection, Mint NFT, Configure Vault, etc.)",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t\t// ...",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"\t}",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"}",props:{style:{color:"#ECEFF4"}}}]}],lang:"cadence"},annotations:[]}]}),"\n",(0,n.jsx)(t.h3,{id:"blockchain-native-onboarding",children:"Blockchain-Native Onboarding"}),"\n",(0,n.jsx)(t.p,{children:"This onboarding flow is really a single-transaction composition of the steps covered above. This is a testament to the\npower of the complex transactions you can compose on Flow with Cadence!"}),"\n",(0,n.jsxs)(c,{type:"info",children:[(0,n.jsxs)(t.p,{children:["Recall the ",(0,n.jsx)(t.a,{href:"#pre-requisites",children:"pre-requisites"})," needed to be satisfied before linking an account: ",(0,n.jsx)("br",{})]}),(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["CapabilityFilter Filter saved and linked ",(0,n.jsx)("br",{})]}),"\n",(0,n.jsx)(t.li,{children:"CapabilityFactory Manager saved and linked as well as Factory implementations supporting the Capability Types you'll\nwant accessible from linked child accounts as Typed Capabilities."}),"\n"]})]}),"\n",(0,n.jsx)(t.h4,{id:"account-creation--linking",children:"Account Creation & Linking"}),"\n",(0,n.jsx)(t.p,{children:"Compared to walletless onboarding where a user does not have a Flow account, blockchain-native onboarding assumes a user\nalready has a wallet configured and immediately links it with a newly created app account. This enables the app to\nsign transactions on the user's behalf via the new child account while immediately delegating control of that account to\nthe onboarding user's main account."}),"\n",(0,n.jsxs)(t.p,{children:["After this transaction, both the custodial party (presumably the client/app) and the signing parent account will have\naccess to the newly created account - the custodial party via key access and the parent account via their\n",(0,n.jsx)(t.code,{children:"HybridCustody.Manager"})," maintaining the new account's ",(0,n.jsx)(t.code,{children:"ChildAccount"})," Capability."]}),"\n",(0,n.jsx)(d.Code,{codeConfig:y,northPanel:{tabs:["blockchain_native_onboarding.cdc"],active:"blockchain_native_onboarding.cdc",heightRatio:1},files:[{name:"blockchain_native_onboarding.cdc",focus:"",code:{lines:[{tokens:[{content:"#allowAccountLinking",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"FungibleToken",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"FlowToken",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"MetadataViews",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFactory",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFilter",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"import ",props:{style:{color:"#81A1C1"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"CapabilityDelegator",props:{style:{color:"#A3BE8C"}}},{content:'"',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"transaction",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"    pubKey",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" String,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"    initialFundingAmt",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" UFix64,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"    factoryAddress",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" Address,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"    filterAddress",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" Address",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"    prepare",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"parent",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" AuthAccount, ",props:{style:{color:"#D8DEE9FF"}}},{content:"app",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" AuthAccount",props:{style:{color:"#D8DEE9FF"}}},{content:") {",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        /* --- Account Creation --- */",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        //",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        // Create the child account, funding via the signing app account",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" newAccount = ",props:{style:{color:"#D8DEE9FF"}}},{content:"AuthAccount",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"payer",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" app",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        // Create a public key for the child account from string value in the provided arg",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        // **NOTE:** You may want to specify a different signature algo for your use case",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" key = ",props:{style:{color:"#D8DEE9FF"}}},{content:"PublicKey",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            publicKey",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" pubKey.",props:{style:{color:"#D8DEE9FF"}}},{content:"decodeHex",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:",",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            signatureAlgorithm",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" SignatureAlgorithm.ECDSA_P256",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        )",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        // Add the key to the new account",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        // **NOTE:** You may want to specify a different hash algo & weight best for your use case",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        newAccount.keys.",props:{style:{color:"#D8DEE9FF"}}},{content:"add",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            publicKey",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" key,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            hashAlgorithm",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" HashAlgorithm.SHA3_256,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            weight",props:{style:{color:"#88C0D0"}}},{content:": ",props:{style:{color:"#ECEFF4"}}},{content:"1000",props:{style:{color:"#B48EAD"}}},{content:".",props:{style:{color:"#D8DEE9FF"}}},{content:"0",props:{style:{color:"#B48EAD"}}}]},{tokens:[{content:"        )",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        /* --- (Optional) Additional Account Funding --- */",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        //",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        // Fund the new account if specified",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        if",props:{style:{color:"#81A1C1"}}},{content:" initialFundingAmt ",props:{style:{color:"#D8DEE9FF"}}},{content:"> ",props:{style:{color:"#81A1C1"}}},{content:"0",props:{style:{color:"#B48EAD"}}},{content:".",props:{style:{color:"#D8DEE9FF"}}},{content:"0 ",props:{style:{color:"#B48EAD"}}},{content:"{",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            // Get a vault to fund the new account",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"            let",props:{style:{color:"#81A1C1"}}},{content:" fundingProvider = app.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&FlowToken.Vault",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"FungibleToken.Provider",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                    from",props:{style:{color:"#81A1C1"}}},{content:": ",props:{style:{color:"#D8DEE9FF"}}},{content:"/",props:{style:{color:"#81A1C1"}}},{content:"storage",props:{style:{color:"#D8DEE9FF"}}},{content:"/",props:{style:{color:"#81A1C1"}}},{content:"flowTokenVault",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                )",props:{style:{color:"#D8DEE9FF"}}},{content:"!",props:{style:{color:"#81A1C1"}}}]},{tokens:[{content:"            // Fund the new account with the initialFundingAmount specified",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"            newAccount.getCapability",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&FlowToken.Vault",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"FungibleToken.Receiver",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"/",props:{style:{color:"#81A1C1"}}},{content:"public",props:{style:{color:"#D8DEE9FF"}}},{content:"/",props:{style:{color:"#81A1C1"}}},{content:"flowTokenReceiver)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                .",props:{style:{color:"#D8DEE9FF"}}},{content:"borrow",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:"!",props:{style:{color:"#81A1C1"}}}]},{tokens:[{content:"                .",props:{style:{color:"#D8DEE9FF"}}},{content:"deposit",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                    from",props:{style:{color:"#88C0D0"}}},{content:": ",props:{style:{color:"#ECEFF4"}}},{content:"<-",props:{style:{color:"#81A1C1"}}},{content:"fundingProvider.",props:{style:{color:"#D8DEE9FF"}}},{content:"withdraw",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                        amount",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" initialFundingAmt",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                    )",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"                )",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        /* Continue with use case specific setup */",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        //",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        // At this point, the newAccount can further be configured as suitable for",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        // use in your app (e.g. Setup a Collection, Mint NFT, Configure Vault, etc.)",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        // ...",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        /* --- Link the AuthAccount Capability --- */",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        //",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        var",props:{style:{color:"#81A1C1"}}},{content:" acctCap = newAccount.",props:{style:{color:"#D8DEE9FF"}}},{content:"linkAccount",props:{style:{color:"#88C0D0"}}},{content:"(HybridCustody.LinkedAccountPrivatePath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            ?? ",props:{style:{color:"#81A1C1"}}},{content:"panic",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"problem linking account Capability for new account",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // Create a OwnedAccount & link Capabilities",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" ownedAccount <- HybridCustody.",props:{style:{color:"#D8DEE9FF"}}},{content:"createOwnedAccount",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"acct",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" acctCap",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        newAccount.",props:{style:{color:"#D8DEE9FF"}}},{content:"save",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"<-",props:{style:{color:"#81A1C1"}}},{content:"ownedAccount, ",props:{style:{color:"#D8DEE9FF"}}},{content:"to",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" HybridCustody.OwnedAccountStoragePath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        newAccount",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            .link",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.OwnedAccount",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody.BorrowableAccount, HybridCustody.OwnedAccountPublic, MetadataViews.Resolver",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                HybridCustody.OwnedAccountPrivatePath,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                target: HybridCustody.OwnedAccountStoragePath",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            )",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        newAccount",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            .link",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.OwnedAccount",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody.OwnedAccountPublic",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                HybridCustody.OwnedAccountPublicPath,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                target: HybridCustody.OwnedAccountStoragePath",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            )",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // Get a reference to the OwnedAccount resource",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" owned = newAccount.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.OwnedAccount",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"from",props:{style:{color:"#81A1C1"}}},{content:": HybridCustody.OwnedAccountStoragePath)",props:{style:{color:"#D8DEE9FF"}}},{content:"!",props:{style:{color:"#81A1C1"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // Get the CapabilityFactory.Manager Capability",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" factory = ",props:{style:{color:"#D8DEE9FF"}}},{content:"getAccount",props:{style:{color:"#88C0D0"}}},{content:"(factoryAddress",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            .getCapability",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&CapabilityFactory.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFactory.Getter",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                CapabilityFactory.PublicPath",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            )",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        assert",props:{style:{color:"#88C0D0"}}},{content:"(factory.",props:{style:{color:"#D8DEE9FF"}}},{content:"check",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:", ",props:{style:{color:"#D8DEE9FF"}}},{content:"message",props:{style:{color:"#88C0D0"}}},{content:': "',props:{style:{color:"#ECEFF4"}}},{content:"factory address is not configured properly",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // Get the CapabilityFilter.Filter Capability",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" filter = ",props:{style:{color:"#D8DEE9FF"}}},{content:"getAccount",props:{style:{color:"#88C0D0"}}},{content:"(filterAddress",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:".getCapability",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"CapabilityFilter.Filter",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(CapabilityFilter.PublicPath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        assert",props:{style:{color:"#88C0D0"}}},{content:"(filter.",props:{style:{color:"#D8DEE9FF"}}},{content:"check",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}},{content:", ",props:{style:{color:"#D8DEE9FF"}}},{content:"message",props:{style:{color:"#88C0D0"}}},{content:': "',props:{style:{color:"#ECEFF4"}}},{content:"capability filter is not configured properly",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // Configure access for the delegatee parent account",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        owned.",props:{style:{color:"#D8DEE9FF"}}},{content:"publishToParent",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"parentAddress",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" parent.address, ",props:{style:{color:"#D8DEE9FF"}}},{content:"factory",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" factory, ",props:{style:{color:"#D8DEE9FF"}}},{content:"filter",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" filter",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        /* --- Add delegation to parent account --- */",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        //",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        // Configure HybridCustody.Manager if needed",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        if",props:{style:{color:"#81A1C1"}}},{content:" parent.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"from",props:{style:{color:"#81A1C1"}}},{content:": HybridCustody.ManagerStoragePath) ",props:{style:{color:"#D8DEE9FF"}}},{content:"== nil ",props:{style:{color:"#81A1C1"}}},{content:"{",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            let",props:{style:{color:"#81A1C1"}}},{content:" m <- HybridCustody.",props:{style:{color:"#D8DEE9FF"}}},{content:"createManager",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"filter",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" filter",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"            parent.",props:{style:{color:"#D8DEE9FF"}}},{content:"save",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"<-",props:{style:{color:"#81A1C1"}}},{content:" m, ",props:{style:{color:"#D8DEE9FF"}}},{content:"to",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" HybridCustody.ManagerStoragePath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // Link Capabilities",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        parent.",props:{style:{color:"#D8DEE9FF"}}},{content:"unlink",props:{style:{color:"#88C0D0"}}},{content:"(HybridCustody.ManagerPublicPath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        parent.",props:{style:{color:"#D8DEE9FF"}}},{content:"unlink",props:{style:{color:"#88C0D0"}}},{content:"(HybridCustody.ManagerPrivatePath",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        parent.link",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody.ManagerPrivate, HybridCustody.ManagerPublic",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            HybridCustody.ManagerPrivatePath,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            target: HybridCustody.ManagerStoragePath",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        )",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        parent.link",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody.ManagerPublic",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            HybridCustody.ManagerPublicPath,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            target: HybridCustody.ManagerStoragePath",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        )",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // Claim the ChildAccount Capability",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" inboxName = HybridCustody.",props:{style:{color:"#D8DEE9FF"}}},{content:"getChildAccountIdentifier",props:{style:{color:"#88C0D0"}}},{content:"(parent.address",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" cap = parent",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            .inbox",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            .claim",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.ChildAccount",props:{style:{color:"#D8DEE9FF"}}},{content:"{",props:{style:{color:"#ECEFF4"}}},{content:"HybridCustody.AccountPrivate, HybridCustody.AccountPublic, MetadataViews.Resolver",props:{style:{color:"#D8DEE9FF"}}},{content:"}",props:{style:{color:"#ECEFF4"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                inboxName,",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"                provider: newAccount.address",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            ) ",props:{style:{color:"#D8DEE9FF"}}},{content:"?? ",props:{style:{color:"#81A1C1"}}},{content:"panic",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"child account cap not found",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"        // Get a reference to the Manager and add the account",props:{style:{color:"#616E88"}}}]},{tokens:[{content:"        let",props:{style:{color:"#81A1C1"}}},{content:" managerRef = parent.borrow",props:{style:{color:"#D8DEE9FF"}}},{content:"<",props:{style:{color:"#81A1C1"}}},{content:"&HybridCustody.Manager",props:{style:{color:"#D8DEE9FF"}}},{content:">",props:{style:{color:"#81A1C1"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"from",props:{style:{color:"#81A1C1"}}},{content:": HybridCustody.ManagerStoragePath)",props:{style:{color:"#D8DEE9FF"}}}]},{tokens:[{content:"            ?? ",props:{style:{color:"#81A1C1"}}},{content:"panic",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:'"',props:{style:{color:"#ECEFF4"}}},{content:"manager no found",props:{style:{color:"#A3BE8C"}}},{content:'")',props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"        managerRef.",props:{style:{color:"#D8DEE9FF"}}},{content:"addAccount",props:{style:{color:"#88C0D0"}}},{content:"(",props:{style:{color:"#D8DEE9FF"}}},{content:"cap",props:{style:{color:"#88C0D0"}}},{content:":",props:{style:{color:"#ECEFF4"}}},{content:" cap",props:{style:{color:"#D8DEE9FF"}}},{content:")",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"    }",props:{style:{color:"#ECEFF4"}}}]},{tokens:[{content:"}",props:{style:{color:"#ECEFF4"}}}]}],lang:"cadence"},annotations:[]}]}),"\n",(0,n.jsx)(t.h2,{id:"funding--custody-patterns",children:"Funding & Custody Patterns"}),"\n",(0,n.jsx)(t.p,{children:"Aside from implementing onboarding flows & account linking, you'll want to also consider the account funding & custodial\npattern appropriate for the app you're building. The only pattern compatible with walletless onboarding (and therefore\nthe only one showcased above) is one in which the app custodies the child account's key and funds account creation."}),"\n",(0,n.jsxs)(t.p,{children:["In general, the funding pattern for account creation will determine to some extent the backend infrastructure needed to\nsupport your app and the onboarding flow your app can support. For example, if you want to to create a service-less\nclient (a totally local app without backend infrastructure), you could forego walletless onboarding in favor of a\nuser-funded blockchain-native onboarding to achieve a hybrid custody model. Your app maintains the keys to the app\naccount locally to sign on behalf of the user, and the user funds the creation of the the account, linking to their main\naccount on account creation. This would be a ",(0,n.jsx)(t.strong,{children:"user-funded, app custodied"})," pattern."]}),"\n",(0,n.jsx)(t.p,{children:"Again, custody may deserve some regulatory insight depending on your jurisdiction. If building for production, you'll\nlikely want to consider these non-technical implications in your technical decision-making. Such is the nature of\nbuilding in crypto."}),"\n",(0,n.jsx)(t.p,{children:"Here are the patterns you might consider:"}),"\n",(0,n.jsx)(t.h3,{id:"app-funded-app-custodied",children:"App-Funded, App-Custodied"}),"\n",(0,n.jsx)(t.p,{children:"If you want to implement walletless onboarding, you can stop here as this is the only compatible pattern. In this\nscenario, a backend app account funds the creation of a new account and the app custodies the key for said account\neither on the user's device or some backend KMS."}),"\n",(0,n.jsx)(t.h3,{id:"app-funded-user-custodied",children:"App-Funded, User-Custodied"}),"\n",(0,n.jsxs)(t.p,{children:["In this case, the backend app account funds account creation, but adds a key to the account which the user custodies.\nIn order for the app to act on the user's behalf, it has to be delegated access via AuthAccount Capability which the\nbackend app account would maintain in a ",(0,n.jsx)(t.code,{children:"HybridCustody.Manager"}),". This means that the new account would have two parent\naccounts - the user's and the app. While this pattern provides the user maximum ownership and authority over the child\naccount, this pattern may present unique considerations and edge cases for you as a builder depending on access to the\nchild account. Also note that this and the following patterns are incompatible with walletless onboarding in that the\nuser must have a wallet."]}),"\n",(0,n.jsx)(t.h3,{id:"user-funded-app-custodied",children:"User-Funded, App-Custodied"}),"\n",(0,n.jsx)(t.p,{children:"As mentioned above, this pattern unlocks totally service-less architectures - just a local client & smart contracts. An\nauthenticated user signs a transaction creating an account, adding the key provided by the client, and linking the\naccount as a child account. At the end of the transaction, hybrid custody is achieved and the app can sign with the\ncustodied key on the user's behalf using the newly created account."}),"\n",(0,n.jsx)(t.h3,{id:"user-funded-user-custodied",children:"User-Funded, User-Custodied"}),"\n",(0,n.jsx)(t.p,{children:"While perhaps not useful for most apps, this pattern may be desirable for advanced users who wish to create a shared\naccess account themselves. The user funds account creation, adding keys they custody, and delegates secondary access to\nsome other account."})]})}const E=function(o){void 0===o&&(o={});const{wrapper:t}=Object.assign({},(0,r.ah)(),o.components);return t?(0,n.jsx)(t,Object.assign({},o,{children:(0,n.jsx)(F,o)})):F(o)};function u(o,t){throw new Error("Expected "+(t?"component":"object")+" `"+o+"` to be defined: you likely forgot to import, pass, or provide it.")}},19780:(o,t,e)=>{e.d(t,{Z:()=>n});const n=e.p+"assets/images/hybrid_custody_high_level-be75530524760af5f714adef4fae48dd.png"}}]);