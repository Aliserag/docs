"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[8199],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var c=n.createContext({}),l=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},u=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=l(a),d=o,m=p["".concat(c,".").concat(d)]||p[d]||h[d]||r;return a?n.createElement(m,s(s({ref:t},u),{},{components:a})):n.createElement(m,s({ref:t},u))}));function m(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,s=new Array(r);s[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[p]="string"==typeof e?e:o,s[1]=i;for(var l=2;l<r;l++)s[l]=a[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},71854:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var n=a(87462),o=(a(67294),a(3905));const r={title:"Storing Data on Flow"},s=void 0,i={unversionedId:"1.Learn/Concepts/storage",id:"1.Learn/Concepts/storage",title:"Storing Data on Flow",description:"Overview",source:"@site/docs/1.Learn/Concepts/storage.mdx",sourceDirName:"1.Learn/Concepts",slug:"/1.Learn/Concepts/storage",permalink:"/1.Learn/Concepts/storage",draft:!1,tags:[],version:"current",lastUpdatedBy:"Tom Haile",lastUpdatedAt:1682538265,formattedLastUpdatedAt:"Apr 26, 2023",frontMatter:{title:"Storing Data on Flow"},sidebar:"tutorialSidebar",previous:{title:"Slashing Conditions",permalink:"/1.Learn/Concepts/slashing"},next:{title:"Token Staking Process",permalink:"/1.Learn/Concepts/token-staking"}},c={},l=[{value:"Overview",id:"overview",level:2},{value:"Storage Capacity",id:"storage-capacity",level:2},{value:"Storage Capacity of the Payer",id:"storage-capacity-of-the-payer",level:3},{value:"Storage Used",id:"storage-used",level:2},{value:"Storage Parameters",id:"storage-parameters",level:2},{value:"FAQ",id:"faq",level:2},{value:"Why is there an account minimum balance?",id:"why-is-there-an-account-minimum-balance",level:3},{value:"What is my current storage usage?",id:"what-is-my-current-storage-usage",level:3},{value:"Further reading",id:"further-reading",level:2}],u={toc:l},p="wrapper";function h(e){let{components:t,...a}=e;return(0,o.kt)(p,(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"Each Flow account has an associated storage used. The account's storage used is the byte size of all the data stored in the account's storage. Accounts also have a storage capacity, which is directly tied to the amount of Flow tokens an account has. The account can, without any additional cost, use any amount of storage up to its storage capacity. ",(0,o.kt)("strong",{parentName:"p"},"If a transaction puts an account over storage capacity, that transaction fails and is reverted. Likewise, if a transaction would drop an account's balance below 0.001 Flow tokens, which is the minimum an account can have, the transaction would also fail.")),(0,o.kt)("h2",{id:"storage-capacity"},"Storage Capacity"),(0,o.kt)("p",null,"Storage capacity of an account is dictated by the amount of FLOW it has. ",(0,o.kt)("strong",{parentName:"p"},"The minimum amount of FLOW an account can have is 0.001. This minimum is provided by the account creator at account creation.")," The minimum account reservation ensures that most accounts won't run out of storage capacity if anyone deposits anything (like an NFT) to the account."),(0,o.kt)("p",null,"The exact amount of storage capacity an account has is the amount of FLOW the account has times the ",(0,o.kt)("inlineCode",{parentName:"p"},"storageBytesPerReservedFlow")," variable defined on the ",(0,o.kt)("inlineCode",{parentName:"p"},"StorageFees")," smart contract, which is:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"100 MB per 1 reserved FLOW, or"),(0,o.kt)("li",{parentName:"ul"},"10 MB per 0.1 reserved FLOW, or"),(0,o.kt)("li",{parentName:"ul"},"1 MB per 0.01 reserved FLOW, or"),(0,o.kt)("li",{parentName:"ul"},"100 kB per 0.001 reserved FLOW.")),(0,o.kt)("p",null,"Any account can increase the storage capacity of an account by depositing more FLOW to the account."),(0,o.kt)("p",null,"If the accounts balance is below the minimum account balance, the account's storage capacity is considered to be 0."),(0,o.kt)("h3",{id:"storage-capacity-of-the-payer"},"Storage Capacity of the Payer"),(0,o.kt)("p",null,"The storage capacity of the Payer of a transaction is generally computed the same way as the capacity of any other account, however the system needs to account for the transaction fees the payer will incur at the end of the transaction. The final amount of transaction fees is not yet fully known at the step when accounts are being checked for storage compliance (if their storage used is below their storage capacity). Because of this, the payer's balance is conservatively considered to be lower by the maximum possible transaction fees, when checking for storage compliance. The maximum transaction fee of a specific transaction is the transaction fee as if the transaction would have used up all of its execution effort limit."),(0,o.kt)("h2",{id:"storage-used"},"Storage Used"),(0,o.kt)("p",null,"All data that is in an account's storage counts towards storage used. Even when an account is newly created it is not empty. There are already some items in its storage:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Metadata that marks that the account exists."),(0,o.kt)("li",{parentName:"ul"},"An empty FLOW vault, and stored receiver capability."),(0,o.kt)("li",{parentName:"ul"},"Public keys to the account if the account was created with keys."),(0,o.kt)("li",{parentName:"ul"},"Smart contracts deployed on the account if the account was created with contracts."),(0,o.kt)("li",{parentName:"ul"},"The value of the account\u2019s storage used as an unsigned integer.")),(0,o.kt)("p",null,"Adding additional keys, smart contracts, capabilities, resources, etc. to the account counts towards storage used."),(0,o.kt)("p",null,"Data stored on the Flow blockchain is stored in a key-value ledger. Each item\u2019s key contains the address that owns the item and the path to the item. Just as the shipping cost of a box of things you send to a friend includes the weight of the carton box itself, storing items on flow takes into account the key it is stored with. This means that the storage used by each item is the byte length of the item plus the byte length of the item\u2019s key."),(0,o.kt)("h2",{id:"storage-parameters"},"Storage Parameters"),(0,o.kt)("p",null,"Two parameters define storage limits:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Minimum account FLOW is ",(0,o.kt)("strong",{parentName:"li"},"0.001 FLOW")," and represents ",(0,o.kt)("strong",{parentName:"li"},"100 kB")," of storage capacity. This is also the amount of FLOW that the creator of a new account needs to provide for the account's storage reservation. (",(0,o.kt)("inlineCode",{parentName:"li"},"StorageFees.minimumStorageReservation"),")"),(0,o.kt)("li",{parentName:"ul"},"The amount of storage capacity one FLOW represents is ",(0,o.kt)("strong",{parentName:"li"},"100 MB per FLOW"),". (",(0,o.kt)("inlineCode",{parentName:"li"},"StorageFees.storageMegaBytesPerReservedFlow"),")")),(0,o.kt)("h2",{id:"faq"},"FAQ"),(0,o.kt)("h3",{id:"why-is-there-an-account-minimum-balance"},"Why is there an account minimum balance?"),(0,o.kt)("p",null,"The more data that is stored on Flow,\nthe higher the storage requirements for execution nodes that need to store the data.\nAs the size of the data grows,\nit's more and more difficult and costly for the execution nodes to meet those requirements.\nStorage fees were put in place to regulate the growth of data stored on the Flow blockchain."),(0,o.kt)("h3",{id:"what-is-my-current-storage-usage"},"What is my current storage usage?"),(0,o.kt)("p",null,"The values of storage used and storage capacity are available as fields both on ",(0,o.kt)("inlineCode",{parentName:"p"},"AuthAccount")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"PublicAccount")," Cadence types."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cadence"},"pub fun main(address: Address) {\n    let account = getAccount(address)\n    log(account.storageUsed)\n    log(account.storageCapacity)\n}\n")),(0,o.kt)("h2",{id:"further-reading"},"Further reading"),(0,o.kt)("p",null,"Relevant Cadence changes can be found here: ",(0,o.kt)("a",{parentName:"p",href:"https://docs.onflow.org/cadence/language/accounts#account-storage"},"https://docs.onflow.org/cadence/language/accounts#account-storage")),(0,o.kt)("p",null,"The ",(0,o.kt)("strong",{parentName:"p"},"FLIP")," (Flow Improvement Proposal) for storage fees can be found here: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/onflow/flips/blob/main/flips/20201310-storage-fees.md"},"20201310-storage-fees.md"),"."))}h.isMDXComponent=!0}}]);