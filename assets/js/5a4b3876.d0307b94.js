"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[8087],{3905:(e,t,o)=>{o.d(t,{Zo:()=>p,kt:()=>y});var n=o(67294);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,n,a=function(e,t){if(null==e)return{};var o,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var l=n.createContext({}),d=function(e){var t=n.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},p=function(e){var t=d(e.components);return n.createElement(l.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var o=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=d(o),h=a,y=u["".concat(l,".").concat(h)]||u[h]||c[h]||r;return o?n.createElement(y,i(i({ref:t},p),{},{components:o})):n.createElement(y,i({ref:t},p))}));function y(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=o.length,i=new Array(r);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:a,i[1]=s;for(var d=2;d<r;d++)i[d]=o[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}h.displayName="MDXCreateElement"},48766:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var n=o(87462),a=(o(67294),o(3905));const r={title:"Genesis Bootstrapping"},i=void 0,s={unversionedId:"nodes/node-operation/guides/genesis-bootstrap",id:"nodes/node-operation/guides/genesis-bootstrap",title:"Genesis Bootstrapping",description:"\x3c!--",source:"@site/docs/nodes/node-operation/guides/genesis-bootstrap.mdx",sourceDirName:"nodes/node-operation/guides",slug:"/nodes/node-operation/guides/genesis-bootstrap",permalink:"/nodes/node-operation/guides/genesis-bootstrap",draft:!1,tags:[],version:"current",lastUpdatedBy:"Tom Haile",lastUpdatedAt:1682540899,formattedLastUpdatedAt:"Apr 26, 2023",frontMatter:{title:"Genesis Bootstrapping"},sidebar:"tutorialSidebar",previous:{title:"Operator FAQ",permalink:"/nodes/node-operation/faq"},next:{title:"Spork Practice",permalink:"/nodes/node-operation/guides/spork-practice"}},l={},d=[{value:"Overview",id:"overview",level:2},{value:"Before You Begin",id:"before-you-begin",level:2},{value:"Download the Bootstrapping Toolkit",id:"download-the-bootstrapping-toolkit",level:2},{value:"Generate Your Node Keys",id:"generate-your-node-keys",level:2},{value:"Upload Public Keys",id:"upload-public-keys",level:2},{value:"Update Node Config",id:"update-node-config",level:2},{value:"Wait",id:"wait",level:3},{value:"Receive Your Random Beacon Keys",id:"receive-your-random-beacon-keys",level:2},{value:"Move Genesis Data",id:"move-genesis-data",level:2},{value:"New Images",id:"new-images",level:2},{value:"Start Your Nodes",id:"start-your-nodes",level:2}],p={toc:d},u="wrapper";function c(e){let{components:t,...o}=e;return(0,a.kt)(u,(0,n.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"To kickstart the Flow network and build the first block, all the nodes that will participate in the first round of consensus need to be known and have exchanged some metadata in advance."),(0,a.kt)("p",null,"This guide will take you through setting up your nodes, running the initial metadata and key generation, exchanging data back and forth with the Flow team, and then finally starting your nodes to join the network."),(0,a.kt)("h2",{id:"before-you-begin"},"Before You Begin"),(0,a.kt)("p",null,"The Flow consensus algorithm depends on there always being a previous block, which means your nodes cannot start until ",(0,a.kt)("em",{parentName:"p"},"after")," the Genesis block has been signed. The process of signing that block will be done by the Flow team, and can only be done after every node has completed the first half of the bootstrapping process, which assures that all the identities are included. Since the Flow team needs to wait for metadata from all participants, it will take hours to even days until the Flow network can start."),(0,a.kt)("p",null,"The bootstrapping process will be in 2 phases, with the Flow team signing the Genesis block between the two."),(0,a.kt)("h2",{id:"download-the-bootstrapping-toolkit"},"Download the Bootstrapping Toolkit"),(0,a.kt)("p",null,"Both phases of the bootstrapping are automated with scripts. Pull a copy onto each of your nodes and extract it."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell:",metastring:'title="Pull boot-tools"',title:'"Pull','boot-tools"':!0},"~ $ curl -sL -O storage.googleapis.com/flow-genesis-bootstrap/boot-tools.tar\\n~ $ tar -xvf boot-tools.tar\n")),(0,a.kt)("h2",{id:"generate-your-node-keys"},"Generate Your Node Keys"),(0,a.kt)("p",null,"Start the bootstrapping process by generating your Staking Key and Networking Key. Use your Node Address that you generated in ",(0,a.kt)("a",{parentName:"p",href:"doc:setting-up-a-node"},"Setting Up a Node")," in the ",(0,a.kt)("inlineCode",{parentName:"p"},"--address")," flag, and the node role."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:'language-shell:title="Generate',metastring:'bootstrap keys"',bootstrap:!0,'keys"':!0},'~ $ mkdir ./bootstrap\\n~ $ ./boot-tools/bootstrap key --address \\"${YOUR_NODE_ADDRESS}:3569\\" --role ${YOUR_NODE_ROLE} -o ./bootstrap\n')),(0,a.kt)("p",null,"This command generates two keys, a Staking Key and a Network Key, and stores them both in a ",(0,a.kt)("inlineCode",{parentName:"p"},".node-info")," file. Both these keys are needed during runtime and must be present as a file to start your flow node."),(0,a.kt)("p",null,"For more details around all the keys that are needed to run nodes and their usage, see the ",(0,a.kt)("a",{parentName:"p",href:"doc:node-keys"},"Node Keys")," overview."),(0,a.kt)("p",null,"The bootstrapping process will create a file structure similar to the following"),(0,a.kt)("h2",{id:"upload-public-keys"},"Upload Public Keys"),(0,a.kt)("p",null,"To mint the Genesis Block, the Flow team will need the public Staking and Network keys from all your nodes."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"If you have previously joined our networks, and you are generating your keys again. Ensure that you take a backup of your keys before generating it again")),(0,a.kt)("p",null,"To facilitate this, the boot-tools directory comes with a script ",(0,a.kt)("inlineCode",{parentName:"p"},"push-keys")," that will bundle your ",(0,a.kt)("inlineCode",{parentName:"p"},"*.pub.json")," files and send it to the flow team. You can inspect this script to make sure no private key material is being bundled or uploaded. The data not encrypted before being sent as the public keys involved are not sensitive."),(0,a.kt)("p",null,"In phase 2 of the bootstrapping process, the Flow team will need to securely issue each node a Random Beacon key. This key is again sensitive and unique to your node. To enable this, the ",(0,a.kt)("inlineCode",{parentName:"p"},"push-keys")," script also generates another key pair called the Transit Key. The public key of this pair will be uploaded along with the Staking and Network keys, and your Random Beacon key will be encrypted with it before being sent to you. You must keep your Transit Key until you have received and decrypted your Random Beacon key from the Flow team."),(0,a.kt)("h2",{id:"update-node-config"},"Update Node Config"),(0,a.kt)("p",null,"As flow node requires a ",(0,a.kt)("inlineCode",{parentName:"p"},"--nodeid")," flag to start. You will need to pass in the contents of the ",(0,a.kt)("inlineCode",{parentName:"p"},"node-id")," into either your container, ",(0,a.kt)("inlineCode",{parentName:"p"},"runtime-config.env")," file, or hard coded into the ",(0,a.kt)("inlineCode",{parentName:"p"},"systemd")," unit file which the flow team provides."),(0,a.kt)("p",null,"You can get the ",(0,a.kt)("inlineCode",{parentName:"p"},"node-id")," from the metadata that you pulled. It will be at: ",(0,a.kt)("inlineCode",{parentName:"p"},"/path/to/bootstrap/public-genesis-information/node-id")),(0,a.kt)("h3",{id:"wait"},"Wait"),(0,a.kt)("p",null,"Now the ball is in the Flow team's court. As soon as all nodes have completed the above steps, the Genesis block will be created and distributed to you."),(0,a.kt)("p",null,"Join the ",(0,a.kt)("a",{parentName:"p",href:"https://chat.onflow.org"},"Flow discord server")," if you haven't already and stay tuned for updates. Your nodes need not be online during this waiting period if you want to suspend them to reduce cost, but you must not lose your key material."),(0,a.kt)("h2",{id:"receive-your-random-beacon-keys"},"Receive Your Random Beacon Keys"),(0,a.kt)("p",null,"When the Flow team gives the go-ahead, your Random Beacon keys will be available for retrieval. Each Node will need to pull their own keys down individually."),(0,a.kt)("p",null,"Pulling your keys will also pull a bunch of additional metadata needed for the bootstrapping process.\nIn the end, your bootstrap directory should look like this:"),(0,a.kt)("h2",{id:"move-genesis-data"},"Move Genesis Data"),(0,a.kt)("p",null,"This bootstrapping data is needed by your node at each startup, so it must be present on disk."),(0,a.kt)("p",null,"Where in the filesystem you store this data is up to you, but you may not change the folder structure generated by the bootstrapping process. By default, flow stores this data under ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/flow/bootstrap"),"."),(0,a.kt)("h2",{id:"new-images"},"New Images"),(0,a.kt)("p",null,"Once the Genesis block has been minted, it will be included into the official container images so that it's available to all nodes. Pull the new images, which should now be version ",(0,a.kt)("inlineCode",{parentName:"p"},"v1.0.0"),"."),(0,a.kt)("h2",{id:"start-your-nodes"},"Start Your Nodes"),(0,a.kt)("p",null,"Once every node has puled its keys and fetched the new images, the network is ready to start."),(0,a.kt)("p",null,"Make sure you're part of the ",(0,a.kt)("a",{parentName:"p",href:"https://chat.onflow.org"},"Discord Chat"),". Once all nodes are ready, updates will be provided to everyone."),(0,a.kt)("p",null,"Start your systems, let's make some blocks!"))}c.isMDXComponent=!0}}]);