"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[9335],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>f});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),s=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=s(e.components);return a.createElement(c.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=s(n),d=r,f=u["".concat(c,".").concat(d)]||u[d]||m[d]||o;return n?a.createElement(f,i(i({ref:t},p),{},{components:n})):a.createElement(f,i({ref:t},p))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[u]="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},65168:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var a=n(87462),r=(n(67294),n(3905));const o={title:"Interaction Templates"},i="Interaction Templates",l={unversionedId:"tools/fcl-js/reference/interaction-templates",id:"tools/fcl-js/reference/interaction-templates",title:"Interaction Templates",description:"Interaction Templates are a concept established in FLIP-934. Read the FLIP here",source:"@site/docs/tools/fcl-js/reference/interaction-templates.mdx",sourceDirName:"tools/fcl-js/reference",slug:"/tools/fcl-js/reference/interaction-templates",permalink:"/tools/fcl-js/reference/interaction-templates",draft:!1,tags:[],version:"current",lastUpdatedBy:"Tom Haile",lastUpdatedAt:1682538265,formattedLastUpdatedAt:"Apr 26, 2023",frontMatter:{title:"Interaction Templates"},sidebar:"tutorialSidebar",previous:{title:"Installation",permalink:"/tools/fcl-js/reference/installation"},next:{title:"Proving Ownership of a Flow Account",permalink:"/tools/fcl-js/reference/proving-authentication"}},c={},s=[{value:"Overview",id:"overview",level:2},{value:"For Applications",id:"for-applications",level:2},{value:"For Wallets",id:"for-wallets",level:2},{value:"Data Structure",id:"data-structure",level:2}],p={toc:s},u="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"interaction-templates"},"Interaction Templates"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Interaction Templates are a concept established in FLIP-934. Read the FLIP ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/onflow/flips/blob/main/flips/20220503-interaction-templates.md"},"here"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},'"Interaction" in this context refers to the higher order term establised in FLIP-934 that encompases a transaction and script, things that ',(0,r.kt)("em",{parentName:"p"},"interact")," with the blockchain.")),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"Interaction Templates establish a format for metadata that exists about an interaction. Interaction Templates can include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Human readable, internationalized messages about the interaction"),(0,r.kt)("li",{parentName:"ul"},"The Cadence code to carry out the interaction"),(0,r.kt)("li",{parentName:"ul"},"Information about arguments such as internationalized human readable messages and what the arguments act upon"),(0,r.kt)("li",{parentName:"ul"},"Contract dependencies the Interaction engages with, pinned to a version of them and their dependency tree")),(0,r.kt)("p",null,"Applications and Wallets can use Interaction Templates and it's interaction metadata. "),(0,r.kt)("p",null,"For example Applications and Wallets can extract the internationalized human readable messaging from an Interaction Template to display to their users prior to execution of the interaction."),(0,r.kt)("h2",{id:"for-applications"},"For Applications"),(0,r.kt)("p",null,"FCL ",(0,r.kt)("inlineCode",{parentName:"p"},"mutate")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"query")," can accept an Interaction Template. FCL ",(0,r.kt)("inlineCode",{parentName:"p"},"mutate")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"query")," will use the Interaction Template to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Extract the Cadence code to carry out the interaction"),(0,r.kt)("li",{parentName:"ul"},"Extract dependency configuration for the interaction (eg: Information about contract import addresses)")),(0,r.kt)("p",null,"Here is an example of using ",(0,r.kt)("inlineCode",{parentName:"p"},"mutate")," with an Interaction Template:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'import * as fcl from "@onflow/fcl"\nimport myTransactionTemplate from "./my-transaction-template.template.json"\n\nconst txId = await fcl.mutate({\n  template: myTransactionTemplate\n})\n')),(0,r.kt)("p",null,"An Interaction Template can also be used with ",(0,r.kt)("inlineCode",{parentName:"p"},"query"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'import * as fcl from "@onflow/fcl"\nimport myScriptTemplate from "./my-script-template.template.json"\n\nconst info = await fcl.query({\n  template: myScriptTemplate\n})\n')),(0,r.kt)("p",null,"Interaction Templates can be resolved from remote locations:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'import * as fcl from "@onflow/fcl"\n\nconst txId = await fcl.mutate({\n  template: "http://interactions.awesome-crypto-project.com/buy-nft"\n})\n\nconst nftInfo = await fcl.query({\n  template: "http://interactions.awesome-crypto-project.com/read-nft",\n  args: (arg, t) => [arg("nft-id", t.String)]\n})\n')),(0,r.kt)("p",null,"FCL will resolve the template from the remote location before using it to execute its underlying transaction or script."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\ud83d\udca1 By requesting an Interaction Template from an external location, applications have a mechanism to always retrieve the most up to date way of accomplishing an interaction.")),(0,r.kt)("p",null,"By default FCL supports resolving Interaction Templates over http/https, but FCL can also be configured with various other ways to resolve Interaction Templates:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'import * as fcl from "@onflow/fcl"\n\nawait fcl.config().put("document.resolver.ipfs", async ({ url }) => {\n  const jsonTemplate = getDocumentFromIPFS(url) // resolve interaction template from ipfs\n  return jsonTemplate\n})\n\nconst txId = await fcl.mutate({\n  template: "ipfs://IPFSHASHGOESHERE"\n})\n')),(0,r.kt)("h2",{id:"for-wallets"},"For Wallets"),(0,r.kt)("p",null,"Wallets can use Interaction Templates to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Display internationalized human readable information about a transaction to their users during signing"),(0,r.kt)("li",{parentName:"ul"},"Verify the dependencies of an Interaction Template have not changed since when the Interaction Template was created"),(0,r.kt)("li",{parentName:"ul"},"Using Interaction Template Audits, gain confidence in the correctness and safety of an Interaction Template and it's underlying transaction")),(0,r.kt)("p",null,"When recieving a transaction to sign, wallets can query for an Interaction Template that corresponds to it."),(0,r.kt)("p",null,'Flow operates an "Interaction Template Discovery Service" which wallets can use to query for Interaction Templates. Anyone can run an "Interaction Template Discovery Service" and wallets can choose to query from any of them.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const cadence = cadenceFromTransactionToSign\nconst network = "mainnet" // "mainnet" | "testnet"\n\nconst cadence_base64 = btoa(cadence)\n\nconst interactionTemplate = await fetch(\n  "https://flix.flow.com/v1/templates/search",\n  {\n    method: "POST",\n    headers: {\n      "Content-Type": "application/json"\n    }\n    body: JSON.stringify({\n      cadence_base64,\n      network\n    })\n  }\n)\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},'\ud83d\udcd6  For more on the "Interaction Template Discovery Service" that Flow operates, see ',(0,r.kt)("a",{parentName:"p",href:"https://github.com/onflow/flow-interaction-template-service"},"here"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u2757\ufe0f Not all transactions will have a corresponding Interaction Template. Wallets are encouraged to always support signing transactions that do not have a corresponding Interaction Template, or if they fail to discover one.")),(0,r.kt)("p",null,"Once a wallet has a corresponding Interaction Template for a given transaction, they may also may wish to verify that the transaction it represents is safe to sign, and that the Interaction Template is accurate for that transaction."),(0,r.kt)("p",null,"To do so, wallets can rely on themselves, along with external Interaction Template Auditors to gain confidence in the Interaction Template and it's underlying transaction. Interaction Template Auditors are entities that audit Interaction Templates for correctness and safety."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\ud83d\udca1 Anyone can be an Interaction Template Auditor. Wallets can choose auditors they trust, if any.")),(0,r.kt)("p",null,"Wallets can specify auditors it trusts to FCL by configuring FCL with the address of each auditor:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'import * as fcl from "@onflow/fcl"\n\nawait fcl.config().put("flow.network", "mainnet")\n\nconst auditorA_FlowAddress = "0xABC123DEF456"\nconst auditorB_FlowAddress = "0xFFAA1212DEFF"\n\nawait fcl.config().put("flow.auditors", [\n  auditorA_FlowAddress,\n  auditorB_FlowAddress\n])\n')),(0,r.kt)("p",null,"Wallets can check if the auditors they configured FCL with have audited a given Interaction Template:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'import * as fcl from "@onflow/fcl"\nimport myTransactionTemplate from "./my-transaction-template.template.json"\n\nconst audits = await fcl.InteractionTemplateUtils\n  .getInteractionTemplateAudits({\n    template: myTransactionTemplate\n  })\n\n/**\n * audits = {\n *   "0xABC123DEF456": true,\n *   "0xFFAA1212DEFF": false\n * }\n ** /\n')),(0,r.kt)("p",null,"The Flow team operates these auditor accounts:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Flow Team Auditor Accounts"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Address"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"TestNet"),(0,r.kt)("td",{parentName:"tr",align:"left"},"0xf78bfc12d0a786dc")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"MainNet"),(0,r.kt)("td",{parentName:"tr",align:"left"},"0xfd100e39d50a13e6")))),(0,r.kt)("p",null,"Since not all auditors that a wallet trusts may have audited a given Interaction Template, trusting multiple auditors can increase the chance that at least one of the trusted auditors has audited the Interaction Template."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u2757\ufe0f Auditors can revoke audits at any time, so be sure to always check an Interaction Template's audit status. ")),(0,r.kt)("p",null,"Since contracts on Flow are mutable, wallets may additionally wish to verify that none of the dependency tree for the transaction an Interaction Template represents has changed since when it was created and of what it was audited against."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'import * as fcl from "@onflow/fcl"\nimport myTransactionTemplate from "./my-transaction-template.template.json"\n\nconst hasDependencyTreeChanged = await fcl.InteractionTemplateUtils\n  .verifyDependencyPinsSameAtLatestSealedBlock({\n    template: myTransactionTemplate\n  })\n')),(0,r.kt)("p",null,"If the dependency tree has changed, wallets may choose to disregard the Interaction Template (and it's audits)."),(0,r.kt)("p",null,"Once the Interaction Template has been sufficiently audited by auditors the wallet trusts, and it's dependency tree determined unchanged since the interaction was created and audited against, then the wallet can use the Interaction Template with greater confidence in it's correctness and safety."),(0,r.kt)("p",null,"The wallet may then decide to render human readable information about the transaction such as:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Internationalized 'title' and 'description' of the transaction"),(0,r.kt)("li",{parentName:"ul"},"Internationalized 'title' for each of the transactions arguments alongside the arguments value")),(0,r.kt)("p",null,"The wallet may then also make the status of it's audits known to the user in their UI. This allows the user to have greater confidence in the safety of the transaction. "),(0,r.kt)("h2",{id:"data-structure"},"Data Structure"),(0,r.kt)("p",null,'The following is an example Interaction Template that corresponds to a "Transfer FLOW" transaction:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "f_type": "InteractionTemplate",\n  "f_version": "1.0.0",\n  "id": "290b6b6222b2a77b16db896a80ddf29ebd1fa3038c9e6625a933fa213fce51fa",\n  "data": {\n    "type": "transaction",\n    "interface": "",\n    "messages": {\n      "title": {\n        "i18n": {\n          "en-US": "Transfer Tokens"\n        }\n      },\n      "description": {\n        "i18n": {\n          "en-US": "Transfer tokens from one account to another"\n        }\n      }\n    },\n    "cadence": "import FungibleToken from 0xFUNGIBLETOKENADDRESS\\ntransaction(amount: UFix64, to: Address) {\\nlet vault: @FungibleToken.Vault\\nprepare(signer: AuthAccount) {\\nself.vault <- signer\\n.borrow<&{FungibleToken.Provider}>(from: /storage/flowTokenVault)!\\n.withdraw(amount: amount)\\n}\\nexecute {\\ngetAccount(to)\\n.getCapability(/public/flowTokenReceiver)!\\n.borrow<&{FungibleToken.Receiver}>()!\\n.deposit(from: <-self.vault)\\n}\\n}",\n    "dependencies": {\n      "0xFUNGIBLETOKENADDRESS": {\n        "FungibleToken": {\n          "mainnet": {\n            "address": "0xf233dcee88fe0abe",\n            "fq_address": "A.0xf233dcee88fe0abe.FungibleToken",\n            "contract": "FungibleToken",\n            "pin": "83c9e3d61d3b5ebf24356a9f17b5b57b12d6d56547abc73e05f820a0ae7d9cf5",\n            "pin_block_height": 34166296\n          },\n          "testnet": {\n            "address": "0x9a0766d93b6608b7",\n            "fq_address": "A.0x9a0766d93b6608b7.FungibleToken",\n            "contract": "FungibleToken",\n            "pin": "83c9e3d61d3b5ebf24356a9f17b5b57b12d6d56547abc73e05f820a0ae7d9cf5",\n            "pin_block_height": 74776482\n          }\n        }\n      }\n    },\n    "arguments": {\n      "amount": {\n        "index": 0,\n        "type": "UFix64",\n        "messages": {\n          "title": {\n            "i18n": {\n              "en-US": "The amount of FLOW tokens to send"\n            }\n          }\n        }\n      },\n      "to": {\n        "index": 1,\n        "type": "Address",\n        "messages": {\n          "title": {\n            "i18n": {\n              "en-US": "The Flow account the tokens will go to"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n')))}m.isMDXComponent=!0}}]);