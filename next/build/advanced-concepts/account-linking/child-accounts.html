<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-build/advanced-concepts/account-linking/child-accounts">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Building Walletless Applications Using Child Accounts | Flow Developer Portal</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://onflow.github.io/docs/img/FlowDocs_Logo_FlowLogo_Horizontal_Green_BlackText.svg"><meta data-rh="true" name="twitter:image" content="https://onflow.github.io/docs/img/FlowDocs_Logo_FlowLogo_Horizontal_Green_BlackText.svg"><meta data-rh="true" property="og:url" content="https://onflow.github.io/docs/next/build/advanced-concepts/account-linking/child-accounts"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Building Walletless Applications Using Child Accounts | Flow Developer Portal"><meta data-rh="true" name="description" content="In this doc, we’ll dive into a progressive onboarding flow, including the Cadence scripts &amp; transactions that go into"><meta data-rh="true" property="og:description" content="In this doc, we’ll dive into a progressive onboarding flow, including the Cadence scripts &amp; transactions that go into"><link data-rh="true" rel="icon" href="/docs/favicon.ico"><link data-rh="true" rel="canonical" href="https://onflow.github.io/docs/next/build/advanced-concepts/account-linking/child-accounts"><link data-rh="true" rel="alternate" href="https://onflow.github.io/docs/next/build/advanced-concepts/account-linking/child-accounts" hreflang="en"><link data-rh="true" rel="alternate" href="https://onflow.github.io/docs/next/build/advanced-concepts/account-linking/child-accounts" hreflang="x-default"><link rel="search" type="application/opensearchdescription+xml" title="Flow Developer Portal" href="/docs/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="/mixpanel.js" async onload="if (&#39;776159d170484f49f19c3c2f7339f297&#39; &amp;&amp; &#39;776159d170484f49f19c3c2f7339f297&#39; !== &#39;undefined&#39;) {
  window.mixpanel.init(&#39;776159d170484f49f19c3c2f7339f297&#39;);

  const viwedPayload = {
    &#39;Page Name&#39;: document.title,
    &#39;Page URL&#39;: window.location.pathname,
  }
  window.mixpanel.track(&#39;Page Viewed&#39;, viwedPayload);

  const playUrl = &#39;play.onflow.org&#39;;
  const links = document.querySelectorAll(&#39;a&#39;) || [];
  const isPlayPage = Array.from(links).some((link) =&gt; link.href.includes(playUrl));

  if (isPlayPage) {
    window.mixpanel.track(&#39;Play Page Viewed&#39;, viwedPayload);
  }
  
  window.document.addEventListener(&#39;click&#39;, function (event) {
    var target = event.target;
  
    // Check if the clicked element is a link with an href attribute
    if (target.tagName === &#39;A&#39; &amp;&amp; target.hasAttribute(&#39;href&#39;)) {
      if (window.mixpanel) {
        const payload = {
          href: target.getAttribute(&#39;href&#39;),
          id: target.id,
          class: target.className,
        }
        window.mixpanel.track(&#39;Link clicked&#39;, payload);
        const isPlay = payload.href.includes(&#39;play.onflow.org&#39;);
        if (isPlay) {
          window.mixpanel.track(&#39;Play Link clicked&#39;, payload);        
        }
      }
    }
  });
}"></script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="0f0b3ed1-7761-4986-851e-09336ea6ef1c" data-project-name="Flow" data-project-color="#2E8555" data-project-logo="https://cryptologos.cc/logos/flow-flow-logo.png" async></script>
<script src="/hotjar.js" async></script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="0f0b3ed1-7761-4986-851e-09336ea6ef1c" data-project-name="Flow" data-project-color="#2E8555" data-project-logo="https://cryptologos.cc/logos/flow-flow-logo.png" async></script><link rel="stylesheet" href="/docs/assets/css/styles.8d07a146.css">
<link rel="preload" href="/docs/assets/js/runtime~main.bd1bb2ab.js" as="script">
<link rel="preload" href="/docs/assets/js/main.6ef1af42.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/flow-docs-logo-dark.png" alt="Flow Developer Portal Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docs/img/flow-docs-logo-light.png" alt="Flow Developer Portal Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/docs/concepts/start-here">Concepts</a><a class="navbar__item navbar__link" href="/docs/building-on-flow">Build</a><a class="navbar__item navbar__link" href="/docs/guides">Guides</a><a class="navbar__item navbar__link" href="/docs/cadence/intro">Cadence</a><a class="navbar__item navbar__link" href="/docs/tools">Tools</a><a class="navbar__item navbar__link" href="/docs/references">References</a><a class="navbar__item navbar__link" href="/docs/community-resources">Resources</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/next/overview">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/next/build/advanced-concepts/account-linking/child-accounts">Next</a></li><li><a class="dropdown__link" href="/docs/concepts/start-here">Current</a></li></ul></div><a href="https://github.com/onflow" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link h-8 desktop:p-1"><img src="" alt="GitHub" id="navbar-github" class="box-content h-32 w-32"><span class="p-2 desktop:hidden">Github</span></a><a href="https://onflow.org/discord" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link h-8 desktop:p-1"><img src="" alt="Discord" id="navbar-discord" class="box-content h-32 w-32"><span class="p-2 desktop:hidden">Discord</span></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/next/build">index</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/build/key-concepts/blocks">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/next/build/core-contracts">Flow Core Contracts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Flow Core Contracts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/next/build/advanced-concepts/account-linking">advanced-concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/next/build/advanced-concepts/account-linking">Account Linking (FLIP 72)</a><button aria-label="Toggle the collapsible sidebar category &#x27;Account Linking (FLIP 72)&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/next/build/advanced-concepts/account-linking/child-accounts">Building Walletless Applications Using Child Accounts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/build/advanced-concepts/account-linking/parent-accounts">Working With Parent Accounts</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/build/best-practices/design-patterns">best-practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/build/getting-started/hello-world/tutorial/first-steps">getting-started</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Flow Developer Portal<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/concepts/start-here">latest version</a></b> (<!-- -->Current<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">advanced-concepts</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/next/build/advanced-concepts/account-linking"><span itemprop="name">Account Linking (FLIP 72)</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Building Walletless Applications Using Child Accounts</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Building Walletless Applications Using Child Accounts</h1></header><p>In this doc, we’ll dive into a progressive onboarding flow, including the Cadence scripts &amp; transactions that go into
its implementation in your app. These components will enable any implementing app to create a custodial account,
mediate the user’s onchain actions on their behalf, and later delegate access of that app-created account to the
user’s wallet. We’ll refer to this custodial pattern as the Hybrid Custody Model and the process of delegating control
of the app account as Account Linking.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="objectives">Objectives<a href="#objectives" class="hash-link" aria-label="Direct link to Objectives" title="Direct link to Objectives">​</a></h2>
<ul>
<li>Create a <a href="https://flow.com/post/flow-blockchain-mainstream-adoption-easy-onboarding-wallets" target="_blank" rel="noopener noreferrer">walletless onboarding</a>
transaction</li>
<li>Link an existing app account as a child to a newly authenticated parent account</li>
<li>Get your app to recognize “parent” accounts along with any associated “child” accounts</li>
<li>Put it all together to create a blockchain-native onboarding transaction</li>
<li>View fungible and non-fungible Token metadata relating to assets across all of a user’s associated accounts - their
wallet-mediated “parent” account and any “child” accounts</li>
<li>Facilitate transactions acting on assets in child accounts</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="point-of-clarity">Point of Clarity<a href="#point-of-clarity" class="hash-link" aria-label="Direct link to Point of Clarity" title="Direct link to Point of Clarity">​</a></h2>
<p>Before diving in, let&#x27;s make a distinction between <strong>&quot;account linking&quot;</strong> and <strong>&quot;linking accounts&quot;</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="account-linking">Account Linking<a href="#account-linking" class="hash-link" aria-label="Direct link to Account Linking" title="Direct link to Account Linking">​</a></h3>
<div class="theme-admonition theme-admonition- alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_vXIg"><p>Note that since account linking is a sensitive action, transactions where an account may be linked are designated by a
topline pragma <code>#allowAccountLinking</code>. This lets wallet providers inform users that their account may be linked in the
signed transaction.</p></div></div>
<p>Very simply, account linking is a <a href="https://github.com/onflow/flips/pull/53" target="_blank" rel="noopener noreferrer">feature in Cadence</a> that let&#x27;s an
<a href="/docs/next/cadence/language/accounts#authaccount">AuthAccount</a> create a
<a href="https://developers.flow.com/cadence/language/capability-based-access-control.md" target="_blank" rel="noopener noreferrer">Capability</a> on itself. You can do so in the following
transaction:</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="link_account.cdc" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>link_account.cdc</div></div><div style="flex:1;min-width:0.8em"></div><button type="button" title="Copy code" class="ch-editor-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>#allowAccountLinking</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>transaction(linkPathSuffix: String) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>    prepare(account: AuthAccount) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>        // Create the PrivatePath where we&#x27;ll create the link</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>        let linkPath = PrivatePath(identifier: linkPathSuffix)</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>            ?? panic(&quot;Could not construct PrivatePath from given identifier: &quot;.concat(linkPathSuffix))</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>        // Check if an AuthAccount Capability already exists at the specified path</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>        if !account.getCapability&lt;&amp;AuthAccount&gt;(linkPath).check() {</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>            // If not, unlink anything that may be there and link the AuthAccount Capability</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>            account.unlink(linkpath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>            account.linkAccount(linkPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div>
<p>From there, the signing account can retrieve the privately linked AuthAccount Capability and delegate it to another
account, unlinking the Capability if they wish to revoke delegated access.</p>
<p>Note that in order to link an account, a transaction must state the <code>#allowAccountLinking</code> pragma in the top line of the
transaction. This is an interim safety measure so that wallet providers can notify users they&#x27;re about to sign a
transaction that may create a Capability on their AuthAccount.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="linking-accounts">Linking Accounts<a href="#linking-accounts" class="hash-link" aria-label="Direct link to Linking Accounts" title="Direct link to Linking Accounts">​</a></h3>
<p>Linking accounts leverages this account link, otherwise known as an <strong>AuthAccount Capability</strong>, and encapsulates it. The
<a href="https://github.com/onflow/flips/pull/72" target="_blank" rel="noopener noreferrer">components and actions</a> involved in this process - what the Capability is
encapsulated in, the collection that holds those encapsulations, etc. is what we&#x27;ll dive into in this doc.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="terminology">Terminology<a href="#terminology" class="hash-link" aria-label="Direct link to Terminology" title="Direct link to Terminology">​</a></h2>
<p><strong>Parent-Child accounts</strong> - For the moment, we’ll call the account created by the app the “child” account and the
account receiving its AuthAccount Capability the “parent” account. Existing methods of account access &amp; delegation (i.e.
keys) still imply ownership over the account, but insofar as linked accounts are concerned, the account to which both
the user and the app share access via AuthAccount Capability will be considered the “child” account.</p>
<p><strong>Walletless onboarding</strong> - An onboarding flow whereby an app creates an account for a user, onboarding them to the
app, obviating the need for user wallet authentication.</p>
<p><strong>Blockchain-native onboarding</strong> - Similar to the already familiar Web3 onboarding flow where a user authenticates with
their existing wallet, an app onboards a user via wallet authentication while additionally creating an app account and
linking it with the authenticated account, resulting in a hybrid custody model.</p>
<p><strong>Hybrid Custody Model</strong> - A custodial pattern in which an app and a user maintain access to an app created account and
user access to that account has been mediated by account linking.</p>
<p><strong>Account Linking</strong> - Technically speaking, account linking in our context consists of giving some other account an
AuthAccount Capability from the granting account. This Capability is maintained in standardized resource called a
<code>HybridCustody.Manager</code>, providing its owning user access to any and all of their linked accounts.</p>
<p><strong>Progressive Onboarding</strong> - An onboarding flow that walks a user up to self-custodial ownership, starting with
walletless onboarding and later linking the app account with the user’s authenticated wallet once the user chooses to
do so.</p>
<p><strong>Restricted Child Account</strong> - An account delegation where the access on the delegating account is restricted according
to rules set by the linking child account. The distinctions between this and the subsequent term (&quot;owned&quot; account) will
be expanding on later.</p>
<p><strong>Owned Account</strong> - An account delegation where the delegatee has unrestricted access on the delegating child account,
thereby giving the delegatee presiding authority superseding any other &quot;restricted&quot; parent accounts.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="account-linking-1">Account Linking<a href="#account-linking-1" class="hash-link" aria-label="Direct link to Account Linking" title="Direct link to Account Linking">​</a></h2>
<p>Linking an account is the process of delegating account access via AuthAccount Capability. Of course, we want to do this
in a way that allows the receiving account to maintain that Capability and allows easy identification of the accounts on
either end of the linkage - the user&#x27;s main &quot;parent&quot; account and the linked &quot;child&quot; account. This is accomplished in the
(still in flux) <code>HybridCustody</code> contract which we&#x27;ll continue to use in this guidance.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pre-requisites">Pre-requisites<a href="#pre-requisites" class="hash-link" aria-label="Direct link to Pre-requisites" title="Direct link to Pre-requisites">​</a></h3>
<p>Since account delegation is mediated by developer-defined rules, you should make sure to first configure the resources
that contain those rules. Contracts involved in defining and enforcing this ruleset are
<a href="https://github.com/onflow/hybrid-custody/blob/main/contracts/CapabilityFilter.cdc" target="_blank" rel="noopener noreferrer"><code>CapabilityFilter</code></a> and
<a href="https://github.com/onflow/hybrid-custody/blob/main/contracts/CapabilityFactory.cdc" target="_blank" rel="noopener noreferrer"><code>CapabilityFactory</code></a>.
The former enumerates those types that are/aren&#x27;t accessible from a child account while the latter enables the access of
those allowable Capabilities such that the returned values can be properly typed - e.g. retrieving a Capability that can
be cast to <code>Capability&lt;&amp;NonFungibleToken.Collection&gt;</code> for example.</p>
<p>Here&#x27;s how you would configure an <code>AllowlistFilter</code> and add allowed types to it:</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="setup_allow_all_filter.cdc" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>setup_allow_all_filter.cdc</div></div><div style="flex:1;min-width:0.8em"></div><button type="button" title="Copy code" class="ch-editor-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>import &quot;CapabilityFilter&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>transaction(identifiers: [String]) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>    prepare(acct: AuthAccount) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>        // Setup the AllowlistFilter</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>        if acct.borrow&lt;&amp;CapabilityFilter.AllowlistFilter&gt;(from: CapabilityFilter.StoragePath) == nil {</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>            acct.save(&lt;-CapabilityFilter.create(Type&lt;@CapabilityFilter.AllowlistFilter&gt;()), to: CapabilityFilter.StoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>        // Ensure the AllowlistFilter is linked to the expected PublicPath</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>        acct.unlink(CapabilityFilter.PublicPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>        acct.link&lt;&amp;CapabilityFilter.AllowlistFilter{CapabilityFilter.Filter}&gt;(CapabilityFilter.PublicPath, target: CapabilityFilter.StoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>        // Get a reference to the filter</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>        let filter = acct.borrow&lt;&amp;CapabilityFilter.AllowlistFilter&gt;(from: CapabilityFilter.StoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>            ?? panic(&quot;filter does not exist&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>        // Add the given type identifiers to the AllowlistFilter</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>        // **Note:** the whole transaction fails if any of the given identifiers are malformed</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>        for identifier in identifiers {</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>            let c = CompositeType(identifier)!</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>            filter.addType(c)</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->25</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div>
<p>And the following transaction configures a <code>CapabilityFactory.Manager</code>, adding NFT-related <code>Factory</code> objects:</p>
<div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_vXIg"><p>Note that the Manager configured here enables retrieval of castable Capabilities. It&#x27;s recommended that you implement
Factory resource definitions to support any NFT Collections related with the use of your application so that users can
retrieve Typed Capabilities from accounts linked from your app.</p></div></div>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="setup_factory.cdc" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>setup_factory.cdc</div></div><div style="flex:1;min-width:0.8em"></div><button type="button" title="Copy code" class="ch-editor-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>import &quot;CapabilityFactory&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>import &quot;NFTCollectionPublicFactory&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>import &quot;NFTProviderAndCollectionFactory&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>import &quot;NFTProviderFactory&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>import &quot;NonFungibleToken&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>transaction {</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>    prepare(acct: AuthAccount) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>        // Check for a stored Manager, saving if not found</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>        if acct.borrow&lt;&amp;AnyResource&gt;(from: CapabilityFactory.StoragePath) == nil {</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>            let f &lt;- CapabilityFactory.createFactoryManager()</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>            acct.save(&lt;-f, to: CapabilityFactory.StoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>        // Check for Capabilities where expected, linking if not found</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>        if !acct.getCapability&lt;&amp;CapabilityFactory.Manager{CapabilityFactory.Getter}&gt;(CapabilityFactory.PrivatePath).check() {</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>            acct.unlink(CapabilityFactory.PublicPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>            acct.link&lt;&amp;CapabilityFactory.Manager{CapabilityFactory.Getter}&gt;(CapabilityFactory.PublicPath, target: CapabilityFactory.StoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>        assert(</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>            acct.getCapability&lt;&amp;CapabilityFactory.Manager{CapabilityFactory.Getter}&gt;(CapabilityFactory.PublicPath).check(),</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>            message: &quot;CapabilityFactory is not setup properly&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>        )</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>        let manager = acct.borrow&lt;&amp;CapabilityFactory.Manager&gt;(from: CapabilityFactory.StoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>            ?? panic(&quot;manager not found&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>        /// Add generic NFT-related Factory implementations to enable castable Capabilities from this Manager</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>        manager.addFactory(Type&lt;&amp;{NonFungibleToken.CollectionPublic}&gt;(), NFTCollectionPublicFactory.Factory())</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>        manager.addFactory(Type&lt;&amp;{NonFungibleToken.Provider, NonFungibleToken.CollectionPublic}&gt;(), NFTProviderAndCollectionFactory.Factory())</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>        manager.addFactory(Type&lt;&amp;{NonFungibleToken.Provider}&gt;(), NFTProviderFactory.Factory())</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->35</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div>
<p><img loading="lazy" src="/docs/assets/images/hybrid_custody_high_level-0fdf5d00b8b4545c3c587ba78a817fd9.png" alt="resources/hybrid_custody_high_level" width="1954" height="1375" class="img_ev3q"></p>
<p><em>In this scenario, a user custodies a key for their main account which maintains access to a wrapped AuthAccount
Capability, providing the user restricted access on the app account. The app maintains custodial access to the account
and regulates the access restrictions to delegatee &quot;parent&quot; accounts.</em></p>
<p>Linking accounts can be done in one of two ways. Put simply, the child account needs to get the parent account an
<code>AuthAccount</code> Capability, and the parent needs to save that Capability so they can retain access in a manner that also
represents each side of the link and safeguards the integrity of any access restrictions an application puts in place on
delegated access.</p>
<p>We can achieve issuance from the child account and claim from the parent account pattern in either:</p>
<ol>
<li>We can leverage <a href="/docs/next/cadence/language/accounts#account-inbox">Cadence’s <code>AuthAccount.Inbox</code></a> to publish the
Capability from the child account &amp; have the parent claim the Capability in a separate transaction.</li>
<li>Multi-party signed transaction, signed by both the the accounts on either side of the link</li>
</ol>
<p>Let’s take a look at both.</p>
<div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_vXIg"><p>You&#x27;ll want to consider whether you would like the parent account to be configured with some app-specific resources or
Capabilities and compose you multisig or claim transactions to include such configurations. <br></p><p>For example, if your app deals with specific NFTs, you may want to configure the parent account with Collections for
those NFTs so the user can easily transfer them between their linked accounts.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="publish--claim">Publish &amp; Claim<a href="#publish--claim" class="hash-link" aria-label="Direct link to Publish &amp; Claim" title="Direct link to Publish &amp; Claim">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="publish">Publish<a href="#publish" class="hash-link" aria-label="Direct link to Publish" title="Direct link to Publish">​</a></h4>
<p>Here, the account delegating access to itself links its AuthAccount Capability, and publishes it to be claimed by the
account it will be linked to.</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="publish_to_parent.cdc" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>publish_to_parent.cdc</div></div><div style="flex:1;min-width:0.8em"></div><button type="button" title="Copy code" class="ch-editor-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>import &quot;HybridCustody&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>import &quot;CapabilityFactory&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>import &quot;CapabilityFilter&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>import &quot;CapabilityDelegator&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>transaction(parent: Address, factoryAddress: Address, filterAddress: Address) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>    prepare(acct: AuthAccount) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>        let owned = acct.borrow&lt;&amp;HybridCustody.OwnedAccount&gt;(from: HybridCustody.OwnedAccountStoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>            ?? panic(&quot;owned account not found&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>        let factory = getAccount(factoryAddress).getCapability&lt;&amp;CapabilityFactory.Manager{CapabilityFactory.Getter}&gt;(CapabilityFactory.PublicPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>        assert(factory.check(), message: &quot;factory address is not configured properly&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>        let filter = getAccount(filterAddress).getCapability&lt;&amp;{CapabilityFilter.Filter}&gt;(CapabilityFilter.PublicPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>        assert(filter.check(), message: &quot;capability filter is not configured properly&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>        owned.publishToParent(parentAddress: parent, factory: factory, filter: filter)</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->19</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="claim">Claim<a href="#claim" class="hash-link" aria-label="Direct link to Claim" title="Direct link to Claim">​</a></h4>
<p>On the other side, the receiving account claims the published <code>ChildAccount</code> Capability, adding it to the signer&#x27;s
<code>HybridCustody.Manager.childAccounts</code> indexed on the child account&#x27;s Address.</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="redeem_account.cdc" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>redeem_account.cdc</div></div><div style="flex:1;min-width:0.8em"></div><button type="button" title="Copy code" class="ch-editor-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>import &quot;MetadataViews&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>import &quot;HybridCustody&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>import &quot;CapabilityFilter&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>transaction(childAddress: Address, filterAddress: Address?, filterPath: PublicPath?) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>    prepare(acct: AuthAccount) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>        var filter: Capability&lt;&amp;{CapabilityFilter.Filter}&gt;? = nil</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>        if filterAddress != nil &amp;&amp; filterPath != nil {</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>            filter = getAccount(filterAddress!).getCapability&lt;&amp;{CapabilityFilter.Filter}&gt;(filterPath!)</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>        if acct.borrow&lt;&amp;HybridCustody.Manager&gt;(from: HybridCustody.ManagerStoragePath) == nil {</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>            let m &lt;- HybridCustody.createManager(filter: filter)</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>            acct.save(&lt;- m, to: HybridCustody.ManagerStoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>            acct.unlink(HybridCustody.ManagerPublicPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>            acct.unlink(HybridCustody.ManagerPrivatePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>            acct.link&lt;&amp;HybridCustody.Manager{HybridCustody.ManagerPrivate, HybridCustody.ManagerPublic}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>                HybridCustody.ManagerPrivatePath,</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>                target: HybridCustody.ManagerStoragePath</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>            )</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>            acct.link&lt;&amp;HybridCustody.Manager{HybridCustody.ManagerPublic}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>                HybridCustody.ManagerPublicPath,</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>                target: HybridCustody.ManagerStoragePath</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>            )</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>        let inboxName = HybridCustody.getChildAccountIdentifier(acct.address)</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>        let cap = acct.inbox.claim&lt;&amp;HybridCustody.ChildAccount{HybridCustody.AccountPrivate, HybridCustody.AccountPublic, MetadataViews.Resolver}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>                inboxName,</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>                provider: childAddress</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>            ) ?? panic(&quot;child account cap not found&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>        let manager = acct.borrow&lt;&amp;HybridCustody.Manager&gt;(from: HybridCustody.ManagerStoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>            ?? panic(&quot;manager no found&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>        manager.addAccount(cap: cap)</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->41</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multi-signed-transaction">Multi-Signed Transaction<a href="#multi-signed-transaction" class="hash-link" aria-label="Direct link to Multi-Signed Transaction" title="Direct link to Multi-Signed Transaction">​</a></h3>
<p>We can combine the two transactions in <a href="#publish">Publish</a> and <a href="#claim">Claim</a> into a single multi-signed transaction to
achieve Hybrid Custody in a single step.</p>
<div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_vXIg"><p>Note that while the following code links both accounts in a single transaction, in practicality you may find it easier
to execute publish and claim transactions separately depending on your custodial infrastructure.</p></div></div>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="setup_multi_sig.cdc" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>setup_multi_sig.cdc</div></div><div style="flex:1;min-width:0.8em"></div><button type="button" title="Copy code" class="ch-editor-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>#allowAccountLinking</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>import &quot;HybridCustody&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>import &quot;CapabilityFactory&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>import &quot;CapabilityDelegator&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>import &quot;CapabilityFilter&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>import &quot;MetadataViews&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>transaction(parentFilterAddress: Address?, childAccountFactoryAddress: Address, childAccountFilterAddress: Address) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>    prepare(childAcct: AuthAccount, parentAcct: AuthAccount) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        // --------------------- Begin setup of child account ---------------------</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        var acctCap = childAcct.getCapability&lt;&amp;AuthAccount&gt;(HybridCustody.LinkedAccountPrivatePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        if !acctCap.check() {</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            acctCap = childAcct.linkAccount(HybridCustody.LinkedAccountPrivatePath)!</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        if childAcct.borrow&lt;&amp;HybridCustody.OwnedAccount&gt;(from: HybridCustody.OwnedAccountStoragePath) == nil {</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            let ownedAccount &lt;- HybridCustody.createOwnedAccount(acct: acctCap)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            childAcct.save(&lt;-ownedAccount, to: HybridCustody.OwnedAccountStoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        // check that paths are all configured properly</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        childAcct.unlink(HybridCustody.OwnedAccountPrivatePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        childAcct.link&lt;&amp;HybridCustody.OwnedAccount{HybridCustody.BorrowableAccount, HybridCustody.OwnedAccountPublic, MetadataViews.Resolver}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            HybridCustody.OwnedAccountPrivatePath,</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            target: HybridCustody.OwnedAccountStoragePath</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        )</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        childAcct.unlink(HybridCustody.OwnedAccountPublicPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        childAcct.link&lt;&amp;HybridCustody.OwnedAccount{HybridCustody.OwnedAccountPublic, MetadataViews.Resolver}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            HybridCustody.OwnedAccountPublicPath,</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            target: HybridCustody.OwnedAccountStoragePath</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        )</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        // --------------------- End setup of child account ---------------------</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        // --------------------- Begin setup of parent account ---------------------</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        var filter: Capability&lt;&amp;{CapabilityFilter.Filter}&gt;? = nil</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        if parentFilterAddress != nil {</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            filter = getAccount(parentFilterAddress!).getCapability&lt;&amp;{CapabilityFilter.Filter}&gt;(CapabilityFilter.PublicPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        if parentAcct.borrow&lt;&amp;HybridCustody.Manager&gt;(from: HybridCustody.ManagerStoragePath) == nil {</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            let m &lt;- HybridCustody.createManager(filter: filter)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            parentAcct.save(&lt;- m, to: HybridCustody.ManagerStoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        parentAcct.unlink(HybridCustody.ManagerPublicPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        parentAcct.unlink(HybridCustody.ManagerPrivatePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        parentAcct.link&lt;&amp;HybridCustody.Manager{HybridCustody.ManagerPrivate, HybridCustody.ManagerPublic}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            HybridCustody.OwnedAccountPrivatePath,</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            target: HybridCustody.ManagerStoragePath</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        )</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        parentAcct.link&lt;&amp;HybridCustody.Manager{HybridCustody.ManagerPublic}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            HybridCustody.OwnedAccountPublicPath,</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            target: HybridCustody.ManagerStoragePath</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        )</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        // --------------------- End setup of parent account ---------------------</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        // Publish account to parent</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        let owned = childAcct.borrow&lt;&amp;HybridCustody.OwnedAccount&gt;(from: HybridCustody.OwnedAccountStoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            ?? panic(&quot;owned account not found&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        let factory = getAccount(childAccountFactoryAddress)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            .getCapability&lt;&amp;CapabilityFactory.Manager{CapabilityFactory.Getter}&gt;(CapabilityFactory.PublicPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        assert(factory.check(), message: &quot;factory address is not configured properly&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        let filterForChild = getAccount(childAccountFilterAddress).getCapability&lt;&amp;{CapabilityFilter.Filter}&gt;(CapabilityFilter.PublicPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        assert(filterForChild.check(), message: &quot;capability filter is not configured properly&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        owned.publishToParent(parentAddress: parentAcct.address, factory: factory, filter: filterForChild)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        // claim the account on the parent</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        let inboxName = HybridCustody.getChildAccountIdentifier(parentAcct.address)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        let cap = parentAcct.inbox.claim&lt;&amp;HybridCustody.ChildAccount{HybridCustody.AccountPrivate, HybridCustody.AccountPublic, MetadataViews.Resolver}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>                inboxName,</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>                provider: childAcct.address</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            ) ?? panic(&quot;child account cap not found&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        let manager = parentAcct.borrow&lt;&amp;HybridCustody.Manager&gt;(from: HybridCustody.ManagerStoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>            ?? panic(&quot;manager no found&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>        manager.addAccount(cap: cap)</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->87</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="onboarding-flows">Onboarding Flows<a href="#onboarding-flows" class="hash-link" aria-label="Direct link to Onboarding Flows" title="Direct link to Onboarding Flows">​</a></h2>
<p>Given the ability to establish an account and later delegate access to a user, apps are freed from the constraints of
dichotomous custodial &amp; self-custodial paradigms. A developer can choose to onboard a user via traditional Web2 identity
and later delegate access to the user’s wallet account. Alternatively, an app can enable wallet authentication at the
outset, creating an app-specific account &amp; linking with the user’s wallet account. As specified above, these two flows
are known as walletless and blockchain-native onboarding respectively. Developers can choose to implement one for
simplicity or both for maximum flexibility.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="walletless-onboarding">Walletless Onboarding<a href="#walletless-onboarding" class="hash-link" aria-label="Direct link to Walletless Onboarding" title="Direct link to Walletless Onboarding">​</a></h3>
<p>The following transaction creates an account, funding creation via the signer and adding the provided public key. You&#x27;ll
notice this transaction is pretty much your standard account creation. The magic for you will be how you custody the key
for this account (locally, KMS, wallet service, etc.) in a manner that allows your app to mediate onchain interactions
on behalf of your user.</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="walletless_onboarding" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>walletless_onboarding</div></div><div style="flex:1;min-width:0.8em"></div><button type="button" title="Copy code" class="ch-editor-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>import &quot;FungibleToken&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>import &quot;FlowToken&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>transaction(pubKey: String, initialFundingAmt: UFix64) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>	prepare(signer: AuthAccount) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		/* --- Account Creation --- */</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		// **NOTE:** your app may choose to separate creation depending on your custodial model)</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		//</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		// Create the child account, funding via the signer</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		let newAccount = AuthAccount(payer: signer)</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		// Create a public key for the new account from string value in the provided arg</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		// **NOTE:** You may want to specify a different signature algo for your use case</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		let key = PublicKey(</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>			publicKey: pubKey.decodeHex(),</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>			signatureAlgorithm: SignatureAlgorithm.ECDSA_P256</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		)</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		// Add the key to the new account</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		// **NOTE:** You may want to specify a different hash algo &amp; weight best for your use case</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		newAccount.keys.add(</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>			publicKey: key,</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>			hashAlgorithm: HashAlgorithm.SHA3_256,</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>			weight: 1000.0</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		)</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		/* --- (Optional) Additional Account Funding --- */</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		//</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		// Fund the new account if specified</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		if initialFundingAmt &gt; 0.0 {</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>			// Get a vault to fund the new account</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>			let fundingProvider = signer.borrow&lt;&amp;FlowToken.Vault{FungibleToken.Provider}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>					from: /storage/flowTokenVault</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>				)!</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>			// Fund the new account with the initialFundingAmount specified</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>			newAccount.getCapability&lt;&amp;FlowToken.Vault{FungibleToken.Receiver}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>				/public/flowTokenReceiver</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>			).borrow()!</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>			.deposit(</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>				from: &lt;-fundingProvider.withdraw(</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>					amount: initialFundingAmt</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>				)</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>			)</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		}</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		/* --- Continue with use case specific setup --- */</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		//</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		// At this point, the newAccount can further be configured as suitable for</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		// use in your app (e.g. Setup a Collection, Mint NFT, Configure Vault, etc.)</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>		// ...</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>	}</span></div></div><div><span class="ch-code-line-number">_<!-- -->52</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="blockchain-native-onboarding">Blockchain-Native Onboarding<a href="#blockchain-native-onboarding" class="hash-link" aria-label="Direct link to Blockchain-Native Onboarding" title="Direct link to Blockchain-Native Onboarding">​</a></h3>
<p>This onboarding flow is really a single-transaction composition of the steps covered above. This is a testament to the
power of the complex transactions you can compose on Flow with Cadence!</p>
<div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_vXIg"><p>Recall the <a href="#pre-requisites">pre-requisites</a> needed to be satisfied before linking an account: <br></p><ol>
<li>CapabilityFilter Filter saved and linked <br></li>
<li>CapabilityFactory Manager saved and linked as well as Factory implementations supporting the Capability Types you&#x27;ll
want accessible from linked child accounts as Typed Capabilities.</li>
</ol></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="account-creation--linking">Account Creation &amp; Linking<a href="#account-creation--linking" class="hash-link" aria-label="Direct link to Account Creation &amp; Linking" title="Direct link to Account Creation &amp; Linking">​</a></h4>
<p>Compared to walletless onboarding where a user does not have a Flow account, blockchain-native onboarding assumes a user
already has a wallet configured and immediately links it with a newly created app account. This enables the app to
sign transactions on the user&#x27;s behalf via the new child account while immediately delegating control of that account to
the onboarding user&#x27;s main account.</p>
<p>After this transaction, both the custodial party (presumably the client/app) and the signing parent account will have
access to the newly created account - the custodial party via key access and the parent account via their
<code>HybridCustody.Manager</code> maintaining the new account&#x27;s <code>ChildAccount</code> Capability.</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="blockchain_native_onboarding.cdc" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>blockchain_native_onboarding.cdc</div></div><div style="flex:1;min-width:0.8em"></div><button type="button" title="Copy code" class="ch-editor-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>#allowAccountLinking</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>import &quot;FungibleToken&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>import &quot;FlowToken&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>import &quot;MetadataViews&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>import &quot;HybridCustody&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>import &quot;CapabilityFactory&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>import &quot;CapabilityFilter&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>import &quot;CapabilityDelegator&quot;</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>transaction(</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>    pubKey: String,</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>    initialFundingAmt: UFix64,</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>    factoryAddress: Address,</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>    filterAddress: Address</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>    prepare(parent: AuthAccount, app: AuthAccount) {</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        /* --- Account Creation --- */</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        //</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // Create the child account, funding via the signing app account</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        let newAccount = AuthAccount(payer: app)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // Create a public key for the child account from string value in the provided arg</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // **NOTE:** You may want to specify a different signature algo for your use case</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        let key = PublicKey(</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            publicKey: pubKey.decodeHex(),</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            signatureAlgorithm: SignatureAlgorithm.ECDSA_P256</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        )</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // Add the key to the new account</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // **NOTE:** You may want to specify a different hash algo &amp; weight best for your use case</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        newAccount.keys.add(</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            publicKey: key,</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            hashAlgorithm: HashAlgorithm.SHA3_256,</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            weight: 1000.0</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        )</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        /* --- (Optional) Additional Account Funding --- */</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        //</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // Fund the new account if specified</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        if initialFundingAmt &gt; 0.0 {</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            // Get a vault to fund the new account</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            let fundingProvider = app.borrow&lt;&amp;FlowToken.Vault{FungibleToken.Provider}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                    from: /storage/flowTokenVault</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                )!</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            // Fund the new account with the initialFundingAmount specified</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            newAccount.getCapability&lt;&amp;FlowToken.Vault{FungibleToken.Receiver}&gt;(/public/flowTokenReceiver)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                .borrow()!</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                .deposit(</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                    from: &lt;-fundingProvider.withdraw(</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                        amount: initialFundingAmt</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                    )</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                )</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        /* Continue with use case specific setup */</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        //</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // At this point, the newAccount can further be configured as suitable for</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // use in your app (e.g. Setup a Collection, Mint NFT, Configure Vault, etc.)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // ...</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        /* --- Link the AuthAccount Capability --- */</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        //</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        var acctCap = newAccount.linkAccount(HybridCustody.LinkedAccountPrivatePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            ?? panic(&quot;problem linking account Capability for new account&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // Create a OwnedAccount &amp; link Capabilities</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        let ownedAccount &lt;- HybridCustody.createOwnedAccount(acct: acctCap)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        newAccount.save(&lt;-ownedAccount, to: HybridCustody.OwnedAccountStoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        newAccount</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            .link&lt;&amp;HybridCustody.OwnedAccount{HybridCustody.BorrowableAccount, HybridCustody.OwnedAccountPublic, MetadataViews.Resolver}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                HybridCustody.OwnedAccountPrivatePath,</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                target: HybridCustody.OwnedAccountStoragePath</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            )</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        newAccount</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            .link&lt;&amp;HybridCustody.OwnedAccount{HybridCustody.OwnedAccountPublic}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                HybridCustody.OwnedAccountPublicPath,</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                target: HybridCustody.OwnedAccountStoragePath</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            )</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // Get a reference to the OwnedAccount resource</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        let owned = newAccount.borrow&lt;&amp;HybridCustody.OwnedAccount&gt;(from: HybridCustody.OwnedAccountStoragePath)!</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // Get the CapabilityFactory.Manager Capability</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        let factory = getAccount(factoryAddress)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            .getCapability&lt;&amp;CapabilityFactory.Manager{CapabilityFactory.Getter}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                CapabilityFactory.PublicPath</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            )</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        assert(factory.check(), message: &quot;factory address is not configured properly&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // Get the CapabilityFilter.Filter Capability</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        let filter = getAccount(filterAddress).getCapability&lt;&amp;{CapabilityFilter.Filter}&gt;(CapabilityFilter.PublicPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        assert(filter.check(), message: &quot;capability filter is not configured properly&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // Configure access for the delegatee parent account</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        owned.publishToParent(parentAddress: parent.address, factory: factory, filter: filter)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        /* --- Add delegation to parent account --- */</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        //</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // Configure HybridCustody.Manager if needed</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        if parent.borrow&lt;&amp;HybridCustody.Manager&gt;(from: HybridCustody.ManagerStoragePath) == nil {</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            let m &lt;- HybridCustody.createManager(filter: filter)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            parent.save(&lt;- m, to: HybridCustody.ManagerStoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // Link Capabilities</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        parent.unlink(HybridCustody.ManagerPublicPath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        parent.unlink(HybridCustody.ManagerPrivatePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        parent.link&lt;&amp;HybridCustody.Manager{HybridCustody.ManagerPrivate, HybridCustody.ManagerPublic}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            HybridCustody.ManagerPrivatePath,</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            target: HybridCustody.ManagerStoragePath</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        )</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        parent.link&lt;&amp;HybridCustody.Manager{HybridCustody.ManagerPublic}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            HybridCustody.ManagerPublicPath,</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            target: HybridCustody.ManagerStoragePath</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        )</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // Claim the ChildAccount Capability</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        let inboxName = HybridCustody.getChildAccountIdentifier(parent.address)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        let cap = parent</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            .inbox</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            .claim&lt;&amp;HybridCustody.ChildAccount{HybridCustody.AccountPrivate, HybridCustody.AccountPublic, MetadataViews.Resolver}&gt;(</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                inboxName,</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>                provider: newAccount.address</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            ) ?? panic(&quot;child account cap not found&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        // Get a reference to the Manager and add the account</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        let managerRef = parent.borrow&lt;&amp;HybridCustody.Manager&gt;(from: HybridCustody.ManagerStoragePath)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>            ?? panic(&quot;manager no found&quot;)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>        managerRef.addAccount(cap: cap)</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->132</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="funding--custody-patterns">Funding &amp; Custody Patterns<a href="#funding--custody-patterns" class="hash-link" aria-label="Direct link to Funding &amp; Custody Patterns" title="Direct link to Funding &amp; Custody Patterns">​</a></h2>
<p>Aside from implementing onboarding flows &amp; account linking, you&#x27;ll want to also consider the account funding &amp; custodial
pattern appropriate for the app you&#x27;re building. The only pattern compatible with walletless onboarding (and therefore
the only one showcased above) is one in which the app custodies the child account&#x27;s key and funds account creation.</p>
<p>In general, the funding pattern for account creation will determine to some extent the backend infrastructure needed to
support your app and the onboarding flow your app can support. For example, if you want to to create a service-less
client (a totally local app without backend infrastructure), you could forego walletless onboarding in favor of a
user-funded blockchain-native onboarding to achieve a hybrid custody model. Your app maintains the keys to the app
account locally to sign on behalf of the user, and the user funds the creation of the the account, linking to their main
account on account creation. This would be a <strong>user-funded, app custodied</strong> pattern.</p>
<p>Again, custody may deserve some regulatory insight depending on your jurisdiction. If building for production, you&#x27;ll
likely want to consider these non-technical implications in your technical decision-making. Such is the nature of
building in crypto.</p>
<p>Here are the patterns you might consider:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="app-funded-app-custodied">App-Funded, App-Custodied<a href="#app-funded-app-custodied" class="hash-link" aria-label="Direct link to App-Funded, App-Custodied" title="Direct link to App-Funded, App-Custodied">​</a></h3>
<p>If you want to implement walletless onboarding, you can stop here as this is the only compatible pattern. In this
scenario, a backend app account funds the creation of a new account and the app custodies the key for said account
either on the user&#x27;s device or some backend KMS.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="app-funded-user-custodied">App-Funded, User-Custodied<a href="#app-funded-user-custodied" class="hash-link" aria-label="Direct link to App-Funded, User-Custodied" title="Direct link to App-Funded, User-Custodied">​</a></h3>
<p>In this case, the backend app account funds account creation, but adds a key to the account which the user custodies.
In order for the app to act on the user&#x27;s behalf, it has to be delegated access via AuthAccount Capability which the
backend app account would maintain in a <code>HybridCustody.Manager</code>. This means that the new account would have two parent
accounts - the user&#x27;s and the app. While this pattern provides the user maximum ownership and authority over the child
account, this pattern may present unique considerations and edge cases for you as a builder depending on access to the
child account. Also note that this and the following patterns are incompatible with walletless onboarding in that the
user must have a wallet.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="user-funded-app-custodied">User-Funded, App-Custodied<a href="#user-funded-app-custodied" class="hash-link" aria-label="Direct link to User-Funded, App-Custodied" title="Direct link to User-Funded, App-Custodied">​</a></h3>
<p>As mentioned above, this pattern unlocks totally service-less architectures - just a local client &amp; smart contracts. An
authenticated user signs a transaction creating an account, adding the key provided by the client, and linking the
account as a child account. At the end of the transaction, hybrid custody is achieved and the app can sign with the
custodied key on the user&#x27;s behalf using the newly created account.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="user-funded-user-custodied">User-Funded, User-Custodied<a href="#user-funded-user-custodied" class="hash-link" aria-label="Direct link to User-Funded, User-Custodied" title="Direct link to User-Funded, User-Custodied">​</a></h3>
<p>While perhaps not useful for most apps, this pattern may be desirable for advanced users who wish to create a shared
access account themselves. The user funds account creation, adding keys they custody, and delegates secondary access to
some other account.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/onflow/docs/tree/main/docs/build/advanced-concepts/account-linking/child-accounts.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-09-18T13:56:02.000Z">Sep 18, 2023</time></b> by <b>Alex</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/next/build/advanced-concepts/account-linking"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Account Linking (FLIP 72)</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/next/build/advanced-concepts/account-linking/parent-accounts"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Working With Parent Accounts</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objectives" class="table-of-contents__link toc-highlight">Objectives</a></li><li><a href="#point-of-clarity" class="table-of-contents__link toc-highlight">Point of Clarity</a><ul><li><a href="#account-linking" class="table-of-contents__link toc-highlight">Account Linking</a></li><li><a href="#linking-accounts" class="table-of-contents__link toc-highlight">Linking Accounts</a></li></ul></li><li><a href="#terminology" class="table-of-contents__link toc-highlight">Terminology</a></li><li><a href="#account-linking-1" class="table-of-contents__link toc-highlight">Account Linking</a><ul><li><a href="#pre-requisites" class="table-of-contents__link toc-highlight">Pre-requisites</a></li><li><a href="#publish--claim" class="table-of-contents__link toc-highlight">Publish &amp; Claim</a></li><li><a href="#multi-signed-transaction" class="table-of-contents__link toc-highlight">Multi-Signed Transaction</a></li></ul></li><li><a href="#onboarding-flows" class="table-of-contents__link toc-highlight">Onboarding Flows</a><ul><li><a href="#walletless-onboarding" class="table-of-contents__link toc-highlight">Walletless Onboarding</a></li><li><a href="#blockchain-native-onboarding" class="table-of-contents__link toc-highlight">Blockchain-Native Onboarding</a></li></ul></li><li><a href="#funding--custody-patterns" class="table-of-contents__link toc-highlight">Funding &amp; Custody Patterns</a><ul><li><a href="#app-funded-app-custodied" class="table-of-contents__link toc-highlight">App-Funded, App-Custodied</a></li><li><a href="#app-funded-user-custodied" class="table-of-contents__link toc-highlight">App-Funded, User-Custodied</a></li><li><a href="#user-funded-app-custodied" class="table-of-contents__link toc-highlight">User-Funded, App-Custodied</a></li><li><a href="#user-funded-user-custodied" class="table-of-contents__link toc-highlight">User-Funded, User-Custodied</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools">SDK&#x27;s &amp; Tools</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cadence/intro">Cadence</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/building-on-flow/mobile">Mobile</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools/clients/fcl-js">FCL</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools/toolchains/flow-js-testing">JS Testing Library</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools/toolchains/flow-cli">CLI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools/toolchains/emulator">Emulator</a></li><li class="footer__item"><a href="https://github.com/onflow/fcl-dev-wallet" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dev Wallet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools/toolchains/vscode-extension">VS Code Extension</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/community-resources">Ecosystem</a></li><li class="footer__item"><a href="https://port.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flow Port<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/onflow/developer-grants" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Grants<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://flow.com/flow-responsible-disclosure" target="_blank" rel="noopener noreferrer" class="footer__link-item">Responsible Disclosure<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.flowverse.co/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flowverse<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://academy.ecdao.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Emerald Academy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://floats.city/" target="_blank" rel="noopener noreferrer" class="footer__link-item">FLOATs (Attendance NFTs)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Start Building</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://play.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flow Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cadence/tutorial/first-steps">Cadence Tutorials</a></li><li class="footer__item"><a href="https://open-cadence.onflow.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cadence Cookbook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/building-on-flow/core-contracts">Core Contracts &amp; Standards</a></li><li class="footer__item"><a href="https://academy.ecdao.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Emerald DAO Bootcamp<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Network</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://status.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Network Status<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://flowscan.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flowscan Mainnet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://testnet.flowscan.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flowscan Testnet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/building-on-flow/run-and-secure/nodes/node-operation/past-sporks">Past Sporks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/building-on-flow/run-and-secure/nodes/node-operation/upcoming-sporks">Upcoming Sporks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/building-on-flow/run-and-secure/nodes/node-operation">Node Operation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/building-on-flow/run-and-secure/nodes/node-operation/spork">Spork Information</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/onflow" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://onflow.org/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://onflow.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OnFlow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://flow.com/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Flow, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.bd1bb2ab.js"></script>
<script src="/docs/assets/js/main.6ef1af42.js"></script>
</body>
</html>